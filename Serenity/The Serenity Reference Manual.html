<!DOCTYPE html>
<html lang="en"><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.2">
<meta name="description" content="Comprehensive Reference manual for the Serenity BDD living documentation tool">
<meta name="keywords" content="serenity-bdd, bdd, reference, learn, how to">
<meta name="author" content="John Ferguson Smart">
<title>The Serenity Reference Manual</title>
<link rel="stylesheet" href="The%20Serenity%20Reference%20Manual_files/css.css">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove the comments around the @import statement below when using this as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
body{margin:0}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
#map_canvas img,#map_canvas embed,#map_canvas object,.map_canvas img,.map_canvas embed,.map_canvas object{max-width:none!important}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
.antialiased,body{-webkit-font-smoothing:antialiased}
img{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol,ul.no-bullet,ol.no-bullet{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.no-bullet{list-style:none}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
.keyseq{color:rgba(51,51,51,.8)}
kbd{display:inline-block;color:rgba(0,0,0,.8);font-size:.75em;line-height:1.4;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:-.15em .15em 0 .15em;padding:.2em .6em .2em .5em;vertical-align:middle;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menu{color:rgba(0,0,0,.8)}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.05em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.spread{width:100%}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all th.tableblock,table.grid-all td.tableblock{border-width:0 1px 1px 0}
table.grid-all tfoot>tr>th.tableblock,table.grid-all tfoot>tr>td.tableblock{border-width:1px 1px 0 0}
table.grid-cols th.tableblock,table.grid-cols td.tableblock{border-width:0 1px 0 0}
table.grid-all *>tr>.tableblock:last-child,table.grid-cols *>tr>.tableblock:last-child{border-right-width:0}
table.grid-rows th.tableblock,table.grid-rows td.tableblock{border-width:0 0 1px 0}
table.grid-all tbody>tr:last-child>th.tableblock,table.grid-all tbody>tr:last-child>td.tableblock,table.grid-all thead:last-child>tr>th.tableblock,table.grid-rows tbody>tr:last-child>th.tableblock,table.grid-rows tbody>tr:last-child>td.tableblock,table.grid-rows thead:last-child>tr>th.tableblock{border-bottom-width:0}
table.grid-rows tfoot>tr>th.tableblock,table.grid-rows tfoot>tr>td.tableblock{border-width:1px 0 0 0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.unstyled,ol.unnumbered,ul.checklist,ul.none{list-style-type:none}
ul.unstyled,ol.unnumbered,ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1em;font-size:.85em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{width:1em;position:relative;top:1px}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1{padding-right:.75em;font-weight:bold}
td.hdlist1,td.hdlist2{vertical-align:top}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:0 .75em;line-height:1}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none}
span.footnote,span.footnoteref{vertical-align:super;font-size:.875em}
span.footnote a,span.footnoteref a{text-decoration:none}
span.footnote a:active,span.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em;line-height:1.3;font-size:.875em;margin-left:1.2em;text-indent:-1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
h1,h2{letter-spacing:-.01em}
dt,th.tableblock,td.content{text-rendering:optimizeLegibility}
p,td.content{letter-spacing:-.01em}
p strong,td.content strong{letter-spacing:-.005em}
p,blockquote,dt,td.content{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img{page-break-inside:avoid}
thead{display:table-header-group}
img{max-width:100%!important}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
<link rel="stylesheet" href="The%20Serenity%20Reference%20Manual_files/font-awesome.css">
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{font-weight: normal}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#00}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</head>
<body class="book toc2 toc-right">
<div id="header">
<h1>The Serenity Reference Manual</h1>
<div class="details">
<span id="author" class="author">John Ferguson Smart</span><br>
<span id="email" class="email"><a href="https://twitter.com/wakaleo">@wakaleo</a></span><br>
<span id="revnumber">version 1.0.1.1</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#introduction">1. Introducing Serenity</a></li>
<li><a href="#basic-concepts">2. Basic Concepts</a>
<ul class="sectlevel2">
<li><a href="#_detailed_description_of_aggregation_reports">2.1. Detailed description of aggregation reports</a></li>
</ul>
</li>
<li><a href="#first-steps">3. First Steps with Serenity BDD</a></li>
<li><a href="#_different_ways_of_building_your_project">4. Different Ways of Building your Project</a>
<ul class="sectlevel2">
<li><a href="#_building_serenity_projects_in_gradle">4.1. Building Serenity projects in Gradle</a></li>
<li><a href="#_building_serenity_projects_in_maven">4.2. Building Serenity projects in Maven</a></li>
<li><a href="#_building_serenity_projects_in_ant">4.3. Building Serenity projects in Ant</a></li>
</ul>
</li>
<li><a href="#_writing_serenity_step_libraries">5. Writing Serenity Step Libraries</a>
<ul class="sectlevel2">
<li><a href="#_storing_data_between_steps">5.1. Storing data between steps</a></li>
</ul>
</li>
<li><a href="#_serenity_with_different_bdd_frameworks">6. Serenity with different BDD Frameworks</a>
<ul class="sectlevel2">
<li><a href="#_serenity_with_jbehave">6.1. Serenity with JBehave</a></li>
<li><a href="#_serenity_with_cucumber">6.2. Serenity with Cucumber</a></li>
</ul>
</li>
<li><a href="#_serenity_with_junit">7. Serenity with JUnit</a>
<ul class="sectlevel2">
<li><a href="#_basic_junit_integration">7.1. Basic JUnit integration</a></li>
<li><a href="#_human_readable_method_titles">7.2. Human-readable method titles</a></li>
<li><a href="#_serenity_webdriver_support_in_junit">7.3. Serenity WebDriver support in JUnit</a></li>
<li><a href="#_serenity_pageobjects_in_junit">7.4. Serenity PageObjects in JUnit</a></li>
<li><a href="#_skipping_tests">7.5. Skipping tests</a></li>
<li><a href="#_handling_failing_assumptions">7.6. Handling failing assumptions</a></li>
<li><a href="#_data_driven_tests">7.7. Data-driven tests</a></li>
<li><a href="#_using_test_data_from_csv_files">7.8. Using test data from CSV files</a></li>
<li><a href="#_modelling_requirements_in_junit">7.9. Modelling requirements in JUnit</a></li>
</ul>
</li>
<li><a href="#_writing_serenity_page_objects">8. Writing Serenity Page Objects</a>
<ul class="sectlevel2">
<li><a href="#_using_pages_in_a_step_library">8.1. Using pages in a step library</a></li>
<li><a href="#_opening_the_page">8.2. Opening the page</a></li>
<li><a href="#_working_with_web_elements">8.3. Working with web elements</a></li>
<li><a href="#_working_with_asynchronous_pages">8.4. Working with Asynchronous Pages</a></li>
<li><a href="#_working_with_timeouts">8.5. Working with timeouts</a></li>
<li><a href="#_executing_javascript">8.6. Executing Javascript</a></li>
<li><a href="#_uploading_files">8.7. Uploading files</a></li>
<li><a href="#_using_fluent_matcher_expressions">8.8. Using Fluent Matcher expressions</a></li>
<li><a href="#_running_several_steps_using_the_same_page_object">8.9. Running several steps using the same page object</a></li>
<li><a href="#_switching_to_another_page">8.10. Switching to another page</a></li>
</ul>
</li>
<li><a href="#_serenity_and_the_screenplay_pattern">9. Serenity and the Screenplay Pattern</a>
<ul class="sectlevel2">
<li><a href="#_introducing_the_screenplay_pattern">9.1. Introducing the Screenplay Pattern</a></li>
<li><a href="#_screenplay_pattern_tests_runs_like_any_other_serenity_test">9.2. Screenplay Pattern tests runs like any other Serenity test</a></li>
<li><a href="#_layers_of_abstraction">9.3. Layers of abstraction</a></li>
<li><a href="#_actors_and_the_screenplay_pattern">9.4. Actors and the Screenplay Pattern</a></li>
<li><a href="#_actors_have_abilities">9.5. Actors have abilities</a></li>
<li><a href="#_actors_perform_tasks">9.6. Actors perform tasks</a></li>
<li><a href="#_tasks_can_be_created_using_annotated_fields_or_builders">9.7. Tasks can be created using annotated fields or builders</a></li>
<li><a href="#_high_level_tasks_rely_on_other_lower_level_tasks_or_actions">9.8. High level tasks rely on other lower-level tasks or actions</a></li>
<li><a href="#_action_classes_can_access_the_serenity_webdriver_integration">9.9. Action classes can access the Serenity WebDriver integration</a></li>
<li><a href="#_tasks_can_be_used_as_building_blocks_by_other_tasks">9.10. Tasks can be used as building blocks by other tasks</a></li>
<li><a href="#_actors_can_ask_questions_about_the_state_of_the_application">9.11. Actors can ask questions about the state of the application</a></li>
<li><a href="#_actors_use_their_abilities_to_interact_with_the_system">9.12. Actors use their abilities to interact with the system</a></li>
</ul>
</li>
<li><a href="#_advanced_webdriver_integration">10. Advanced WebDriver integration</a>
<ul class="sectlevel2">
<li><a href="#_custom_webdriver_implementations">10.1. Custom WebDriver implementations</a></li>
</ul>
</li>
<li><a href="#_running_remote_tests">11. Running Remote tests</a>
<ul class="sectlevel2">
<li><a href="#_running_tests_against_a_selenium_grid_server">11.1. Running tests against a Selenium Grid server</a></li>
<li><a href="#_running_tests_on_appium">11.2. Running tests on Appium</a></li>
<li><a href="#_running_tests_on_saucelabs">11.3. Running tests on SauceLabs</a></li>
<li><a href="#_running_tests_on_mobile_devices_with_appium">11.4. Running tests on Mobile Devices with Appium</a></li>
<li><a href="#_running_tests_on_browserstack">11.5. Running tests on BrowserStack</a></li>
</ul>
</li>
<li><a href="#_managing_screenshots">12. Managing screenshots</a>
<ul class="sectlevel2">
<li><a href="#_configuring_when_screenshots_are_taken">12.1. Configuring when screenshots are taken</a></li>
<li><a href="#_using_annotations_to_control_screenshots">12.2. Using annotations to control screenshots</a></li>
<li><a href="#_taking_screenshots_at_any_arbitrary_point_during_a_step">12.3. Taking screenshots at any arbitrary point during a step</a></li>
<li><a href="#_increasing_the_size_of_screenshots">12.4. Increasing the size of screenshots</a></li>
<li><a href="#_saving_raw_screenshots">12.5. Saving raw screenshots</a></li>
<li><a href="#_saving_html_source_files_for_screenshots">12.6. Saving HTML source files for screenshots</a></li>
<li><a href="#_blurring_sensitive_screenshots">12.7. Blurring sensitive screenshots</a></li>
</ul>
</li>
<li><a href="#_retrying_failed_tests">13. Retrying failed tests</a></li>
<li><a href="#_filtering_test_executing_with_tags">14. Filtering test executing with tags</a>
<ul class="sectlevel2">
<li><a href="#_annotating_scenarios_with_tags">14.1. Annotating scenarios with tags</a></li>
<li><a href="#_running_scenarios_by_tags">14.2. Running scenarios by tags</a></li>
</ul>
</li>
<li><a href="#_integration_with_issue_project_tracking_systems">15. Integration with Issue &amp; Project Tracking systems</a>
<ul class="sectlevel2">
<li><a href="#_linking_scenarios_tests_with_issues">15.1. Linking scenarios/tests with issues</a></li>
</ul>
</li>
<li><a href="#_integrating_with_jira">16. Integrating with JIRA</a>
<ul class="sectlevel2">
<li><a href="#_one_way_integration_with_jira">16.1. One way integration with JIRA</a></li>
<li><a href="#_two_way_integration_with_jira">16.2. Two way integration with JIRA</a></li>
</ul>
</li>
<li><a href="#_integrating_with_spring">17. Integrating with Spring</a></li>
<li><a href="#_running_serenity_tests_in_parallel_batches">18. Running Serenity tests in parallel batches</a>
<ul class="sectlevel2">
<li><a href="#_splitting_serenity_tests_to_batches">18.1. Splitting serenity tests to batches</a></li>
<li><a href="#_configuration_parallel_executing_with_jenkins">18.2. Configuration parallel executing with Jenkins</a></li>
</ul>
</li>
<li><a href="#_testing_rest_with_serenity_bdd">19. Testing REST with Serenity BDD</a>
<ul class="sectlevel2">
<li><a href="#_reports_created_when_rest_is_tested">19.1. Reports created when Rest is tested</a></li>
<li><a href="#_writing_tests_with_rest_assured">19.2. Writing tests with Rest Assured</a></li>
<li><a href="#_using_split_classes_to_initialise_and_configure_rest_assured">19.3. Using split classes to initialise and configure Rest Assured</a></li>
</ul>
</li>
<li><a href="#_importing_test_results_generated_by_serenity_bdd">20. Importing test results generated by Serenity BDD</a>
<ul class="sectlevel2">
<li><a href="#_loading_test_outcomes_from_folder">20.1. Loading Test OutComes from folder</a></li>
<li><a href="#_analysing_test_outcomes">20.2. Analysing Test OutComes</a></li>
</ul>
</li>
<li><a href="#_importing_test_results_from_external_sources">21. Importing test results from external sources</a></li>
<li><a href="#_appendicies">Appendicies</a>
<ul class="sectlevel1">
<li><a href="#_serenity_system_properties_and_configuration">22. Serenity System Properties and Configuration</a>
<ul class="sectlevel2">
<li><a href="#_running_serenity_tests_from_the_command_line">22.1. Running Serenity tests from the command line</a></li>
<li><a href="#_providing_your_own_firefox_profile">22.2. Providing your own Firefox profile</a></li>
<li><a href="#_colors_in_console_output">22.3. Colors in console output</a></li>
</ul>
</li>
<li><a href="#_license_and_copyright">23. License and Copyright</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="introduction"><a class="anchor" href="#introduction"></a>1. Introducing Serenity</h2>
<div class="sectionbody">
<div class="imageblock">
<div class="content">
<img src="The%20Serenity%20Reference%20Manual_files/serenity-logo.png" alt="serenity logo">
</div>
</div>
<div class="paragraph">
<p>Serenity BDD is an open source library that aims to make the idea of <a href="http://en.wikipedia.org/wiki/Specification_by_example">living documentation</a> a reality.</p>
</div>
<div class="paragraph">
<p>Serenity BDD helps you write cleaner and more maintainable automated 
acceptance and regression tests faster. Serenity also uses the test 
results to produce illustrated, narrative reports that document and 
describe what your application does and how it works. Serenity tells you
 not only what tests have been executed, but more importantly, what 
requirements have been tested.</p>
</div>
<div class="paragraph">
<p>One key advantage of using Serenity BDD is that you do not have to 
invest time in building and maintaining your own automation framework.</p>
</div>
<div class="paragraph">
<p>Serenity BDD provides strong support for automated web tests using <a href="http://docs.seleniumhq.org/projects/webdriver">Selenium 2</a>,
 though it also works very effectively for non-web tests such as tests 
that exercise web services or even call application code directly.</p>
</div>
<div class="paragraph">
<p>The aim of Serenity is to make it easy to quickly write 
well-structured, maintainable automated acceptance criteria, using your 
favorite BDD or conventional testing library. You can work with 
Behavior-Driven-Development tools like Cucumber or JBehave, or simply 
use JUnit. You can integrate with requirements stored in an external 
source (such as JIRA or any other test cases mangement tool), or just 
use a simple directory-based approach to organize your requirements.</p>
</div>
<div class="paragraph">
<p>Up until November 2014, Serenity went by the name of Thucydides.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="basic-concepts"><a class="anchor" href="#basic-concepts"></a>2. Basic Concepts</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To get the most out of Serenity BDD, it is useful to understand some 
of the basic Serenity BDD behind Behaviour Driven Development and 
Automated Acceptance Testing. Serenity BDD is commonly used for both 
Automated Acceptance Tests and Regression Tests, and the principles 
discussed here apply, with minor variations, to both.</p>
</div>
<div class="paragraph">
<p>Behaviour Driven Development or BDD, is a development approach where 
team members explore, and build a shared understanding of application 
requirements through conversations around examples. In Agile teams 
practicing BDD, this is often done before or early on in a sprint, in a 
special meeting sometimes called "the three amigos" or "the three-way 
handshake", where (at least) a BA (Business Analyst, Product 
Owner/Manager), a developer and a tester get together to work through 
examples from the acceptance criteria. The examples being discussed are 
concrete illustrations of how the system should work, or how a user 
might use a feature. These examples help provoke discussion, uncovering 
assumptions and omissions that would have otherwise lead the development
 team into error further down the track.</p>
</div>
<div class="paragraph">
<p>Let’s look at an example. Suppose we are building the shopping cart component of an online craft sales site.
In Agile terms, the corresponding user story might look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="gherkin">In order to make the most appropriate purchase decisions
As a buyer
I want to be able to place items I want to buy in a virtual cart before placing my order</code></pre>
</div>
</div>
<div class="paragraph">
<p>If we were implementing this story, we would typically define a set 
of acceptance criteria to flesh out and understand the requirements. For
 example, we might have the following criteria in our list of acceptance
 criteria:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Show total price for all items</p>
</li>
<li>
<p>Show line item prices</p>
</li>
<li>
<p>Show shipping costs</p>
</li>
<li>
<p>…​</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If we were using a Behaviour-Driven-Development approach, we might 
express these requirements in a more formal form, like the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="gherkin">Scenario: Show shipping cost for an item in the shopping cart
Given I have searched for 'docking station'
And I have selected a matching item
When I add it to the cart
Then the shipping cost should be included in the total price</code></pre>
</div>
</div>
<div class="paragraph">
<p>This <a href="https://www.agilealliance.org/glossary/gwt-2/">Given When Then</a> format is widely used for acceptance tests in Agile projects.</p>
</div>
<div id="fig-test-report" class="imageblock">
<div class="content">
<img src="The%20Serenity%20Reference%20Manual_files/serenity-test-report.png" alt="serenity test report">
</div>
<div class="title">Figure 1. A test report generated by Serenity</div>
</div>
<div class="paragraph">
<p>Note how this scenario is deliberately pitched at a fairly high 
level, in business terms, describing the business motivations behind the
 feature without committing to a particular implementation.</p>
</div>
<div class="paragraph">
<p>When a tester or a developer automates and executes this scenario, or
 a BA reviews the results, they will often want to see a bit more 
detail. For example, the tester will want to see how the screens played 
out (if it’s a web test), what test data was used and so on. And the BA 
might want to see what the screens look like for each step.</p>
</div>
<div class="paragraph">
<p>Serenity BDD does below for you</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Makes it easy to write, execute, and report on automated acceptance 
tests in terms like this, that BAs and testers as well as developers can
 relate to.</p>
</li>
<li>
<p>Structure your automated acceptance tests into steps and sub-steps 
like the ones illustrated above. This tends to make the tests clearer, 
more flexible and easier to maintain.</p>
</li>
<li>
<p>When the tests are executed, Serenity produces illustrated, narrative-style reports like this:</p>
</li>
</ul>
</div>
<div id="fig-aggregate-report" class="imageblock">
<div class="content">
<img src="The%20Serenity%20Reference%20Manual_files/serenity-aggregate-report.png" alt="serenity aggregate report">
</div>
<div class="title">Figure 2. An aggregate report generated by Serenity</div>
</div>
<div class="paragraph">
<p>Serenity BDD also gives you a broader picture, helping you see where 
individual scenarios fit into the overall set of product requirements. 
It helps you see not only the current state of the tests, but also what 
requirements have been (and have not been) tested (see <a href="#fig-aggregate-report">An aggregate report generated by Serenity</a>).</p>
</div>
<div class="paragraph">
<p>Serenity BDD is also commonly used for automated <a href="http://en.wikipedia.org/wiki/Regression_testing">Regression Tests</a>.
 Whereas BDD Acceptance Tests are defined very early on in the piece, 
before development starts, Regression Tests involve an existing system. 
Other than that, the steps involved in defining and automating the tests
 are very similar.</p>
</div>
<div class="paragraph">
<p>When it comes to implementing the tests themselves, Serenity BDD also
 provides many features that make it easier, faster and cleaner to write
 clear, maintainable tests. This is particularly true for automated web 
tests using WebDriver, but Serenity BDD also caters for non-web tests as
 well. Serenity BDD plays well with JUnit as well as more specialized 
BDD frameworks such as Cucumber and JBehave.</p>
</div>
<div class="sect2">
<h3 id="_detailed_description_of_aggregation_reports"><a class="anchor" href="#_detailed_description_of_aggregation_reports"></a>2.1. Detailed description of aggregation reports</h3>
<div class="paragraph">
<p>Serenity BDD aggregation report can be organised by using features, 
stories, steps, scenarios/tests. When you use different frameworks with 
Serenity BDD it is possible that the same things will have different 
definitions. For instance, <code>examples</code> in JBehave/Cucumber has almost same meaning as <code>Test Data</code> in Junit, or <code>scenario</code> in JBehave/Cucumber is the same as <code>test</code> in JUnit. Also <strong>Test</strong> is a synonym of <strong>Acceptance Criteria</strong>.
 Here is introduced some short example in order to describe Serenity BDD
 report. The way of creating and organising the whole test process you 
can find in next chapters.</p>
</div>
<div class="paragraph">
<p>Our example contains 2 features with a few stories. Each story can 
contain one or more scenarios, each scenario consists of one or more 
steps and some examples. The default amount of examples is 1.</p>
</div>
<div class="paragraph">
<p>Sample:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Feature:Definition
		Story: Look for definition
			Scenario (or Test, or Acceptance Criteria): Looking for definition: pass
                examples: 3
                steps: 3
			Scenario: Looking for definition with incorrect symbols: @Ignore
                examples: 4
                steps: 3
			Scenario: Looking for not existed definition: failed
                examples: 2
                steps: 3
		Story: Update a definition
			Scenario: Updating a definition: some internal error
                examples: 5
                steps: 3

Feature:Petstore
		Story: Remove a pet
			Scenario: Removing a pet: @Skip
			  	steps: 5
			Scenario: Removing multiple pets: @Pending
			  	steps: 6
		Story: Update a pet
			Scenario: Updating a pet: @Ignore
			  	steps: 4
		Story: Add a pet
			Scenario: Adding a pet: pass
			  	steps: 3</pre>
</div>
</div>
<div class="paragraph">
<p>Scenarios Removing a pet, Removing multiple pets, Updating a pet, 
Adding a pet are defined without usage of any examples.
Scenarios Looking for definition, Looking for definition with incorrect 
symbols, Looking for not existed definition, Updating a definition are 
defined with examples.
Scenario Removing a pet is marked to be skipped.
Scenarios Updating a pet, Looking for definition with incorrect symbols 
are marked to be ignored.
Scenarios Looking for definition, Adding a pet should pass.
Scenario Looking for not existed definition should not be passed.
Scenario Updating a definition should throw unexpected exception during 
execution.
Scenario Removing multiple pets is marked to be pending.</p>
</div>
<div class="paragraph">
<p>After running all these tests (doesn’t matter if you use JBehave, 
Cucumber or JUnit) you will receive aggregation report, that will look 
similar to the structure of tests:</p>
</div>
<div id="basic-concepts-detailed-test-count" class="imageblock">
<div class="content">
<img src="The%20Serenity%20Reference%20Manual_files/basic-concepts-detailed-test-count.png" alt="basic concepts detailed test count">
</div>
<div class="title">Figure 3. Serenity BDD report for example test on tab Test Count</div>
</div>
<div class="paragraph">
<p>Report contains test results of all executed scenarios, and consists of the next tabs:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>Overall Test Results</strong></dt>
<dd>
<p>General info about provided features/components stories in this test.
 Also represents statistics of passed/ignored/skipped/failed tests based
 on their amount and examples.</p>
</dd>
<dt class="hdlist1"><strong>Requirements</strong></dt>
<dd>
<p>Detailed info about statistics based on Features, Stories and Acceptance Criteria</p>
</dd>
<dt class="hdlist1"><strong>Features</strong></dt>
<dd>
<p>Summary table of all Features</p>
</dd>
<dt class="hdlist1"><strong>Stories</strong></dt>
<dd>
<p>Summary table with statistics of stories</p>
</dd>
</dl>
</div>
<div class="sect3">
<h4 id="_tab_overall_test_results"><a class="anchor" href="#_tab_overall_test_results"></a>2.1.1. Tab Overall Test Results</h4>
<div class="paragraph">
<p>Here you can find almost all information about executed tests. It consists of next sub-tabs:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>Test Count</strong></dt>
<dd>
<p>Summary page of all general statistics and info, based on amount of scenarios and used examples.</p>
</dd>
<dt class="hdlist1"><strong>Weighted Tests</strong></dt>
<dd>
<p>Summary page of all general statistics and info, weighted by scenarios size in steps.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>There is also general information about executed tests:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>8 test scenarios (15 tests in all, including 10 rows of test data)
4 passes, 1 pending, 2 failed, 5 with errors, 0 compromised, 2 ignored, 1 skipped</pre>
</div>
</div>
<div class="paragraph">
<p><strong>ignored</strong> = 2 - amount of all scenarios which are marked to be ignored. To get this number Serenity counts scenarios with @Ignored mark.</p>
</div>
<div class="paragraph">
<p><strong>skipped</strong> = 1 - amount of all scenarios which are marked to be skipped. To get this number Serenity counts scenarios with @Skipped mark.</p>
</div>
<div class="paragraph">
<p><strong>with errors</strong> = 5 - amount of all scenarios which 
throw some unexpected exception during execution. To get this number 
Serenity counts scenarios with Error mark or examples of those scenarios
 if provided.</p>
</div>
<div class="paragraph">
<p><strong>failed</strong> = 2 - amount of all scenarios which fail. To 
get this number Serenity counts failed scenarios or examples of those 
scenarios if provided.</p>
</div>
<div class="paragraph">
<p><strong>pending</strong> = 1 - amount of all scenarios which are 
marked to be pending. To get this number Serenity counts scenarios with 
@Pending mark or examples of those scenarios if provided.</p>
</div>
<div class="paragraph">
<p><strong>passes</strong> = 4 - amount of all passed scenarios. To get 
this number Serenity counts passed scenarios or examples of those 
scenarios if provided.</p>
</div>
<div class="paragraph">
<p><strong>rows of test data</strong> = 10 - amount of all examples from
 scenarios witch are used in this report, including skipped scenarios 
but without ignored scenarios. To get this number Serenity counts 
examples of those scenarios if provided. In our case there are 3 of such
 scenarios: with 2, 3 and 5 examples.</p>
</div>
<div class="paragraph">
<p><strong>tests in all</strong> = 15 - sum of "ignored", "skipped", "with errors", "failed", "pending", "passes" values</p>
</div>
<div class="paragraph">
<p><strong>test scenarios</strong> = 8 - amount of all scenarios in this test. In our sample there are 8 scenarios.</p>
</div>
<div class="sect4">
<h5 id="_sub_tab_test_count"><a class="anchor" href="#_sub_tab_test_count"></a>Sub-Tab Test Count</h5>
<div class="paragraph">
<p>As you can see on <a href="#basic-concepts-detailed-test-count">Serenity BDD report for test structure on tab with Stories</a>, it contains next elements: Pie Chart, Test Result Summary table, Related Tags table and Test table.</p>
</div>
<div class="paragraph">
<p><strong>Test Result Summary</strong>.
This table contains more detailed statistics than short summary above.</p>
</div>
<div class="paragraph">
<p>Row <strong>Automated</strong> contains automated tests.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Ignored</strong> - count of automated tests which are marked to be ignored.To get this number Serenity counts scenarios are marked as @Ignored.</p>
</li>
<li>
<p><strong>Percent of ignored tests</strong> - percentage of <strong>Ignored</strong> tests to <strong>tests in all</strong>. In our case there are 2 such scenario, and it is 13% of 15.</p>
</li>
<li>
<p><strong>Pending</strong> - amount of all scenarios are marked to be 
pending. To get this number Serenity counts @Pending scenarios or 
examples of those scenarios if provided.</p>
</li>
<li>
<p><strong>Percent of pending tests</strong> - percentage of <strong>Pending</strong> tests to <strong>tests in all</strong>. In our case there is 1 such scenario, and it is 7% from 15.</p>
</li>
<li>
<p><strong>Fail</strong> - amount of all scenarios which failed and 
scenarios with errors. In our case there is 1 failed scenario with 2 
examples and 1 error scenario with 5 examples - 7 as a result.</p>
</li>
<li>
<p><strong>Percent of fail tests</strong> - percentage of <strong>Fail</strong> tests to <strong>tests in all</strong>. In our case there are 7 scenarios/examples and it is 47% from 15.</p>
</li>
<li>
<p><strong>Pass</strong> - amount of passed scenarios. In our case there
 are 2 such scenario: one without examples, and second with 3 examples -
 4 as a result.</p>
</li>
<li>
<p><strong>Percent of passed tests</strong> - percentage of <strong>Pass</strong> tests to <strong>tests in all</strong>. In our case there are 4 scenarios/examples and it is 27% from 15.</p>
</li>
<li>
<p><strong>Total</strong> - equal to <strong>tests in all</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Row <strong>Manual</strong> contains manual tests. In order to 
execute test manually you should use @Manual annotation, idea the same 
as for Automated row. Generally, it is possible to use it to mark 
scenarios (@Manual on scenario level) or all scenarios in story (@manual
 on Story level). The @Manual annotation is not designed to be defined 
for an individual step within a test, but only for the whole test.</p>
</div>
<div class="paragraph">
<p>Row <strong>Total</strong> should contains summary for each column.</p>
</div>
</div>
<div class="sect4">
<h5 id="_sub_tab_weighted_tests"><a class="anchor" href="#_sub_tab_weighted_tests"></a>Sub-Tab Weighted tests</h5>
<div class="paragraph">
<p>This sub tab contains rest results weighted by test size in steps</p>
</div>
<div id="basic-concepts-detailed-weighted-tests" class="imageblock">
<div class="content">
<img src="The%20Serenity%20Reference%20Manual_files/basic-concepts-detailed-weighted-tests.png" alt="basic concepts detailed weighted tests">
</div>
<div class="title">Figure 4. Serenity BDD report for example test on tab Weighted tests</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_tab_requirements"><a class="anchor" href="#_tab_requirements"></a>2.1.2. Tab Requirements</h4>
<div class="paragraph">
<p>On this tab all tests results are organized as requirements</p>
</div>
<div id="basic-concepts-detailed-requirements" class="imageblock">
<div class="content">
<img src="The%20Serenity%20Reference%20Manual_files/basic-concepts-detailed-requirements.png" alt="basic concepts detailed requirements">
</div>
<div class="title">Figure 5. Serenity BDD report for test structure on tab with Requirements</div>
</div>
</div>
<div class="sect3">
<h4 id="_tab_features"><a class="anchor" href="#_tab_features"></a>2.1.3. Tab Features</h4>
<div class="paragraph">
<p>On this tab all tests results are organized as features. In our example we have 2 features</p>
</div>
<div id="basic-concepts-detailed-test-count" class="imageblock">
<div class="content">
<img src="The%20Serenity%20Reference%20Manual_files/basic-concepts-detailed-features.png" alt="basic concepts detailed features">
</div>
<div class="title">Figure 6. Serenity BDD report for test structure on tab with Features</div>
</div>
</div>
<div class="sect3">
<h4 id="_tab_stories"><a class="anchor" href="#_tab_stories"></a>2.1.4. Tab Stories</h4>
<div class="paragraph">
<p>There are stories on this tab. in our example - there are 5 stories.</p>
</div>
<div id="basic-concepts-detailed-test-count" class="imageblock">
<div class="content">
<img src="The%20Serenity%20Reference%20Manual_files/basic-concepts-detailed-stories.png" alt="basic concepts detailed stories">
</div>
<div class="title">Figure 7. Serenity BDD report for test structure on tab with Stories</div>
</div>
</div>
<div class="sect3">
<h4 id="_filtering_in_serenity_reports"><a class="anchor" href="#_filtering_in_serenity_reports"></a>2.1.5. Filtering in Serenity Reports</h4>
<div class="paragraph">
<p>To provide a better user experience, there is available a filtering 
feature in Serenity BDD aggregated reports. It makes much easier to find
 particular subset of tests by names, features, etc.</p>
</div>
<div class="paragraph">
<p>For example you have next tests:</p>
</div>
<div id="subset-of-tests-for-filtering" class="imageblock">
<div class="content">
<img src="The%20Serenity%20Reference%20Manual_files/subset-of-tests-for-filtering.png" alt="subset of tests for filtering">
</div>
<div class="title">Figure 8. Serenity BDD report example for filtering</div>
</div>
<div class="paragraph">
<p>It is easy to filter some of them with starting typing its name in filter field:</p>
</div>
<div id="filtered-tests-for-filtering" class="imageblock">
<div class="content">
<img src="The%20Serenity%20Reference%20Manual_files/filtered-tests-for-filtering.png" alt="filtered tests for filtering">
</div>
<div class="title">Figure 9. Serenity BDD report example with applied filter</div>
</div>
<div class="paragraph">
<p>Filtering feature enabled for almost all main pages of serenity report.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="first-steps"><a class="anchor" href="#first-steps"></a>3. First Steps with Serenity BDD</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this section we will show you how to get started with Serenity BDD using a simple project using <a href="http://junit.org/">JUnit</a> and <a href="http://gradle.org/">Gradle</a>.</p>
</div>
<div class="paragraph">
<p>Serenity BDD projects can be built using Gradle, <a href="http://maven.apache.org/">Maven</a> or <a href="https://ant.apache.org/">Ant</a>. Configuring a Java or <a href="http://groovy.codehaus.org/">Groovy</a>
 build to use Serenity BDD is generally just a matter of adding the 
right dependencies, and a task or plugin to generate the aggregated 
reports.</p>
</div>
<div class="paragraph">
<p>For example, a simple Gradle build for a Serenity BDD project could look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories {
    mavenLocal()
    jcenter()
}

buildscript {
    repositories {
        mavenLocal()
        jcenter()
    }
    dependencies {
        classpath(<span class="string"><span class="delimiter">"</span><span class="content">net.serenity-bdd:serenity-gradle-plugin:1.1.1</span><span class="delimiter">"</span></span>)     <i class="conum" data-value="1"></i><b>(1)</b>
    }
}

apply <span class="key">plugin</span>: <span class="string"><span class="delimiter">'</span><span class="content">java</span><span class="delimiter">'</span></span>
apply <span class="key">plugin</span>: <span class="string"><span class="delimiter">'</span><span class="content">eclipse</span><span class="delimiter">'</span></span>
apply <span class="key">plugin</span>: <span class="string"><span class="delimiter">'</span><span class="content">idea</span><span class="delimiter">'</span></span>
apply <span class="key">plugin</span>: <span class="string"><span class="delimiter">'</span><span class="content">net.serenity-bdd.aggregator</span><span class="delimiter">'</span></span>                             <i class="conum" data-value="2"></i><b>(2)</b>

dependencies {
    testCompile <span class="string"><span class="delimiter">'</span><span class="content">net.serenity-bdd:serenity-core:1.1.1</span><span class="delimiter">'</span></span>                  <i class="conum" data-value="3"></i><b>(3)</b>
    testCompile <span class="string"><span class="delimiter">'</span><span class="content">net.serenity-bdd:serenity-junit:1.1.1</span><span class="delimiter">'</span></span>                <i class="conum" data-value="4"></i><b>(4)</b>
    testCompile(<span class="string"><span class="delimiter">'</span><span class="content">junit:junit:4.12</span><span class="delimiter">'</span></span>)
    testCompile(<span class="string"><span class="delimiter">'</span><span class="content">org.assertj:assertj-core:1.7.0</span><span class="delimiter">'</span></span>)
    testCompile(<span class="string"><span class="delimiter">'</span><span class="content">org.slf4j:slf4j-simple:1.7.7</span><span class="delimiter">'</span></span>)
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Add the Serenity plugin to the Gradle build path</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Adds the <em>aggregate</em> and <em>check</em> tasks to the Gradle build</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The core Serenity BDD classes</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The Serenity BDD JUnit integration</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Next, you would write a JUnit test to express the acceptance criteria
 that you want to automate. Suppose you are working on a Frequent Flyer 
website for an airline. You are implementing the feature that lets 
Frequent Flyer members earn points when they travel. The first 
acceptance criteria you need to cater for is the following:
   - Frequent Flyer members earn 100 points for every 1000 km travelled.</p>
</div>
<div class="paragraph">
<p>Using Serenity BDD, you could write a unit test like the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@RunWith</span>(SerenityRunner.class)                                                          <i class="conum" data-value="1"></i><b>(1)</b>
<span class="directive">public</span> <span class="type">class</span> <span class="class">WhenCalculatingFrequentFlyerPoints</span> {

    <span class="annotation">@Steps</span>                                                                              <i class="conum" data-value="2"></i><b>(2)</b>
    TravellerSteps travellerSteps;

    <span class="annotation">@Test</span>
    <span class="directive">public</span> <span class="type">void</span> shouldCalculatePointsBasedOnDistance() {
        <span class="comment">// GIVEN</span>
        travellerSteps.a_traveller_has_a_frequent_flyer_account_with_balance(<span class="integer">10000</span>);    <i class="conum" data-value="3"></i><b>(3)</b>

        <span class="comment">// WHEN</span>
        travellerSteps.the_traveller_flies(<span class="integer">1000</span>);                                       <i class="conum" data-value="3"></i><b>(3)</b>

        <span class="comment">// THEN</span>
        travellerSteps.traveller_should_have_a_balance_of(<span class="integer">10100</span>);                       <i class="conum" data-value="3"></i><b>(3)</b>

    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>You run the JUnit test using the <em>Serenity</em> test runner</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>@Steps</code> annotation marks a Serenity step library</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The unit test is composed of logical steps, each of which will appear in the reports</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>When you write acceptance tests this way, the JUnit test mainly 
orchestrates the order of the steps: the bulk of the testing logic goes 
in the step library methods themselves.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">TravellerSteps</span> {

    FrequentFlyer frequentFlyer;                                                        <i class="conum" data-value="1"></i><b>(1)</b>

    <span class="annotation">@Step</span>(<span class="string"><span class="delimiter">"</span><span class="content">Given a traveller has a frequent flyer account with {0} points</span><span class="delimiter">"</span></span>)             <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="directive">public</span> <span class="type">void</span> a_traveller_has_a_frequent_flyer_account_with_balance(<span class="type">int</span> initialBalance) {
        frequentFlyer = FrequentFlyer.withInitialBalanceOf(initialBalance);             <i class="conum" data-value="3"></i><b>(3)</b>
    }

    <span class="annotation">@Step</span>(<span class="string"><span class="delimiter">"</span><span class="content">When the traveller flies {0} km</span><span class="delimiter">"</span></span>)
    <span class="directive">public</span> <span class="type">void</span> the_traveller_flies(<span class="type">int</span> distance) {
        frequentFlyer.flies(distance).kilometers();                                     <i class="conum" data-value="4"></i><b>(4)</b>

    }

    <span class="annotation">@Step</span>(<span class="string"><span class="delimiter">"</span><span class="content">Then the traveller should have a balance of {0} points</span><span class="delimiter">"</span></span>)
    <span class="directive">public</span> <span class="type">void</span> traveller_should_have_a_balance_of(<span class="type">int</span> expectedBalance ) {
        assertThat(frequentFlyer.getBalance()).isEqualTo(expectedBalance);              <i class="conum" data-value="5"></i><b>(5)</b>
    }

    <span class="annotation">@Step</span>
    <span class="directive">public</span> <span class="type">void</span> a_traveller_joins_the_frequent_flyer_program() {
        frequentFlyer = FrequentFlyer.withInitialBalanceOf(<span class="integer">0</span>);
    }

    <span class="annotation">@Step</span>
    <span class="directive">public</span> <span class="type">void</span> traveller_should_have_a_status_of(Status expectedStatus) {
        assertThat(frequentFlyer.getStatus()).isEqualTo(expectedStatus);
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This is the object under test.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>@Step</code> annotation marks this as a method that will be recorded and will appear in the test report</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Prepare the test data</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The action under test</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Check the outcome</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Note that, at this point, the <code>FrequentFlyer</code> class and the <code>flies()</code>
 method may not exist: you are using the acceptance test implementation 
to discover the services you need from your application code. This is 
very typical of a BDD/TDD approach to writing software, and as a result 
the acceptance tests not only test the application, they also illustrate
 how the application code is meant to work.</p>
</div>
<div class="paragraph">
<p>These tests would initially fail, because the <code>FrequentFlyer.flies()</code>
 method hasn’t been written. But once you have correctly implemented 
this method, you can run the tests and generate the reports from the 
command line like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ gradle clean test aggregate</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will produce a report like the one below in the <code>target/site/serenity</code> directory.</p>
</div>
<div id="fig-test-report" class="imageblock">
<div class="content">
<img src="The%20Serenity%20Reference%20Manual_files/first-steps-test-report.png" alt="first steps test report">
</div>
<div class="title">Figure 10. The <code>@Step</code> methods appear as lines in the test report</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_different_ways_of_building_your_project"><a class="anchor" href="#_different_ways_of_building_your_project"></a>4. Different Ways of Building your Project</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Serenity tries to fit into your current build practices, whether you 
are using Maven, Gradle or even Ant. We assume you have some background 
in Java build tools, but if you are curious <a href="http://zeroturnaround.com/rebellabs/java-build-tools-maven-gradle-and-ant-plus-the-dsl-vs-xml-debate/">here is a rundown of all three</a>.</p>
</div>
<div class="sect2">
<h3 id="_building_serenity_projects_in_gradle"><a class="anchor" href="#_building_serenity_projects_in_gradle"></a>4.1. Building Serenity projects in Gradle</h3>
<div class="paragraph">
<p>Serenity BDD is easy to integrate with <a href="https://www.gradle.org/">Gradle</a>, using the <code>serenity-gradle-plugin</code>.
A simple example is shown here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories {
    mavenLocal()
    jcenter()
}

buildscript {
    repositories {
        mavenLocal()
        jcenter()
    }
    dependencies {
        classpath(<span class="string"><span class="delimiter">"</span><span class="content">net.serenity-bdd:serenity-gradle-plugin:1.1.1</span><span class="delimiter">"</span></span>)     <i class="conum" data-value="1"></i><b>(1)</b>
    }
}

apply <span class="key">plugin</span>: <span class="string"><span class="delimiter">'</span><span class="content">java</span><span class="delimiter">'</span></span>
apply <span class="key">plugin</span>: <span class="string"><span class="delimiter">'</span><span class="content">eclipse</span><span class="delimiter">'</span></span>
apply <span class="key">plugin</span>: <span class="string"><span class="delimiter">'</span><span class="content">idea</span><span class="delimiter">'</span></span>
apply <span class="key">plugin</span>: <span class="string"><span class="delimiter">'</span><span class="content">net.serenity-bdd.aggregator</span><span class="delimiter">'</span></span>                             <i class="conum" data-value="2"></i><b>(2)</b>

dependencies {
    testCompile <span class="string"><span class="delimiter">'</span><span class="content">net.serenity-bdd:serenity-core:1.1.1</span><span class="delimiter">'</span></span>                  <i class="conum" data-value="3"></i><b>(3)</b>
    testCompile <span class="string"><span class="delimiter">'</span><span class="content">net.serenity-bdd:serenity-junit:1.1.1</span><span class="delimiter">'</span></span>                <i class="conum" data-value="4"></i><b>(4)</b>
    testCompile(<span class="string"><span class="delimiter">'</span><span class="content">junit:junit:4.12</span><span class="delimiter">'</span></span>)
    testCompile(<span class="string"><span class="delimiter">'</span><span class="content">org.assertj:assertj-core:1.7.0</span><span class="delimiter">'</span></span>)
    testCompile(<span class="string"><span class="delimiter">'</span><span class="content">org.slf4j:slf4j-simple:1.7.7</span><span class="delimiter">'</span></span>)
}
gradle.startParameter.continueOnFailure = <span class="predefined-constant">true</span>                          <i class="conum" data-value="5"></i><b>(5)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Add the Serenity plugin to the Gradle build path</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Adds the aggregate and check tasks to the Gradle build</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The core Serenity BDD classes</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The Serenity BDD JUnit integration</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Ensure that the Gradle build does not stop at the first test failure, but goes on to generate the Serenity reports</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>First of all, add the Serenity BDD plugin entry to the Gradle build path in the <code>buildscript</code> section (1). This enables Gradle to find and apply the plugin to your project. You can check the latest version numbers on <a href="https://bintray.com/serenity/maven/">Bintray</a>.</p>
</div>
<div class="paragraph">
<p>Next, you need to apply this plugin to your project (2) and add the 
Serenity BDD dependencies to your project.  You will typically add <code>core</code> (3) and another dependency that correpsonds to the testing library you are using (JUnit in this example: (4)).</p>
</div>
<div class="paragraph">
<p>The <code>serenity-gradle-plugin</code> adds below two tasks to your project:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">aggregate</dt>
<dd>
<p>Generates the Serenity aggregate reports from the JSON test results produced when you run the Serenity BDD tests.</p>
</dd>
<dt class="hdlist1">checkOutcomes</dt>
<dd>
<p>Check the test results in the output directory, and fail the build if there are errors or failures.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>A typical use case is to run the tests and to always produce the 
aggregate report, no matter what the test results are. To do this in one
 line, you need to tell Gradle not to stop if the tests fail. You can do
 this by setting <code>gradle.startParameter.continueOnFailure</code> to <code>true</code>, and then running the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">gradle test aggregate</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will run the tests and generate an aggregate report in the <code>target/site/thucydides</code> directory.</p>
</div>
</div>
<div class="sect2">
<h3 id="_building_serenity_projects_in_maven"><a class="anchor" href="#_building_serenity_projects_in_maven"></a>4.2. Building Serenity projects in Maven</h3>
<div class="paragraph">
<p>Serenity BDD integrates with <a href="http://maven.apache.org/">Maven</a> via the <code>serenity-maven-plugin</code>.
An example of a <code>pom.xml</code> file using Serenity BDD is shown here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="tag">&lt;project</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">"</span><span class="content">http://maven.apache.org/POM/4.0.0</span><span class="delimiter">"</span></span> <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">"</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">"</span></span>
         <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">"</span><span class="content">http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;modelVersion&gt;</span>4.0.0<span class="tag">&lt;/modelVersion&gt;</span>

    <span class="tag">&lt;groupId&gt;</span>net.serenity_bdd.samples.junit<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>junit-quick-start<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;version&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/version&gt;</span>
    <span class="tag">&lt;packaging&gt;</span>jar<span class="tag">&lt;/packaging&gt;</span>

    <span class="tag">&lt;name&gt;</span>Serenity JUnit Quick Start Project<span class="tag">&lt;/name&gt;</span>

    <span class="tag">&lt;properties&gt;</span>
        <span class="tag">&lt;project.build.sourceEncoding&gt;</span>UTF-8<span class="tag">&lt;/project.build.sourceEncoding&gt;</span>
        <span class="tag">&lt;serenity.version&gt;</span>1.0.47<span class="tag">&lt;/serenity.version&gt;</span>
        <span class="tag">&lt;serenity.maven.version&gt;</span>1.0.47<span class="tag">&lt;/serenity.maven.version&gt;</span>
        <span class="tag">&lt;webdriver.driver&gt;</span>firefox<span class="tag">&lt;/webdriver.driver&gt;</span>
    <span class="tag">&lt;/properties&gt;</span>

    <span class="tag">&lt;dependencies&gt;</span>
        <span class="tag">&lt;dependency&gt;</span>
            <span class="tag">&lt;groupId&gt;</span>net.serenity-bdd<span class="tag">&lt;/groupId&gt;</span>     <i class="conum" data-value="1"></i><b>(1)</b>
            <span class="tag">&lt;artifactId&gt;</span>core<span class="tag">&lt;/artifactId&gt;</span>
            <span class="tag">&lt;version&gt;</span>${serenity.version}<span class="tag">&lt;/version&gt;</span>
        <span class="tag">&lt;/dependency&gt;</span>
        <span class="tag">&lt;dependency&gt;</span>
            <span class="tag">&lt;groupId&gt;</span>net.serenity-bdd<span class="tag">&lt;/groupId&gt;</span>     <i class="conum" data-value="2"></i><b>(2)</b>
            <span class="tag">&lt;artifactId&gt;</span>serenity-junit<span class="tag">&lt;/artifactId&gt;</span>
            <span class="tag">&lt;version&gt;</span>${serenity.version}<span class="tag">&lt;/version&gt;</span>
        <span class="tag">&lt;/dependency&gt;</span>
        <span class="tag">&lt;dependency&gt;</span>
            <span class="tag">&lt;groupId&gt;</span>org.slf4j<span class="tag">&lt;/groupId&gt;</span>
            <span class="tag">&lt;artifactId&gt;</span>slf4j-simple<span class="tag">&lt;/artifactId&gt;</span>
            <span class="tag">&lt;version&gt;</span>1.6.1<span class="tag">&lt;/version&gt;</span>
        <span class="tag">&lt;/dependency&gt;</span>
        <span class="tag">&lt;dependency&gt;</span>
            <span class="tag">&lt;groupId&gt;</span>junit<span class="tag">&lt;/groupId&gt;</span>
            <span class="tag">&lt;artifactId&gt;</span>junit<span class="tag">&lt;/artifactId&gt;</span>
            <span class="tag">&lt;version&gt;</span>4.11<span class="tag">&lt;/version&gt;</span>
            <span class="tag">&lt;scope&gt;</span>test<span class="tag">&lt;/scope&gt;</span>
        <span class="tag">&lt;/dependency&gt;</span>
        <span class="tag">&lt;dependency&gt;</span>
            <span class="tag">&lt;groupId&gt;</span>org.assertj<span class="tag">&lt;/groupId&gt;</span>
            <span class="tag">&lt;artifactId&gt;</span>assertj-core<span class="tag">&lt;/artifactId&gt;</span>
            <span class="tag">&lt;version&gt;</span>1.7.0<span class="tag">&lt;/version&gt;</span>
            <span class="tag">&lt;scope&gt;</span>test<span class="tag">&lt;/scope&gt;</span>
        <span class="tag">&lt;/dependency&gt;</span>
    <span class="tag">&lt;/dependencies&gt;</span>
    <span class="tag">&lt;build&gt;</span>
        <span class="tag">&lt;plugins&gt;</span>
            <span class="tag">&lt;plugin&gt;</span>
                <span class="tag">&lt;artifactId&gt;</span>maven-failsafe-plugin<span class="tag">&lt;/artifactId&gt;</span>                  <i class="conum" data-value="3"></i><b>(3)</b>
                <span class="tag">&lt;version&gt;</span>2.18<span class="tag">&lt;/version&gt;</span>
                <span class="tag">&lt;configuration&gt;</span>
                    <span class="tag">&lt;includes&gt;</span>
                        <span class="tag">&lt;include&gt;</span>**/features/**/When*.java<span class="tag">&lt;/include&gt;</span>                  <i class="conum" data-value="4"></i><b>(4)</b>
                    <span class="tag">&lt;/includes&gt;</span>
                    <span class="tag">&lt;systemProperties&gt;</span>
                        <span class="tag">&lt;webdriver.driver&gt;</span>${webdriver.driver}<span class="tag">&lt;/webdriver.driver&gt;</span> <i class="conum" data-value="8"></i><b>(8)</b>
                        <span class="tag">&lt;surefire.rerunFailingTestsCount&gt;</span>${surefire.rerunFailingTestsCount}<span class="tag">&lt;/surefire.rerunFailingTestsCount&gt;</span>
                        <span class="tag">&lt;surefire.rerunFailingTestsCount&gt;</span>${surefire.rerunFailingTestsCount}<span class="tag">&lt;/surefire.rerunFailingTestsCount&gt;</span>
                    <span class="tag">&lt;/systemProperties&gt;</span>
                <span class="tag">&lt;/configuration&gt;</span>
            <span class="tag">&lt;/plugin&gt;</span>
            <span class="tag">&lt;plugin&gt;</span>
                <span class="tag">&lt;groupId&gt;</span>net.serenity-bdd.maven.plugins<span class="tag">&lt;/groupId&gt;</span>       <i class="conum" data-value="5"></i><b>(5)</b>
                <span class="tag">&lt;artifactId&gt;</span>serenity-maven-plugin<span class="tag">&lt;/artifactId&gt;</span>
                <span class="tag">&lt;version&gt;</span>${serenity.maven.version}<span class="tag">&lt;/version&gt;</span>
                <span class="tag">&lt;dependencies&gt;</span>
                     <span class="tag">&lt;dependency&gt;</span>
                        <span class="tag">&lt;groupId&gt;</span>net.serenity-bdd<span class="tag">&lt;/groupId&gt;</span>
                        <span class="tag">&lt;artifactId&gt;</span>core<span class="tag">&lt;/artifactId&gt;</span>
                        <span class="tag">&lt;version&gt;</span>${serenity.version}<span class="tag">&lt;/version&gt;</span>
                    <span class="tag">&lt;/dependency&gt;</span>
                <span class="tag">&lt;/dependencies&gt;</span>
                <span class="tag">&lt;executions&gt;</span>
                    <span class="tag">&lt;execution&gt;</span>
                        <span class="tag">&lt;id&gt;</span>serenity-reports<span class="tag">&lt;/id&gt;</span>
                        <span class="tag">&lt;phase&gt;</span>post-integration-test<span class="tag">&lt;/phase&gt;</span>             <i class="conum" data-value="6"></i><b>(6)</b>
                        <span class="tag">&lt;goals&gt;</span>
                            <span class="tag">&lt;goal&gt;</span>aggregate<span class="tag">&lt;/goal&gt;</span>                       <i class="conum" data-value="7"></i><b>(7)</b>
                        <span class="tag">&lt;/goals&gt;</span>
                    <span class="tag">&lt;/execution&gt;</span>
                <span class="tag">&lt;/executions&gt;</span>
            <span class="tag">&lt;/plugin&gt;</span>
        <span class="tag">&lt;/plugins&gt;</span>
    <span class="tag">&lt;/build&gt;</span>
<span class="tag">&lt;/project&gt;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Core Serenity dependency</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>JUnit Serenity dependency</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The Maven Failsafe plugin</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Include only tests in the <code>junit</code> directory</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>The Serenity Maven Plugin</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Generate the aggregate reports during the post-integration test phase</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Call the <em>aggregate</em> goal to generate them</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>Pass the <code>webdriver.driver</code> system property to the tests.</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>First, you need to add the Serenity BDD dependencies to your project. You will typically add <code>core</code>
 and another dependency that correpsonds to the testing library you are 
using (JUnit in this example). Other supported testing libraries include
 JBehave and Cucumber.</p>
</div>
<div class="paragraph">
<p>You typically want the Serenity tests to run as integration tests (that is, during the <em>integration-test</em>
 phase of the Maven build) rather than as unit tests. You also want the 
build not to immediately fail when a test fails, but to continue until 
it has generated the Serenity aggregate reports before failing at the 
end of the build. To do this, we use the <code>maven-failsafe-plugin</code> (3). This plugin runs your integration test in the <code>integration-test</code> phase without immediately failing the build when a test fails. Build failure is triggered later in the lifecycle, during the <code>verify</code> phase. Also it is good idea turn off failing build if some test was failed - just to allow maven execute all tests.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;plugin&gt;</span>
   <span class="tag">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/groupId&gt;</span>
   <span class="tag">&lt;artifactId&gt;</span>maven-surefire-plugin<span class="tag">&lt;/artifactId&gt;</span>
   <span class="tag">&lt;version&gt;</span>xxxx<span class="tag">&lt;/version&gt;</span>
   <span class="tag">&lt;configuration&gt;</span>
      <span class="tag">&lt;testFailureIgnore&gt;</span>true<span class="tag">&lt;/testFailureIgnore&gt;</span>
   <span class="tag">&lt;/configuration&gt;</span>
<span class="tag">&lt;/plugin&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Normal JUnit tests run from Maven need to start or end with <code>Test</code>.
 But for acceptance tests, a more flexible strategy is better, as it 
makes it easier to name test cases after scenarios or stories. In the <code>pom.xml</code> file shown above, we configure the <code>maven-failsafe-plugin</code> to run all of the tests in the <code>junit</code> directory, regardless of how they are named (4).</p>
</div>
<div class="paragraph">
<p>Next, you need to add and configure the <code>serenity-maven-plugin</code>.Pt. 5 A useful technique is to bind the <code>aggregate</code> goal plugin to the <code>post-integration-test</code> phase. Pt.6 and Pt.7 This way, to run the tests and to generate the reports, you would run the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">mvn verify</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will run the tests and generate an aggregate report in the <code>target/site/serenity</code> directory.</p>
</div>
<div class="paragraph">
<p>Like the surefire plugin the <code>maven-failsafe-plugin</code> 
starts a new JVM instance to run the tests. For this reason, if you need
 to pass system parameters to the tests (for example, the <code>webdriver.driver</code> property shown here), you need to use the <code>&lt;systemProperties&gt;</code> section</p>
</div>
<div class="paragraph">
<p>Tip: It is possible to use a Junit Run Configuration to run a 
Serenity Testrunner. This will not generate an aggregate report. If you 
find your index.html file is missing, check that you are using a Maven 
build Run Configuration with goal verify to run your test and get the 
aggregate report.</p>
</div>
</div>
<div class="sect2">
<h3 id="_building_serenity_projects_in_ant"><a class="anchor" href="#_building_serenity_projects_in_ant"></a>4.3. Building Serenity projects in Ant</h3>

</div>
</div>
</div>
<div class="sect1">
<h2 id="_writing_serenity_step_libraries"><a class="anchor" href="#_writing_serenity_step_libraries"></a>5. Writing Serenity Step Libraries</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In Serenity, tests are broken down into reusable steps. An important 
principle behind Serenity is the idea that it is easier to maintain a 
test that uses several layers of abstraction to hide the complexity 
behind different parts of a test.</p>
</div>
<div class="paragraph">
<p>In an automated web test, test steps represent the level of 
abstraction between your Page Objects (which are designed in terms of 
actions that you perform on a given page) and higher-level stories 
(sequences of more business-focused actions that illustrate how a given 
user story has been implemented). If your automated test is not 
UI-oriented (for example, if it calls a web service), steps orchestrate 
other more technical components such as REST clients. Steps can contain 
other steps, and are included in the Serenity reports. Whenever a step 
is executed, a screenshot is stored and displayed in the report.</p>
</div>
<div class="paragraph">
<p>For example, the first test in the following sample is broken into two steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a new Frequent Flyer member</p>
</li>
<li>
<p>Check that the member has a status of Bronze</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The second is broken into three steps:</p>
</div>
<div class="paragraph">
<p>Verify passenger can be enrolled into Frequent Flyer Member programme
 and gets upgraded to Silver membership status after flying 10K km</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a new Frequent Flyer member</p>
</li>
<li>
<p>Make the member fly 10000 km</p>
</li>
<li>
<p>Check that the member has a status of Silver</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@RunWith</span>(SerenityRunner.class)
<span class="directive">public</span> <span class="type">class</span> <span class="class">WhenEarningFrequentFlyerStatus</span> {

    <span class="annotation">@Steps</span>
    TravellerStatusSteps travellerSteps;

    <span class="annotation">@Test</span>
    <span class="directive">public</span> <span class="type">void</span> membersShouldStartWithBronzeStatus() {
        <span class="comment">// GIVEN</span>
        travellerSteps.a_traveller_joins_the_frequent_flyer_program();

        <span class="comment">// THEN</span>
        travellerSteps.traveller_should_have_a_status_of(Bronze);
    }

    <span class="annotation">@Test</span>
    <span class="directive">public</span> <span class="type">void</span> earnSilverAfter1000Points() {
        <span class="comment">// GIVEN</span>
        travellerSteps.a_traveller_joins_the_frequent_flyer_program();

        <span class="comment">// WHEN</span>
        travellerSteps.the_traveller_flies(<span class="integer">10000</span>);

        <span class="comment">// THEN</span>
        travellerSteps.traveller_should_have_a_status_of(Silver);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice how the second test reuses step methods used in the first to 
perform a slightly different test. This is a typical example of the way 
we reuse steps in similar tests, in order to avoid duplicated code and 
make the code easier to maintain.</p>
</div>
<div class="paragraph">
<p>Also notice how we did not need to instantiate the Steps class <code>TravellerStatusSteps</code>. When you annotated a member variable of this class with the <code>@Steps</code> annotation, Serenity BDD will automatically instantiate it for you.</p>
</div>
<div class="paragraph">
<p>Step methods are annotated with the <code>@Step</code> annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">TravellerStatusSteps</span> <span class="directive">extends</span> TravellerSteps {                  <i class="conum" data-value="1"></i><b>(1)</b>

    <span class="annotation">@Step</span>                                                                   <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="directive">public</span> <span class="type">void</span> a_traveller_joins_the_frequent_flyer_program() {
        frequentFlyer = FrequentFlyer.withInitialBalanceOf(<span class="integer">0</span>);
    }

    <span class="annotation">@Step</span>(<span class="string"><span class="delimiter">"</span><span class="content">The traveller should have {0} status</span><span class="delimiter">"</span></span>)                           <i class="conum" data-value="3"></i><b>(3)</b>
    <span class="directive">public</span> <span class="type">void</span> traveller_should_have_a_status_of(Status expectedStatus) {
        assertThat(frequentFlyer.getStatus()).isEqualTo(expectedStatus);
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Steps classes can extend any class, or none</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>@Step</code> annotation denotes a Serenity step method</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>@Step</code> can take a String value to override the default step name</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>By default, the name of a step is derived from the method name. If 
you want something more readable, you can add a String parameter to the <code>@Step</code> annotation. If you put references to variables in the string (<code>{0}</code>, <code>{1}</code> etc.), Serenity will inject the method parameters into the string. So suppose you define a <code>@Step</code> method like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Step</span>(<span class="string"><span class="delimiter">"</span><span class="content">The traveller should have {0} status</span><span class="delimiter">"</span></span>)
<span class="directive">public</span> <span class="type">void</span> traveller_should_have_a_status_of(Status expectedStatus) {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When you call this method with a given parameter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">travellerSteps.traveller_should_have_a_status_of(Bronze);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then the step title will be the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>"The traveller should have Bronze status"</pre>
</div>
</div>
<div class="paragraph">
<p>Serenity step methods also play an important role in the reporting. When the reports are generated, methods annotated with the <code>@Step</code> annotation will appear as lines in the report.</p>
</div>
<div id="fig-steps-earning-status" class="imageblock">
<div class="content">
<img src="The%20Serenity%20Reference%20Manual_files/fig-steps-earning-status.png" alt="fig steps earning status">
</div>
<div class="title">Figure 11. Each <code>@Step</code> method appears as a line in the test report</div>
</div>
<div class="sect2">
<h3 id="_storing_data_between_steps"><a class="anchor" href="#_storing_data_between_steps"></a>5.1. Storing data between steps</h3>
<div class="paragraph">
<p>Sometimes it is useful to be able to pass information between steps. 
For example, you might need to check that client detailed entered on a 
registration appears correctly on a confirmation page later on.</p>
</div>
<div class="paragraph">
<p>You can do this by setting member variables in the step definition classes. In the following code, the <code>frequentFlyer</code> member variable is set in the first <code>@Step</code> method, and then reused in the subsequent steps.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">TravellerSteps</span> {

    FrequentFlyer frequentFlyer;                                                        <i class="conum" data-value="1"></i><b>(1)</b>

    <span class="annotation">@Step</span>(<span class="string"><span class="delimiter">"</span><span class="content">Given a traveller has a frequent flyer account with {0} points</span><span class="delimiter">"</span></span>)             <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="directive">public</span> <span class="type">void</span> a_traveller_has_a_frequent_flyer_account_with_balance(<span class="type">int</span> initialBalance) {
        frequentFlyer = FrequentFlyer.withInitialBalanceOf(initialBalance);             <i class="conum" data-value="3"></i><b>(3)</b>
    }

    <span class="annotation">@Step</span>(<span class="string"><span class="delimiter">"</span><span class="content">When the traveller flies {0} km</span><span class="delimiter">"</span></span>)
    <span class="directive">public</span> <span class="type">void</span> the_traveller_flies(<span class="type">int</span> distance) {
        frequentFlyer.flies(distance).kilometers();                                     <i class="conum" data-value="4"></i><b>(4)</b>

    }

    <span class="annotation">@Step</span>(<span class="string"><span class="delimiter">"</span><span class="content">Then the traveller should have a balance of {0} points</span><span class="delimiter">"</span></span>)
    <span class="directive">public</span> <span class="type">void</span> traveller_should_have_a_balance_of(<span class="type">int</span> expectedBalance ) {
        assertThat(frequentFlyer.getBalance()).isEqualTo(expectedBalance);              <i class="conum" data-value="5"></i><b>(5)</b>
    }

    <span class="annotation">@Step</span>
    <span class="directive">public</span> <span class="type">void</span> a_traveller_joins_the_frequent_flyer_program() {
        frequentFlyer = FrequentFlyer.withInitialBalanceOf(<span class="integer">0</span>);
    }

    <span class="annotation">@Step</span>
    <span class="directive">public</span> <span class="type">void</span> traveller_should_have_a_status_of(Status expectedStatus) {
        assertThat(frequentFlyer.getStatus()).isEqualTo(expectedStatus);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A third approach is to use the Serenity test session, which is 
essentially a hash map where you can store variables for the duration of
 a single test. Variables in the Serenity test session are available in 
any step definition class.</p>
</div>
<div class="paragraph">
<p>The following example shows a simple web test:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@RunWith</span>(SerenityRunner.class)
<span class="directive">public</span> <span class="type">class</span> <span class="class">WhenSearchingFlights</span> {

    <span class="annotation">@Managed</span>(driver = <span class="string"><span class="delimiter">"</span><span class="content">chrome</span><span class="delimiter">"</span></span>)
    WebDriver driver;

    <span class="annotation">@Steps</span>
    FlightSearchSteps theCustomer;

    <span class="annotation">@Test</span>
    <span class="directive">public</span> <span class="type">void</span> should_display_selected_flight_details() {
        <span class="comment">// GIVEN</span>
        theCustomer.searches_for_flights_between(<span class="string"><span class="delimiter">"</span><span class="content">Sydney</span><span class="delimiter">"</span></span>, <span class="string"><span class="delimiter">"</span><span class="content">London</span><span class="delimiter">"</span></span>);
        <span class="comment">// WHEN</span>
        theCustomer.view_flight_details_for_flight(<span class="integer">1</span>);
        <span class="comment">// THEN</span>
        theCustomer.should_see_the_destination_city_in_the_summary();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We need to store the destination city in the first step to be used in
 the last step. We could do this using the Serenity session as shown 
here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">FlightSearchSteps</span> <span class="directive">extends</span> ScenarioSteps {

    FlightSearchPage flightSearchPage;
    FlightSearchResultsPage flightSearchResultsPage;
    FlightDetailsPage flightDetailsPage;

    <span class="annotation">@Step</span>(<span class="string"><span class="delimiter">"</span><span class="content">A customer searchers for flights between {0} and {1}</span><span class="delimiter">"</span></span>)
    <span class="directive">public</span> <span class="type">void</span> searches_for_flights_between(<span class="predefined-type">String</span> departure, <span class="predefined-type">String</span> destination) {
        Serenity.setSessionVariable(<span class="string"><span class="delimiter">"</span><span class="content">destinationCity</span><span class="delimiter">"</span></span>).to(destination); <i class="conum" data-value="1"></i><b>(1)</b>

        flightSearchPage.searchForFlightsFrom(departure).to(destination);
    }

    <span class="annotation">@Step</span>
    <span class="directive">public</span> <span class="type">void</span> view_flight_details_for_flight(<span class="type">int</span> flightNumber) {
        flightSearchResultsPage.selectFlightNumber(flightNumber);
    }

    <span class="annotation">@Step</span>
    <span class="directive">public</span> <span class="type">void</span> should_see_the_destination_city_in_the_summary() {
        <span class="predefined-type">String</span> expectedDestinationCity
                = Serenity.sessionVariableCalled(<span class="string"><span class="delimiter">"</span><span class="content">destinationCity</span><span class="delimiter">"</span></span>).toString(); <i class="conum" data-value="2"></i><b>(2)</b>

        assertThat(flightDetailsPage.getDestinationCity()).isEqualTo(expectedDestinationCity);
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Store the departure city in a session variable</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Retrieve the session variable in another step</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Note that step methods can take parameters. The parameters that are 
passed into a step method will be recorded and reported in the Serenity 
reports, making this an excellent technique to make your tests more 
maintainable and more modular.</p>
</div>
<div class="paragraph">
<p>Steps can also call other steps, which is very useful for more complicated test scenarios.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_serenity_with_different_bdd_frameworks"><a class="anchor" href="#_serenity_with_different_bdd_frameworks"></a>6. Serenity with different BDD Frameworks</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Serenity provide integration with Behavior-Driven-Development tools like Cucumber or JBehave.</p>
</div>
<div class="sect2">
<h3 id="_serenity_with_jbehave"><a class="anchor" href="#_serenity_with_jbehave"></a>6.1. Serenity with JBehave</h3>
<div class="paragraph">
<p><a href="http://jbehave.org/">JBehave</a> is an open source BDD 
framework originally written by Dan North, the inventor of BDD. It is 
strongly integrated into the JVM world, and widely used by Java 
development teams wanting to implement BDD practices in their projects.</p>
</div>
<div class="paragraph">
<p>In JBehave, you write automate your acceptance criteria by writing 
test stories and scenarios using the familiar BDD "given-when-then" 
notation, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="gherkin">Searching by keyword

Meta:
@tag product:search

Narrative:
  In order to find items that I would like to purchase
  As a potential buyer
  I want to be able to search for items containing certain words

Scenario: Should list items related to a specified keyword
Given I want to buy a wool scarf
When I search for items containing 'wool'
Then I should only see items related to 'wool'

Scenario: Should be able to filter search results by item type
Given I have searched for items containing 'wool'
When I filter results by type 'Handmade'
Then I should only see items containing 'wool' of type 'Handmade'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Scenarios like this go in <code>.story</code> files: a story file is 
designed to contain all the scenarios (acceptence criteria) of a given 
user story. A story file can also have a narrative section at the top, 
which gives some background and context about the story being tested:</p>
</div>
<div class="paragraph">
<p>You usually implement a JBehave story using classes and methods 
written in Java, Groovy or Scala. You implement the story steps using 
annotated methods to represent the steps in the text scenarios, as shown
 in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">SearchByKeywordStepDefinitions</span> {
    <span class="annotation">@Steps</span>
    BuyerSteps buyer;

    <span class="annotation">@Given</span>(<span class="string"><span class="delimiter">"</span><span class="content">I want to buy $article</span><span class="delimiter">"</span></span>)
    <span class="directive">public</span> <span class="type">void</span> buyerWantsToBuy(<span class="predefined-type">String</span> article) {
        buyer.opens_etsy_home_page();
    }

    <span class="annotation">@When</span>(<span class="string"><span class="delimiter">"</span><span class="content">I search for items containing '$keyword'</span><span class="delimiter">"</span></span>)
    <span class="directive">public</span> <span class="type">void</span> searchByKeyword(<span class="predefined-type">String</span> keyword) {
        buyer.searches_for_items_containing(keyword);
        buyer.filters_results_to_local_region();
    }


    <span class="annotation">@When</span>(<span class="string"><span class="delimiter">"</span><span class="content">I search for local items containing '$keyword'</span><span class="delimiter">"</span></span>)
    <span class="directive">public</span> <span class="type">void</span> localSearchByKeyword(<span class="predefined-type">String</span> keyword) {
        buyer.searches_for_items_containing(keyword);
    }

    <span class="annotation">@Then</span>(<span class="string"><span class="delimiter">"</span><span class="content">I should only see items related to '$keyword'</span><span class="delimiter">"</span></span>)
    <span class="directive">public</span> <span class="type">void</span> resultsForACategoryAndKeywordInARegion(<span class="predefined-type">String</span> keyword) {
        buyer.should_see_items_related_to(keyword);
    }
}</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_working_with_jbehave_and_serenity"><a class="anchor" href="#_working_with_jbehave_and_serenity"></a>6.1.1. Working with JBehave and Serenity</h4>
<div class="paragraph">
<p>Serenity and JBehave work well together. Serenity uses simple 
conventions to make it easier to get started writing and implementing 
Serenity stories, and reports on both JBehave and Serenity steps, which 
can be seamlessly combined in the same class, or placed in separate 
classes, depending on your preferences.</p>
</div>
<div class="paragraph">
<p>To get started, you will need to add the Serenity JBehave plugin to 
your project. In Maven, just add the following dependencies to your 
pom.xml file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">        <span class="tag">&lt;dependency&gt;</span>
            <span class="tag">&lt;groupId&gt;</span>net.serenity-bdd<span class="tag">&lt;/groupId&gt;</span>
            <span class="tag">&lt;artifactId&gt;</span>core<span class="tag">&lt;/artifactId&gt;</span>
            <span class="tag">&lt;version&gt;</span>${serenity.version}<span class="tag">&lt;/version&gt;</span>
        <span class="tag">&lt;/dependency&gt;</span>
        <span class="tag">&lt;dependency&gt;</span>
            <span class="tag">&lt;groupId&gt;</span>net.serenity-bdd<span class="tag">&lt;/groupId&gt;</span>
            <span class="tag">&lt;artifactId&gt;</span>serenity-jbehave<span class="tag">&lt;/artifactId&gt;</span>
            <span class="tag">&lt;version&gt;</span>${serenity.jbehave.version}<span class="tag">&lt;/version&gt;</span>
        <span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The equivalent in Gradle is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">    testCompile <span class="string"><span class="delimiter">'</span><span class="content">net.serenity-bdd:core:1.0.47</span><span class="delimiter">'</span></span>
    testCompile <span class="string"><span class="delimiter">'</span><span class="content">net.serenity-bdd:serenity-jbehave:1.0.21</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>New versions come out regularly, so be sure to check the Maven Central repository (<a href="http://search.maven.org/" class="bare">http://search.maven.org</a>) to know the latest version numbers for each dependency.</p>
</div>
</div>
<div class="sect3">
<h4 id="_setting_up_your_project_and_organizing_your_directory_structure"><a class="anchor" href="#_setting_up_your_project_and_organizing_your_directory_structure"></a>6.1.2. Setting up your project and organizing your directory structure</h4>
<div class="paragraph">
<p>JBehave is a highly flexible tool. The downside of this is that, out 
of the box, JBehave requires quite a bit of bootstrap code to get 
started. Serenity tries to simplify this process by using a 
convention-over-configuration approach, which significantly reduces the 
amount of work needed to get started with your acceptance tests. In 
fact, you can get away with as little as an empty JUnit test case and a 
sensibly-organized directory structure for your JBehave stories.</p>
</div>
<div class="sect4">
<h5 id="_the_junit_test_runner"><a class="anchor" href="#_the_junit_test_runner"></a>The JUnit test runner</h5>
<div class="paragraph">
<p>The JBehave tests are run via a JUnit runner. This makes it easier to
 run the tests both from within an IDE or as part of the build process. 
All you need to do is to extend the SerenityStories, as shown here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">net.serenitybdd.samples.etsy</span>;

<span class="keyword">import</span> <span class="include">net.serenitybdd.jbehave.SerenityStories</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">AcceptanceTests</span> <span class="directive">extends</span> SerenityStories {}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When you run this test, Serenity will run any JBehave stories that it
 finds in the default directory location. By convention, it will look 
for a <code>stories</code> folder on your classpath, so ‘src/test/resources/stories’ is a good place to put your story files.</p>
</div>
</div>
<div class="sect4">
<h5 id="_organizing_your_requirements"><a class="anchor" href="#_organizing_your_requirements"></a>Organizing your requirements</h5>
<div class="paragraph">
<p>Placing all of your JBehave stories in one directory does not scale 
well; it is generally better to organize them in a directory structure 
that groups them in some logical way. In addition, if you structure your
 requirements well, Serenity will be able to provide much more 
meaningful reporting on the test results.</p>
</div>
<div class="paragraph">
<p>By default, Serenity supports a simple directory-based convention for
 organizing your requirements. The standard structure uses three levels:
 capabilities, features and stories. A story is represented by a JBehave
 .story file so two directory levels underneath the <code>stories</code> directory will do the trick. An example of this structure is shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>+ src
  + test
    + resources
      + stories
        + grow_potatoes                     [a capability]
          + grow_organic_potatoes           [a feature]
            - plant_organic_potatoes.story  [a story]
            - dig_up_organic_potatoes.story [another story]
          + grow_sweet_potatoes             [another feature]
          ...</pre>
</div>
</div>
<div class="paragraph">
<p>If you prefer another hierarchy, you can use the <code>serenity.requirement.types</code>
 system property to override the default convention. For example. if you
 prefer to organize your requirements in a hierachy consisting of epics,
 theme and stories, you could set the <code>serenity.requirement.types</code> property to <em>epic,theme</em> (the story level is represented by the .story file).</p>
</div>
<div class="paragraph">
<p>When you start a project, you will typically have a good idea of the 
high level capabilities you intent to implement, and probably some of 
the main features. If you simply store your .story files in the right 
directory structure, the Serenity reports will reflect these 
requirements, even if no tests have yet been specified for them. This is
 an excellent way to keep track of project progress. At the start of an 
iteration, the reports will show all of the requirements to be 
implemented, even those with no tests defined or implemented yet. As the
 iteration progresses, more and more acceptance criteria will be 
implemented, until acceptance criteria have been defined and implemented
 for all of the requirements that need to be developed.</p>
</div>
<div class="paragraph">
<p>An optional but useful feature of the JBehave story format is the 
narrative section that can be placed at the start of a story to help 
provide some more context about that story and the scenarios it 
contains. This narrative will appear in the Serenity reports, to help 
give product owners, testers and other team members more information 
about the background and motivations behind each story. For example, if 
you are working on an online classifieds website, you might want users 
to be able to search ads using keywords. You could describe this 
functionality with a textual description like this one from the <code>locating_a_customer.story</code> story file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="gherkin">Narrative:
In order to provide assistance to customers more quickly
As a financial adviser
I want to be able to locate a customer using a variety of different criteria</code></pre>
</div>
</div>
<div class="paragraph">
<p>However to make the reports more useful still, it is a good idea to 
document not only the stories, but to also do the same for your higher 
level requirements (Capabilities, Themes). In Serenity, you can do this 
by placing a text file called <code>narrative.txt</code> in each of the 
requirements directories you want to document (see below). These files 
follow the JBehave convention for writing narratives, with an optional 
title on the first line, followed by a narrative section started by the 
keyword <code>Narrative:</code>. When a title is provided it will 
replace the directory name in the reports. For example, for a search 
feature for an online classifieds web site, you might have a description
 along the following lines:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Search for online ads

Narrative:
In order to increase sales of advertised articles
As a seller
I want potential buyers to be able to display only the ads for
articles that they might be interested in purchasing.</pre>
</div>
</div>
<div class="paragraph">
<p>When you run these stories (without having implemented any actual 
tests), you will get a report containing lots of pending tests, but more
 interestingly, a list of the requirements that need to be implemented, 
even if there are no tests or stories associated with them yet. This 
makes it easier to plan an iteration: you will initially have a set of 
requirements with only a few tests, but as the iteration moves forward, 
you will typically see the requirements fill out with pending and 
passing acceptance criteria as work progresses.</p>
</div>
<div id="jbehave-requirements-report" class="imageblock">
<div class="content">
<img src="The%20Serenity%20Reference%20Manual_files/jbehave-requirements-report.png" alt="jbehave requirements report" width="475">
</div>
<div class="title">Figure 12. You can see the requirements that you need to implement n the requirements report</div>
</div>
<div class="sect5">
<h6 id="_narrative_in_asciidoc_format"><a class="anchor" href="#_narrative_in_asciidoc_format"></a>Narrative in asciidoc format</h6>
<div class="paragraph">
<p>Narratives can be written in <a href="http://www.methods.co.nz/asciidoc/">Asciidoc</a> for richer formatting. Set the <code>narrative.format</code> property to <code>asciidoc</code> to allow Serenity to parse the narrative in asciidoc format.</p>
</div>
<div class="paragraph">
<p>For example, the following narrative:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Item search

Narrative:
In order to find the items I am interested in faster
As a +buyer+
*I want to be able to list all the ads with a particular keyword in the description or title*</pre>
</div>
</div>
<div class="paragraph">
<p>will be rendered on the report as shown below.</p>
</div>
<div id="asciidoc_narrative" class="imageblock">
<div class="content">
<img src="The%20Serenity%20Reference%20Manual_files/asciidoc_narrative.png" alt="asciidoc narrative" width="475">
</div>
<div class="title">Figure 13. Narrative with asciidoc formatting</div>
</div>
<div class="paragraph">
<p>With Cucumber a Narrative.txt file can also be placed in any 
requirement directory and will be included in the Serenity reports just 
like with JBehave.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_customizing_the_requirements_module"><a class="anchor" href="#_customizing_the_requirements_module"></a>Customizing the requirements module</h5>
<div class="paragraph">
<p>You can also easily extend the Serenity requirements support so that 
it fits in to your own system. This is a two-step process. First, you 
need to write an implementation of the <code>RequirementsTagProvider</code> interface.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.acme.tests</span>

<span class="namespace">public</span> <span class="namespace">class</span> <span class="namespace">MyRequirementsTagProvider</span> <span class="namespace">implements</span> <span class="namespace">RequirementsTagProvider</span> {
    <span class="annotation">@Override</span>
    <span class="namespace">public</span> <span class="namespace">List</span>&lt;<span class="namespace">Requirement</span>&gt; <span class="namespace">getRequirements</span>() {
        <span class="comment">// Return the full list of available requirements from your system</span>
    }

    <span class="annotation">@Override</span>
    <span class="namespace">public</span> <span class="namespace">Optional</span>&lt;<span class="namespace">Requirement</span>&gt; <span class="namespace">getParentRequirementOf</span>(<span class="namespace">TestOutcome</span> <span class="namespace">testOutcome</span>) {
        <span class="comment">// Return the requirement, if any, associated with a particular test result</span>
    }

    <span class="annotation">@Override</span>
    <span class="namespace">public</span> <span class="namespace">Set</span>&lt;<span class="namespace">TestTag</span>&gt; <span class="namespace">getTagsFor</span>(<span class="namespace">TestOutcome</span> <span class="namespace">testOutcome</span>) {
        <span class="comment">// Return all the requirements, and other tags, associated with a particular test result</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next, create a text file in your <code>src/main/resources/META-INF/services</code> directory called <code>net.thucydides.core.statistics.service.TagProvider</code>, and put the fullly qualified name of your RequirementsTagProvider implementation.</p>
</div>
</div>
<div class="sect4">
<h5 id="_story_meta_data"><a class="anchor" href="#_story_meta_data"></a>Story meta-data</h5>
<div class="paragraph">
<p>You can use the JBehave Meta tag to provide additional information to
 Serenity about the test. The @driver annotation lets you specify what 
WebDriver driver to use, eg.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="gherkin">Adding items to the shopping cart

Meta:
@driver phantomjs

Narrative:
  In order to buy multiple items at the same time
  As a buyer
  I want to be able to add multiple items to the shopping cart

Scenario: Should see total price including tax
Given I have searched for local items containing 'wool'
And I have selected an item
When I add the item to the shopping cart
Then the item should appear in the cart
And the shipping cost should be included in the total price</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also use the @issue annotation to link scenarios with issues, more information can be found  under <a href="#_linking_scenarios_tests_with_issues">Linking scenarios/tests with issues</a>.</p>
</div>
<div class="paragraph">
<p>You can also attribute tags to the story as a whole, or to individual scenarios:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="gherkin">Meta:
@tag capability:a capability

Scenario: A scenario that works
Meta:
@tags domain:a domain, iteration: iteration 1

Given I have an implemented JBehave scenario
And the scenario works
When I run the scenario
Then I should get a successful result</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_implementing_the_tests"><a class="anchor" href="#_implementing_the_tests"></a>Implementing the tests</h5>
<div class="paragraph">
<p>If you want your tests to actually do anything, you will also need 
classes in which you place your JBehave step implementations. If you 
place these in any package at or below the package of your main JUnit 
test, JBehave will find them with no extra configuration.</p>
</div>
<div class="paragraph">
<p>Serenity makes no distinction between the JBehave-style @Given, @When
 and @Then annotations, and the Serenity-style @Step annotations: both 
will appear in the test reports. However you need to start with the  
@Given, @When and @Then-annotated methods so that JBehave can find the 
correct methods to call for your stories. A method annotated with 
@Given, @When or @Then can call Serenity @Step methods, or call page 
objects directly (though the extra level of abstraction provided by the 
@Step methods tends to make the tests more reusable and maintainable on 
larger projects).</p>
</div>
<div class="paragraph">
<p>A typical example is shown below. In this implementation of one of 
the scenarios we saw above, the high-level steps are defined using 
methods annotated with the JBehave @Given, @When and @Then annotations. 
These methods, in turn, use steps that are implemented in the BuyerSteps
 class, which contains a set of Serenity @Step methods. The advantage of
 using this two-leveled approach is that it helps maintain a degree of 
separation between the definition of what is being done in a test, and 
how it is being implemented. This tends to make the tests easier to 
understand and easier to maintain.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">net.serenitybdd.samples.etsy.features.steps</span>;

<span class="keyword">import</span> <span class="include">net.serenitybdd.samples.etsy.features.model.ListingItem</span>;
<span class="keyword">import</span> <span class="include">net.serenitybdd.samples.etsy.features.steps.serenity.BuyerSteps</span>;
<span class="keyword">import</span> <span class="include">net.serenitybdd.core.Serenity</span>;
<span class="keyword">import</span> <span class="include">net.serenitybdd.samples.etsy.features.model.SessionVariables</span>;
<span class="keyword">import</span> <span class="include">net.thucydides.core.annotations.Steps</span>;
<span class="keyword">import</span> <span class="include">org.jbehave.core.annotations.Given</span>;
<span class="keyword">import</span> <span class="include">org.jbehave.core.annotations.Then</span>;
<span class="keyword">import</span> <span class="include">org.jbehave.core.annotations.When</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">ShoppingCartStepDefinitions</span> {
    <span class="annotation">@Steps</span>
    BuyerSteps buyer;

    <span class="annotation">@Given</span>(<span class="string"><span class="delimiter">"</span><span class="content">I have selected an item</span><span class="delimiter">"</span></span>)
    <span class="annotation">@When</span>(<span class="string"><span class="delimiter">"</span><span class="content">I select an item</span><span class="delimiter">"</span></span>)
    <span class="directive">public</span> <span class="type">void</span> selectsAnItem() {
        buyer.selects_item_number(<span class="integer">1</span>);
    }

    <span class="annotation">@When</span>(<span class="string"><span class="delimiter">"</span><span class="content">I add the item to the shopping cart</span><span class="delimiter">"</span></span>)
    <span class="directive">public</span> <span class="type">void</span> addCurrentItemToShoppingCart() {
        buyer.selects_any_product_variations();
        buyer.adds_current_item_to_shopping_cart();
    }

    <span class="annotation">@Then</span>(<span class="string"><span class="delimiter">"</span><span class="content">the item should appear in the cart</span><span class="delimiter">"</span></span>)
    <span class="directive">public</span> <span class="type">void</span> shouldSeeSelectedItemInCart() {
        ListingItem selectedItem = (ListingItem) Serenity.sessionVariableCalled(SessionVariables.SELECTED_LISTING);
        buyer.should_see_item_in_cart(selectedItem);
    }

    <span class="annotation">@Then</span>(<span class="string"><span class="delimiter">"</span><span class="content">the shipping cost should be included in the total price</span><span class="delimiter">"</span></span>)
    <span class="directive">public</span> <span class="type">void</span> shouldIncludeShippingCost() {
        ListingItem selectedItem = (ListingItem) Serenity.sessionVariableCalled(SessionVariables.SELECTED_LISTING);
        buyer.should_see_total_including_shipping_for(selectedItem);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Serenity steps can be found in the BuyerSteps class. This class 
in turn uses Page Objects to interact with the actual web application, 
as illustrated here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">net.serenitybdd.samples.etsy.features.steps.serenity</span>;

<span class="keyword">import</span> <span class="include">com.google.common.base.Optional</span>;
<span class="keyword">import</span> <span class="include">net.serenitybdd.core.Serenity</span>;
<span class="keyword">import</span> <span class="include">net.serenitybdd.samples.etsy.features.model.ListingItem</span>;
<span class="keyword">import</span> <span class="include">net.serenitybdd.samples.etsy.features.model.OrderCostSummary</span>;
<span class="keyword">import</span> <span class="include">net.serenitybdd.samples.etsy.features.model.SessionVariables</span>;
<span class="keyword">import</span> <span class="include">net.serenitybdd.samples.etsy.pages.CartPage</span>;
<span class="keyword">import</span> <span class="include">net.serenitybdd.samples.etsy.pages.HomePage</span>;
<span class="keyword">import</span> <span class="include">net.serenitybdd.samples.etsy.pages.ItemDetailsPage</span>;
<span class="keyword">import</span> <span class="include">net.serenitybdd.samples.etsy.pages.SearchResultsPage</span>;
<span class="keyword">import</span> <span class="include">net.thucydides.core.annotations.Step</span>;
<span class="keyword">import</span> <span class="include">org.assertj.core.data.Offset</span>;
<span class="keyword">import</span> <span class="include">org.hamcrest.Matcher</span>;

<span class="keyword">import</span> <span class="include">java.util.List</span>;

<span class="keyword">import</span> <span class="include">static</span> <span class="include">org.assertj.core.api.Assertions.assertThat</span>;

<span class="comment">// tag::header[]</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">BuyerSteps</span> {
<span class="comment">// end::header[]</span>
<span class="comment">// tag::searchByKeywordSteps[]</span>

    HomePage homePage;                                          <i class="conum" data-value="1"></i><b>(1)</b>
    SearchResultsPage searchResultsPage;

    <span class="annotation">@Step</span>                                                       <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="directive">public</span> <span class="type">void</span> opens_etsy_home_page() {
        homePage.open();
    }

    <span class="annotation">@Step</span>
    <span class="directive">public</span> <span class="type">void</span> searches_for_items_containing(<span class="predefined-type">String</span> keywords) {
        homePage.searchFor(keywords);
    }

    <span class="annotation">@Step</span>
    <span class="directive">public</span> <span class="type">void</span> should_see_items_related_to(<span class="predefined-type">String</span> keywords) {
        <span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; resultTitles = searchResultsPage.getResultTitles();
        resultTitles.stream().forEach(title -&gt; assertThat(title.contains(keywords)));
    }
<span class="comment">// end::searchByKeywordSteps[]</span>
<span class="comment">// tag::filterByType[]</span>
    <span class="annotation">@Step</span>
    <span class="directive">public</span> <span class="type">void</span> filters_results_by_type(<span class="predefined-type">String</span> type) {
        searchResultsPage.filterByType(type);
    }

    <span class="directive">public</span> <span class="type">int</span> get_matching_item_count() {
        <span class="keyword">return</span> searchResultsPage.getItemCount();
    }

    <span class="annotation">@Step</span>
    <span class="directive">public</span> <span class="type">void</span> should_see_item_count(<span class="predefined-type">Matcher</span>&lt;<span class="predefined-type">Integer</span>&gt; itemCountMatcher) {
        itemCountMatcher.matches(searchResultsPage.getItemCount());
    }
<span class="comment">// end::filterByType[]</span>

    <span class="annotation">@Step</span>
    <span class="directive">public</span> <span class="type">void</span> selects_item_number(<span class="type">int</span> number) {
        ListingItem selectedItem = searchResultsPage.selectItem(number);
        Serenity.setSessionVariable(SessionVariables.SELECTED_LISTING).to(selectedItem);
    }

    <span class="annotation">@Step</span>
    <span class="directive">public</span> <span class="type">void</span> should_see_matching_details(<span class="predefined-type">String</span> searchTerm) {
        <span class="predefined-type">String</span> itemName = detailsPage.getItemName();
        assertThat(itemName.toLowerCase()).contains(searchTerm);
    }

    <span class="annotation">@Step</span>
    <span class="directive">public</span> <span class="type">void</span> should_see_items_of_type(<span class="predefined-type">String</span> type) {
        Optional&lt;<span class="predefined-type">String</span>&gt; selectedType = searchResultsPage.getSelectedType();
        assertThat(selectedType.isPresent()).describedAs(<span class="string"><span class="delimiter">"</span><span class="content">No item type was selected</span><span class="delimiter">"</span></span>).isTrue();
        assertThat(selectedType.get()).isEqualTo(type);
    }

    <span class="comment">// tag::shoppingCartSteps[]</span>

    ItemDetailsPage detailsPage;
    CartPage cartPage;

    <span class="annotation">@Step</span>
    <span class="directive">public</span> <span class="type">void</span> selects_any_product_variations() {
        detailsPage.getProductVariationIds().stream()
                .forEach(id -&gt; detailsPage.selectVariation(id,<span class="integer">2</span>));
    }

    <span class="annotation">@Step</span>
    <span class="directive">public</span> <span class="type">void</span> adds_current_item_to_shopping_cart() {
        detailsPage.addToCart();
    }

    <span class="annotation">@Step</span>
    <span class="directive">public</span> <span class="type">void</span> should_see_item_in_cart(ListingItem selectedItem) {
        assertThat(cartPage.getOrderCostSummaries()
                        .stream().anyMatch(order -&gt; order.getName().equals(selectedItem.getName()))).isTrue();
    }

    <span class="annotation">@Step</span>
    <span class="directive">public</span> <span class="type">void</span> should_see_total_including_shipping_for(ListingItem selectedItem) {
        OrderCostSummary orderCostSummary
                = cartPage.getOrderCostSummaryFor(selectedItem).get();

        <span class="type">double</span> itemTotal = orderCostSummary.getItemTotal();
        <span class="type">double</span> shipping = orderCostSummary.getShipping();
        <span class="type">double</span> totalCost = orderCostSummary.getTotalCost();

        assertThat(itemTotal).isEqualTo(selectedItem.getPrice());
        assertThat(shipping).isGreaterThan(<span class="float">0.0</span>);
        assertThat(totalCost).isCloseTo(itemTotal + shipping, Offset.offset(<span class="float">0.001</span>));
    }

    <span class="annotation">@Step</span>
    <span class="directive">public</span> <span class="type">void</span> filters_results_to_local_region() {
        searchResultsPage.filterByLocalRegion();
    }
    <span class="comment">// end::shoppingCartSteps[]</span>

<span class="comment">// tag::tail[]</span>
}
<span class="comment">//end:tail</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The Page Objects are similar to those you would find in any Serenity 
project, as well as most WebDriver projects. An example is listed below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">net.serenitybdd.samples.etsy.pages</span>;

<span class="keyword">import</span> <span class="include">net.serenitybdd.core.pages.PageObject</span>;
<span class="keyword">import</span> <span class="include">net.serenitybdd.core.annotations.findby.By</span>;
<span class="keyword">import</span> <span class="include">org.openqa.selenium.WebDriver</span>;
<span class="keyword">import</span> <span class="include">org.openqa.selenium.WebElement</span>;
<span class="keyword">import</span> <span class="include">org.openqa.selenium.interactions.Actions</span>;
<span class="keyword">import</span> <span class="include">org.openqa.selenium.support.FindAll</span>;
<span class="keyword">import</span> <span class="include">org.openqa.selenium.support.FindBy</span>;
<span class="keyword">import</span> <span class="include">org.openqa.selenium.support.FindBys</span>;
<span class="keyword">import</span> <span class="include">org.openqa.selenium.support.ui.ExpectedConditions</span>;
<span class="keyword">import</span> <span class="include">org.openqa.selenium.support.ui.Wait</span>;
<span class="keyword">import</span> <span class="include">org.openqa.selenium.support.ui.WebDriverWait</span>;

<span class="keyword">import</span> <span class="include">java.util.List</span>;

<span class="keyword">import</span> <span class="include">static</span> <span class="include">java.util.stream.Collectors.toList</span>;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">net.serenitybdd.samples.etsy.pages.Spinners.noSpinnerToBeVisible</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">ItemDetailsPage</span> <span class="directive">extends</span> PageObject {

    <span class="annotation">@FindBys</span>({<span class="annotation">@FindBy</span>(id=<span class="string"><span class="delimiter">"</span><span class="content">listing-page-cart</span><span class="delimiter">"</span></span>), <span class="annotation">@FindBy</span>(tagName = <span class="string"><span class="delimiter">"</span><span class="content">h1</span><span class="delimiter">"</span></span>)})
    WebElement itemName;

    <span class="directive">public</span> <span class="predefined-type">String</span> getItemName() {
        <span class="keyword">return</span> itemName.getText();
    }

    <span class="directive">public</span> <span class="predefined-type">String</span> getItemDescription() {
        <span class="keyword">return</span> <span class="error">$</span>(<span class="string"><span class="delimiter">"</span><span class="content">#description-text</span><span class="delimiter">"</span></span>).getText();
    }

    <span class="directive">public</span> <span class="type">void</span> addToCart() {
        withAction().moveToElement(<span class="error">$</span>(<span class="string"><span class="delimiter">"</span><span class="content">#item-tabs</span><span class="delimiter">"</span></span>)).perform();
        <span class="error">$</span>(<span class="string"><span class="delimiter">"</span><span class="content">.buy-button button</span><span class="delimiter">"</span></span>).click();
    }

    <span class="directive">public</span> <span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; getProductVariationIds() {
        <span class="keyword">return</span> findAll(<span class="string"><span class="delimiter">"</span><span class="content">.variation</span><span class="delimiter">"</span></span>)
                .stream()
                .map(elt -&gt; elt.getAttribute(<span class="string"><span class="delimiter">"</span><span class="content">id</span><span class="delimiter">"</span></span>))
                .filter(id -&gt; !id.isEmpty())
                .collect(toList());
    }

    <span class="directive">public</span> <span class="type">void</span> selectVariation(<span class="predefined-type">String</span> variationId, <span class="type">int</span> optionIndex) {
        find(By.id(variationId)).selectByIndex(optionIndex);
        <span class="keyword">if</span> (spinnerIsVisible()) {
            waitFor(noSpinnerToBeVisible());
        }
    }

    <span class="directive">private</span> <span class="type">boolean</span> spinnerIsVisible() {
        <span class="keyword">return</span> containsElements(<span class="string"><span class="delimiter">"</span><span class="content">.spinner-small</span><span class="delimiter">"</span></span>);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When these tests are executed, the JBehave steps combine with the 
Serenity steps to create a narrative report of the test results.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_comments_in_scenario"><a class="anchor" href="#_comments_in_scenario"></a>6.1.3. Comments in scenario</h4>
<div class="paragraph">
<p>In case if you use comments in scenario, Serenity will ignore a 
commented condition, but it will be displayed in the generated report 
like this:</p>
</div>
<div id="jbehave_comments_report" class="imageblock">
<div class="content">
<img src="The%20Serenity%20Reference%20Manual_files/jbehave_comments_report.png" alt="jbehave comments report">
</div>
<div class="title">Figure 14. Report with commented conditions in scenario</div>
</div>
<div class="paragraph">
<p>You can comment particular conditions or the whole scenario. Here are some examples for different cases.</p>
</div>
<div class="paragraph">
<p>Commenting one condition:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Narrative:
In order to provide some business value
As a user
I want to perform some simple action, but I commented then condition

Scenario: Single scenario with commented then condition
Given I have prepared environment for simple action one
When I perform "simple action one"
!-- Then I expect result for "simple action one" should be "success"</pre>
</div>
</div>
<div class="paragraph">
<p>Report:</p>
</div>
<div id="jbehave_one_condition_commented" class="imageblock">
<div class="content">
<img src="The%20Serenity%20Reference%20Manual_files/jbehave_one_condition_commented.png" alt="jbehave one condition commented">
</div>
<div class="title">Figure 15. Report with commented Then condition</div>
</div>
<div class="paragraph">
<p>Commenting all conditions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Narrative:
In order to provide some business value
As a user
I want to perform some simple action, but I commented all conditions

Scenario: Single scenario with all commented conditions
!-- Given I have prepared environment for simple action one
!-- When I perform "simple action one"
!-- Then I expect result for "simple action one" should be "success"</pre>
</div>
</div>
<div class="paragraph">
<p>Report:</p>
</div>
<div id="jbehave_all_conditions_commented" class="imageblock">
<div class="content">
<img src="The%20Serenity%20Reference%20Manual_files/jbehave_all_conditions_commented.png" alt="jbehave all conditions commented">
</div>
<div class="title">Figure 16. Report with commented all conditions</div>
</div>
<div class="paragraph">
<p>Commenting a whole scenario:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Narrative:
In order to provide some business value
As a user
I want to perform some simple action, but I commented scenario

!-- Scenario: Single commented scenario
!-- Given I have prepared environment for simple action one
!-- When I perform "simple action one"
!-- Then I expect result for "simple action one" should be "success"</pre>
</div>
</div>
<div class="paragraph">
<p>Report:</p>
</div>
<div id="jbehave_scenario_commented" class="imageblock">
<div class="content">
<img src="The%20Serenity%20Reference%20Manual_files/jbehave_scenario_commented.png" alt="jbehave scenario commented">
</div>
<div class="title">Figure 17. Report with commented scenario</div>
</div>
</div>
<div class="sect3">
<h4 id="_jbehave_maven_archetype"><a class="anchor" href="#_jbehave_maven_archetype"></a>6.1.4. JBehave Maven Archetype</h4>
<div class="paragraph">
<p>A jBehave archetype is availble to help you jumpstart a new project. 
As usual, you can run mvn archetype:generate from the command line and 
then select the net.thucydides.thucydides-jbehave-archetype archetype 
from the proposed list of archetypes. Or you can use your favorite IDE 
to generate a new Maven project using an archetype.</p>
</div>
<div class="paragraph">
<p>This archetype creates a project directory structure similar to the one shown here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>+ main
&nbsp;&nbsp;  + java
&nbsp;&nbsp;     + SampleJBehave
&nbsp;&nbsp;         + pages
&nbsp;&nbsp;         &nbsp;&nbsp;  - DictionaryPage.java
&nbsp;&nbsp;         + steps
&nbsp;&nbsp;             - EndUserSteps.java
+ test
    + java
    &nbsp;&nbsp; + SampleJBehave
    &nbsp;&nbsp;     + jbehave
    &nbsp;&nbsp;         - AcceptanceTestSuite.java
    &nbsp;&nbsp;         - DefinitionSteps.java
    + resources
        + SampleJBehave
            + stories
                + consult_dictionary
                    - LookupADefinition.story</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_running_all_tests_in_a_single_browser_window"><a class="anchor" href="#_running_all_tests_in_a_single_browser_window"></a>6.1.5. Running all tests in a single browser window</h4>
<div class="paragraph">
<p>All web tests for one story can be run in a single browser window using either by setting the <em>restart.browser.each.scenario</em>
 system property or programmatically using 
runSerenity().inASingleSession() inside the JUnit runner. It is default 
behaving - to run all scenarios in same story in one browser.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">net.serenitybdd.jbehave.SerenityStories</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">JBehaveTestCase</span> <span class="directive">extends</span> SerenityStories {
    <span class="directive">public</span> JBehaveTestCase() {
      runSerenity().inASingleSession();
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_serenity_with_cucumber"><a class="anchor" href="#_serenity_with_cucumber"></a>6.2. Serenity with Cucumber</h3>
<div class="paragraph">
<p><a href="http://cukes.info/">Cucumber</a> is a popular BDD test automation tool. <strong>Cucumber-JVM</strong>
 is the Java implementation of Cucumber, and is what we will be focusing
 on in this article. In Cucumber, you express acceptance criteria in a 
natural, human-readable form. For example, we could write the "wool 
scarf" example mentioned above like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="gherkin"> Given I want to buy a wool scarf
 When I search for items containing 'wool'
 Then I should only see items related to 'wool'</code></pre>
</div>
</div>
<div class="paragraph">
<p>This format is known as <em>Gherkin</em>, and is widely used in 
Cucumber and other Cucumber-based BDD tools such as SpecFlow (for .NET) 
and Behave (for Python). Gherkin is a flexible, highly readable format 
that can be written collaboratively with product owners to ensure that 
everyone . The loosely-structured <em>Given-When-Then</em> format helps people focus on what they are trying to achieve, and how they will know when they get it.</p>
</div>
<div class="paragraph">
<p>Sometimes tables can be used to summarize several different examples 
of the same scenario. In Gherkin, you can use example tables to do this.
 For instance, the following scenario illustrates how you can search for
 different types of products made of different materials:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="gherkin">  Scenario Outline: Filter by different item types
    Given I have searched for items containing '&lt;material&gt;'
    When I filter results by type '&lt;type&gt;'
    Then I should only see items containing '&lt;material&gt;' of type '&lt;type&gt;'
  Examples:
    | material | type           |
    | silk     | Handmade       |
    | bronze   | Vintage        |
    | wool     | Craft Supplies |</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_writing_executable_specifications_with_cucumber_and_serenity"><a class="anchor" href="#_writing_executable_specifications_with_cucumber_and_serenity"></a>6.2.1. Writing executable specifications with Cucumber and Serenity</h4>
<div class="paragraph">
<p>In Cucumber, scenarios are stored in <em>Feature Files</em>, which 
contain an overall description of a feature as well as a number of 
scenarios. The Feature File for the example above is called <code>search_by_keyword.feature</code>, and looks something like this like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="gherkin">Feature: Searching by keyword

  In order to find items that I would like to purchase
  As a potential buyer
  I want to be able to search for items containing certain words

  Scenario: Should list items related to a specified keyword
    Given I want to buy a wool scarf
    When I search for items containing 'wool'
    Then I should only see items related to 'wool'</code></pre>
</div>
</div>
<div class="paragraph">
<p>These feature files can be placed in different locations, but you can
 reduce the amount of configuration you need to do with Serenity if you 
put them in the <code>src/test/resources/features</code> directory.</p>
</div>
<div class="paragraph">
<p>You typically organize the feature files in sub-directories that 
reflect the higher-level requirements. In the following directory 
structure, for example, we have feature definitions for several 
higher-level features: <em>search</em> and <em>shopping_cart</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>|----src
| |----test
| | |----resources
| | | |----features
| | | | |----search
| | | | | |----search_by_keyword.feature
| | | | |----shopping_cart
| | | | | |----adding_items_to_the_shopping_cart.feature</pre>
</div>
</div>
<div class="paragraph">
<p>Another option is to place them in <code>src/test/resources', but 
underneath the same package name as your scenario runner class (see 
below). This requires slightly less configuration of the scenario runner
 class. However in this case, you need to specify the 
`thucydides.requirements.dir</code> property in your <code>serenity.properties</code> (or <code>thucydides.properties</code>) file to point to the root requirements directory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>thucydides.requirements.dir=src/test/resources/net/serenity_bdd/samples/etsy/features</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_the_scenario_runner"><a class="anchor" href="#_the_scenario_runner"></a>6.2.2. The Scenario Runner</h4>
<div class="paragraph">
<p>Cucumber runs the feature files via JUnit, and needs a dedicated test
 runner class to actually run the feature files. When you run the tests 
with Serenity, you use the <code>CucumberWithSerenity</code> test runner. If the feature files are not in the same package as the test runner class, you also need to use the <code>@CucumberOptions</code> class to provide the root directory where the feature files can be found. A simple test runner looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">net.serenity_bdd.samples.etsy.features</span>;

<span class="keyword">import</span> <span class="include">cucumber.api.CucumberOptions</span>;
<span class="keyword">import</span> <span class="include">net.serenitybdd.cucumber.CucumberWithSerenity</span>;
<span class="keyword">import</span> <span class="include">org.junit.runner.RunWith</span>;

<span class="annotation">@RunWith</span>(CucumberWithSerenity.class)
<span class="annotation">@CucumberOptions</span>(features=<span class="string"><span class="delimiter">"</span><span class="content">src/test/resources/features/search/search_by_keyword.feature</span><span class="delimiter">"</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">SearchByKeyword</span> {}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If your feature files are stored in or under the same package as your scenario runner class (in <code>src/test/resources</code>) as discussed in the previous section, then you don’t need to use <code>@CucumberOptions</code> to provide the root directory.</p>
</div>
</div>
<div class="sect3">
<h4 id="_step_definitions"><a class="anchor" href="#_step_definitions"></a>6.2.3. Step definitions</h4>
<div class="paragraph">
<p>In Cucumber, each line of the Gherkin scenario maps to a method in a Java class, known as a <em>Step Definition</em>. These use annotations like <code>@Given</code>, <code>@When</code> and <code>@Then</code>
 match lines in the scenario to Java methods. You define simple regular 
expressions to indicate parameters that will be passed into the methods:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">SearchByKeywordStepDefinitions</span> {
    <span class="annotation">@Steps</span>
    BuyerSteps buyer;

    <span class="annotation">@Given</span>(<span class="string"><span class="delimiter">"</span><span class="content">I want to buy (.*)</span><span class="delimiter">"</span></span>)
    <span class="directive">public</span> <span class="type">void</span> buyerWantsToBuy(<span class="predefined-type">String</span> article) {
        buyer.opens_etsy_home_page();
    }

    <span class="annotation">@When</span>(<span class="string"><span class="delimiter">"</span><span class="content">I search for items containing '(.*)'</span><span class="delimiter">"</span></span>)
    <span class="directive">public</span> <span class="type">void</span> searchByKeyword(<span class="predefined-type">String</span> keyword) {
        buyer.searches_for_items_containing(keyword);
    }

    <span class="annotation">@Then</span>(<span class="string"><span class="delimiter">"</span><span class="content">I should only see items related to '(.*)'</span><span class="delimiter">"</span></span>)
    <span class="directive">public</span> <span class="type">void</span> resultsForACategoryAndKeywordInARegion(<span class="predefined-type">String</span> keyword) {
        buyer.should_see_items_related_to(keyword);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>These step definitions use Serenity to organize the step definition code into more reusable components. The <code>@Steps</code>
 annotation tells Serenity that this variable is a Step Library. In 
Serenity, we use Step Libraries to add a layer of abstraction between 
the "what" and the "how" of our acceptance tests. The Cucumber step 
definitions describe "what" the acceptance test is doing, in fairly 
implementation-neutral, business-friendly terms. So we say "searches for
 items containing <em>'wool</em>", not "enters <em>'wool</em>' into the 
search field and clicks on the search button". This layered approach 
makes the tests both easier to understand and to maintain, and helps 
build up a great library of reusable business-level steps that we can 
use in other tests. Without this kind of layered approach, step 
definitions tend to become very technical very quickly, which limits 
reuse and makes them harder to understand and maintain.</p>
</div>
<div class="paragraph">
<p>Step definition files need to go in or underneath the package containing the scenario runners:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>|----src
| |----test
| | |----java
| | | |----net
| | | | |----serenity_bdd
| | | | | |----samples
| | | | | | |----etsy
| | | | | | | |----features                                    <i class="conum" data-value="1"></i><b>(1)</b>
| | | | | | | | |----AcceptanceTests.java                      <i class="conum" data-value="2"></i><b>(2)</b>
| | | | | | | | |----steps                                     <i class="conum" data-value="3"></i><b>(3)</b>
| | | | | | | | | |----SearchByKeywordStepDefinitions.java
| | | | | | | | | |----serenity                                <i class="conum" data-value="4"></i><b>(4)</b>
| | | | | | | | | | |----BuyerSteps.java</pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The scenario runner package</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>A scenario runner</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Step definitions for the scenario runners</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Serenity Step Libraries are placed in a different sub-package</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="_serenity_step_libraries_and_page_objects"><a class="anchor" href="#_serenity_step_libraries_and_page_objects"></a>6.2.4. Serenity Step Libraries and Page Objects</h4>
<div class="paragraph">
<p>Both scenario step libraries (annotated with the <code>@Steps</code> annotation) and Page Objects that are declared inside the Cucumber step definition classes will be automatically instantiated.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_serenity_with_junit"><a class="anchor" href="#_serenity_with_junit"></a>7. Serenity with JUnit</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this section we will look at how to run your Serenity tests using JUnit in more detail.</p>
</div>
<div class="sect2">
<h3 id="_basic_junit_integration"><a class="anchor" href="#_basic_junit_integration"></a>7.1. Basic JUnit integration</h3>
<div class="paragraph">
<p>We have already seen a simple example of a JUnit Serenity test shown earlier on (<a href="#first-steps">First Steps with Serenity BDD</a>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@RunWith</span>(SerenityRunner.class)                                                          <i class="conum" data-value="1"></i><b>(1)</b>
<span class="directive">public</span> <span class="type">class</span> <span class="class">WhenCalculatingFrequentFlyerPoints</span> {

    <span class="annotation">@Steps</span>                                                                              <i class="conum" data-value="2"></i><b>(2)</b>
    TravellerSteps travellerSteps;

    <span class="annotation">@Test</span>
    <span class="directive">public</span> <span class="type">void</span> shouldCalculatePointsBasedOnDistance() {
        <span class="comment">// GIVEN</span>
        travellerSteps.a_traveller_has_a_frequent_flyer_account_with_balance(<span class="integer">10000</span>);    <i class="conum" data-value="3"></i><b>(3)</b>

        <span class="comment">// WHEN</span>
        travellerSteps.the_traveller_flies(<span class="integer">1000</span>);                                       <i class="conum" data-value="3"></i><b>(3)</b>

        <span class="comment">// THEN</span>
        travellerSteps.traveller_should_have_a_balance_of(<span class="integer">10100</span>);                       <i class="conum" data-value="3"></i><b>(3)</b>

    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>You run the JUnit test using the <em>Serenity</em> test runner</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>@Steps</code> annotation marks a Serenity step library</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The most important thing here is the <em>SerenityRunner</em> test 
runner. This class instruments any step libraries in your class, and 
ensures that the test results will be recorded and reported on by the 
Serenity reporters.</p>
</div>
</div>
<div class="sect2">
<h3 id="_human_readable_method_titles"><a class="anchor" href="#_human_readable_method_titles"></a>7.2. Human-readable method titles</h3>
<div class="paragraph">
<p>By default, Serenity will convert the test method names into a 
readable form in the reports. This will convert both camelCasedMethods 
and methods_with_underscores into a form with spaces. So both <em>shouldCalculateCorrectOutcome()</em> and <em>should_calculate_correct_outcome()</em> will appear as "Should calculate correct outcome" in the test reports.</p>
</div>
<div class="paragraph">
<p>You can override this convention by adding a <code>@Title</code> annotation onto the test method, as shown here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@RunWith</span>(SerenityRunner.class)
<span class="directive">public</span> <span class="type">class</span> <span class="class">WhenEarningFrequentFlyerStatus</span> {

    <span class="annotation">@Steps</span>
    TravellerStatusSteps travellerSteps;

    <span class="annotation">@Test</span>
    <span class="annotation">@Title</span>(<span class="string"><span class="delimiter">"</span><span class="content">Members earn Gold status after 5000 points (50000 km)</span><span class="delimiter">"</span></span>)         <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="directive">public</span> <span class="type">void</span> earnGoldAfter5000Points() {
        <span class="comment">// GIVEN</span>
        travellerSteps.a_traveller_joins_the_frequent_flyer_program();

        <span class="comment">// WHEN</span>
        travellerSteps.the_traveller_flies(<span class="integer">50000</span>);

        <span class="comment">// THEN</span>
        travellerSteps.traveller_should_have_a_status_of(Gold);
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>@Title</code> annotation lets you provide your own title for this test in the test reports</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Also <code>@Title</code> can be used for providing information about issues for this test, you can find more info in <a href="#_linking_scenarios_tests_with_issues">Linking scenarios/tests with issues</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_serenity_webdriver_support_in_junit"><a class="anchor" href="#_serenity_webdriver_support_in_junit"></a>7.3. Serenity WebDriver support in JUnit</h3>
<div class="paragraph">
<p>Serenity BDD also provides strong support for Selenium WebDriver and 
the Page Objects model. We will look at these features in detail later 
on. But while we are on the topic of JUnit integration, let’s look at 
how this integration fits in with a JUnit Serenity test.</p>
</div>
<div class="paragraph">
<p>Serenity will manage your WebDriver instance, including opening the 
appropriate driver at the start of each test, and shutting it down when 
the test is finished. You just need to provide a <em>WebDriver</em> variable in your test, as shown here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@RunWith</span>(SerenityRunner.class)
<span class="directive">public</span> <span class="type">class</span> <span class="class">WhenSearchingOnGoogle</span> {

    <span class="annotation">@Managed</span>                                                                <i class="conum" data-value="1"></i><b>(1)</b>
    WebDriver driver;

    <span class="annotation">@Test</span>
    <span class="directive">public</span> <span class="type">void</span> shouldInstantiateAWebDriverInstanceForAWebTest() {
        driver.get(<span class="string"><span class="delimiter">"</span><span class="content">http://www.google.com</span><span class="delimiter">"</span></span>);                                <i class="conum" data-value="2"></i><b>(2)</b>

        driver.findElement(By.name(<span class="string"><span class="delimiter">"</span><span class="content">q</span><span class="delimiter">"</span></span>)).sendKeys(<span class="string"><span class="delimiter">"</span><span class="content">firefly</span><span class="delimiter">"</span></span>, Keys.ENTER);

        <span class="keyword">new</span> WebDriverWait(driver,<span class="integer">5</span>).until(titleContains(<span class="string"><span class="delimiter">"</span><span class="content">Google Search</span><span class="delimiter">"</span></span>));

        assertThat(driver.getTitle()).isEqualTo(<span class="string"><span class="delimiter">"</span><span class="content">firefly - Google Search</span><span class="delimiter">"</span></span>);
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Declare a WebDriver instance that will be managed by Serenity</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The WebDriver instance will be initialized automatically</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The <code>@Managed</code> annotation also provides several useful parameters. The <em>driver</em> parameter lets you define what WebDriver driver you want to run these tests in. Possible values include <em>firefox</em>, <em>chrome</em>,<em>iexplorer</em>,<em>phantomjs</em>, and <em>htmlunit</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Managed</span>(driver=<span class="string"><span class="delimiter">"</span><span class="content">chrome</span><span class="delimiter">"</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Default value for <code>driver</code> is <code>""</code>, and Serenity BDD will use Firefox in this case. List of supported drivers by this annotation: <strong>Firefox</strong>, <strong>Chrome</strong>, <strong>Opera</strong>, <strong>HtmlUnit</strong>, <strong>PhantomJS</strong>, <strong>IExplorer</strong>, <strong>Edge</strong>, <strong>Safari</strong>, <strong>Appium</strong>.</p>
</div>
<div class="paragraph">
<p>You can also get Serenity to open the browser at the start of the 
tests, and leave it open until all of the tests in this test case have 
been executed, using the <em>uniqueSession</em> parameter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Managed</span>(uniqueSession=<span class="predefined-constant">true</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Default value for <code>uniqueSession</code> is <code>false</code></p>
</div>
<div class="paragraph">
<p>To make Serenity BDD clear cookies for each test or never clear cookies you can use property <code>clearCookies</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Managed</span>(clearCookies=BeforeEachTest)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Default value for <code>clearCookies</code> is <code>BeforeEachTest</code>, possible values are: <strong>BeforeEachTest</strong>, <strong>Never</strong>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_serenity_pageobjects_in_junit"><a class="anchor" href="#_serenity_pageobjects_in_junit"></a>7.4. Serenity PageObjects in JUnit</h3>
<div class="paragraph">
<p>The WebDriver test in the previous example will work, but it is poorly written for a number of reasons as below:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In particular, it exposes too much WebDriver-specific details about 
how the test is executed, which as a result obscures the intent of the 
test</p>
</li>
<li>
<p>It will also be harder to maintain, as it contains WebDriver logic that would be repeated and maintained in other tests</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A better approach is to hide the WebDriver logic in "Page Objects". 
Serenity provides excellent built-in support for Page Objects, as we 
will learn in the chapter dedicated to Serenity WebDriver support (<a href="#_writing_serenity_page_objects">Writing Serenity Page Objects</a>).</p>
</div>
<div class="paragraph">
<p>The JUnit Serenity integration provides some special support for 
Serenity Page Objects. In particular, Serenity will automatically 
instantiate any PageObject fields in your JUnit test. For example, the 
following Page Object would perform the same operations as the test 
shown above:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">net.serenitybdd.samples.junit.pages</span>;

<span class="keyword">import</span> <span class="include">net.thucydides.core.annotations.DefaultUrl</span>;
<span class="keyword">import</span> <span class="include">net.thucydides.core.pages.PageObject</span>;
<span class="keyword">import</span> <span class="include">org.openqa.selenium.Keys</span>;
<span class="keyword">import</span> <span class="include">org.openqa.selenium.WebElement</span>;
<span class="keyword">import</span> <span class="include">org.openqa.selenium.support.FindBy</span>;

<span class="keyword">import</span> <span class="include">static</span> <span class="include">org.openqa.selenium.support.ui.ExpectedConditions.titleContains</span>;

<span class="annotation">@DefaultUrl</span>(<span class="string"><span class="delimiter">"</span><span class="content">http://www.google.com</span><span class="delimiter">"</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">GooglePage</span> <span class="directive">extends</span> PageObject {

    <span class="annotation">@FindBy</span>(name=<span class="string"><span class="delimiter">"</span><span class="content">q</span><span class="delimiter">"</span></span>)
    WebElement search;

    <span class="directive">public</span> <span class="type">void</span> searchFor(<span class="predefined-type">String</span> keywords) {
        search.sendKeys(keywords, Keys.ENTER);
        waitFor(titleContains(<span class="string"><span class="delimiter">"</span><span class="content">Google Search</span><span class="delimiter">"</span></span>));
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, when you declare a field of type <em>GooglePage</em> in your test, Serenity will instatiate it for you:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@RunWith</span>(SerenityRunner.class)
<span class="directive">public</span> <span class="type">class</span> <span class="class">WhenSearchingOnGoogle</span> {

    <span class="annotation">@Managed</span>                                                                <i class="conum" data-value="1"></i><b>(1)</b>
    WebDriver driver;

    GooglePage googlePage;

    <span class="annotation">@Test</span>
    <span class="directive">public</span> <span class="type">void</span> shouldInstantiatedPageObjectsForAWebTest() {

        googlePage.open();

        googlePage.searchFor(<span class="string"><span class="delimiter">"</span><span class="content">firefly</span><span class="delimiter">"</span></span>);

        assertThat(googlePage.getTitle()).isEqualTo(<span class="string"><span class="delimiter">"</span><span class="content">firefly - Google Search</span><span class="delimiter">"</span></span>);
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_skipping_tests"><a class="anchor" href="#_skipping_tests"></a>7.5. Skipping tests</h3>
<div class="paragraph">
<p>Sometimes it can be useful to flag a test as "work-in-progress". In Serenity, you use the <code>@Pending</code> annotation, either for a test or for a <code>@Step</code>-annotated method, to incidate that the scenario is still being implemented and that the results should. These tests appear as <em>Pending</em> (shown in blue) in the test reports.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@RunWith</span>(SerenityRunner.class)
<span class="directive">public</span> <span class="type">class</span> <span class="class">WhenEarningFrequentFlyerStatus</span> {

    <span class="annotation">@Steps</span>
    TravellerStatusSteps travellerSteps;

    <span class="annotation">@Test</span>
    <span class="annotation">@Pending</span>
    <span class="directive">public</span> <span class="type">void</span> dropsBackToSilverIfLessThan8000PointsEarnedInAYear() {
    }

    <span class="annotation">@Test</span>
    <span class="annotation">@Ignore</span>
    <span class="directive">public</span> <span class="type">void</span> earnPlatinumAfter10000Points() {
        <span class="comment">// GIVEN</span>
        travellerSteps.a_traveller_joins_the_frequent_flyer_program();

        <span class="comment">// WHEN</span>
        travellerSteps.the_traveller_flies(<span class="integer">500000</span>);

        <span class="comment">// THEN</span>
        travellerSteps.traveller_should_have_a_status_of(Platinum);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As can be seen here, Serenity also honors the JUnit <code>@Ignore</code> annotation. Tests marked with <code>@Ignore</code> will appear as <em>Ignored</em> (shown in grey) in the test reports.</p>
</div>
<div id="fig-ignored-tests" class="imageblock">
<div class="content">
<img src="The%20Serenity%20Reference%20Manual_files/junit-ignored-and-pending-tests.png" alt="junit ignored and pending tests">
</div>
<div class="title">Figure 18. A test report showing ignored (yellow) and pending (blue) tests</div>
</div>
</div>
<div class="sect2">
<h3 id="_handling_failing_assumptions"><a class="anchor" href="#_handling_failing_assumptions"></a>7.6. Handling failing assumptions</h3>
<div class="paragraph">
<p>Sometimes it can be useful to define a pre-condition for a test. For 
example, suppose a series of integration tests depend on a mainframe 
server being running. If the mainframe is unavailable (for example, if 
it only runs during office hours), you may want to ignore these tests 
entirely. The test might look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@RunWith</span>(SerenityRunner.class)
<span class="directive">public</span> <span class="type">class</span> <span class="class">WhenUpdatingMemberAccounts</span> {

    <span class="annotation">@Steps</span>
    TravellerHistorySteps travellerSteps;

    <span class="annotation">@Test</span>
    <span class="directive">public</span> <span class="type">void</span> shouldFetchFlightHistoryFromMainframe() {
        <span class="comment">// ASSUMPTION</span>
        travellerSteps.assuming_the_mainframe_is_available();

        <span class="comment">// WHEN</span>
        travellerSteps.we_fetch_the_latest_flight_history_for_a_traveller();

        <span class="comment">// THEN</span>
        travellerSteps.traveller_should_see_the_latest_flights();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The assumption is encapsulated in the <code>assuming_the_mainframe_is_available()</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">static</span> <span class="include">org.hamcrest.Matchers.is</span>;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">org.junit.Assume.assumeThat</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">TravellerHistorySteps</span> <span class="directive">extends</span> ScenarioSteps {
    <span class="annotation">@Step</span>
    <span class="directive">public</span> <span class="type">void</span> assuming_the_mainframe_is_available() {
        assumeThat(mainframe(), is(ONLINE));                        <i class="conum" data-value="1"></i><b>(1)</b>
    }

    <span class="directive">private</span> MainframeStatus mainframe() {
        <span class="keyword">return</span> OFFLINE;                                             <i class="conum" data-value="2"></i><b>(2)</b>
    }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Ensure that the mainframe is available</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Do whatever needs to be done to check the availability of the mainframe</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The <code>assuming_the_mainframe_is_available()</code> method uses 
the JUnit Assume class, which behaves in a very similar way to Hamcrest 
matchers. If this check fails, the test will not be executed, and the 
test result will be reported as <em>Ignored</em>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_data_driven_tests"><a class="anchor" href="#_data_driven_tests"></a>7.7. Data-driven tests</h3>
<div class="paragraph">
<p>Serenity provides some features to support simplified Data-Driven 
testing. In JUnit 4, you can use the Parameterized test runner to 
perform data-driven tests. In Serenity, you use the 
SerenityParameterizedRunner. This runner is very similar to the JUnit 
Parameterized test runner, except that you use the <code>@TestData</code> annotation to provide test data, and you can use all of the other Serenity annotations (<code>@Managed</code>, <code>@Steps</code> and so on). This test runner will also generate proper serenity reports for the executed tests.</p>
</div>
<div class="paragraph">
<p>An example of a data-driven Serenity test is shown below. In this 
test, we check the number of status points a Frequent Flyer member needs
 to obtain a new status. To test this, we use several combinations of 
points and status levels, specified by the testData() method. These 
values are represented as instance variables in the test class, and 
instantiated via the constructor.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@RunWith</span>(SerenityParameterizedRunner.class)
<span class="directive">public</span> <span class="type">class</span> <span class="class">WhenEarningFrequentFlyerStatusUpgrades</span> {

    <span class="annotation">@TestData</span>                                                   <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="directive">public</span> <span class="directive">static</span> <span class="predefined-type">Collection</span>&lt;<span class="predefined-type">Object</span><span class="type">[]</span>&gt; testData(){
        <span class="keyword">return</span> <span class="predefined-type">Arrays</span>.asList(<span class="keyword">new</span> <span class="predefined-type">Object</span><span class="type">[]</span><span class="type">[]</span>{
                {<span class="integer">0</span>,     Bronze},
                {<span class="integer">9999</span>,  Bronze},
                {<span class="integer">10000</span>, Silver},
                {<span class="integer">49999</span>, Silver},
                {<span class="integer">50000</span>, Gold}
        });
    }

    <span class="directive">private</span> <span class="directive">final</span> <span class="type">int</span> kilometersTravelled;                      <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="directive">private</span> <span class="directive">final</span> Status expectedStatus;                        <i class="conum" data-value="2"></i><b>(2)</b>

    <span class="directive">public</span> WhenEarningFrequentFlyerStatusUpgrades(<span class="type">int</span> kilometersTravelled, <i class="conum" data-value="3"></i><b>(3)</b>
                                                  Status expectedStatus) { <i class="conum" data-value="3"></i><b>(3)</b>
        <span class="local-variable">this</span>.kilometersTravelled = kilometersTravelled;
        <span class="local-variable">this</span>.expectedStatus = expectedStatus;
    }

    <span class="annotation">@Steps</span>
    TravellerStatusSteps travellerSteps;

    <span class="annotation">@Test</span>
    <span class="directive">public</span> <span class="type">void</span> shouldEarnNextStatusWithEnoughPoints() {                <i class="conum" data-value="4"></i><b>(4)</b>
        <span class="comment">// GIVEN</span>
        travellerSteps.a_traveller_joins_the_frequent_flyer_program();

        <span class="comment">// WHEN</span>
        travellerSteps.the_traveller_flies(kilometersTravelled);

        <span class="comment">// THEN</span>
        travellerSteps.traveller_should_have_a_status_of(expectedStatus);
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Test data</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The test data is injected into these member variables</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>You need a constructor with the parameters in the correct order for this to work.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Then use these member variables to perform your test</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>For slow-running tests, you may be able to speed up your tests using the <code>@Concurrent</code> annotation, as shown here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@RunWith</span>(SerenityParameterizedRunner.class)
<span class="annotation">@Concurrent</span>                                                 <i class="conum" data-value="1"></i><b>(1)</b>
<span class="directive">public</span> <span class="type">class</span> <span class="class">WhenSearchingForDifferentTermsOnGoogle</span> {

    <span class="annotation">@Managed</span>(driver = <span class="string"><span class="delimiter">"</span><span class="content">chrome</span><span class="delimiter">"</span></span>)
    WebDriver driver;

    GooglePage googlePage;

    <span class="annotation">@TestData</span>                                               <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="directive">public</span> <span class="directive">static</span> <span class="predefined-type">Collection</span>&lt;<span class="predefined-type">Object</span><span class="type">[]</span>&gt; testData(){
        <span class="keyword">return</span> <span class="predefined-type">Arrays</span>.asList(<span class="keyword">new</span> <span class="predefined-type">Object</span><span class="type">[]</span><span class="type">[]</span>{
                {<span class="string"><span class="delimiter">"</span><span class="content">cats</span><span class="delimiter">"</span></span>},
                {<span class="string"><span class="delimiter">"</span><span class="content">dogs</span><span class="delimiter">"</span></span>},
                {<span class="string"><span class="delimiter">"</span><span class="content">ferrets</span><span class="delimiter">"</span></span>},
                {<span class="string"><span class="delimiter">"</span><span class="content">rabbits</span><span class="delimiter">"</span></span>},
                {<span class="string"><span class="delimiter">"</span><span class="content">canaries</span><span class="delimiter">"</span></span>}
        });
    }

    <span class="directive">private</span> <span class="directive">final</span> <span class="predefined-type">String</span> searchTerm;                        <i class="conum" data-value="3"></i><b>(3)</b>

    <span class="directive">public</span> WhenSearchingForDifferentTermsOnGoogle(<span class="predefined-type">String</span> searchTerm) {
        <span class="local-variable">this</span>.searchTerm = searchTerm;
    }

    <span class="annotation">@Test</span>
    <span class="directive">public</span> <span class="type">void</span> shouldInstantiatedPageObjectsForADataDrivenWebTest() {

        googlePage.open();

        googlePage.searchFor(searchTerm);

        assertThat(googlePage.getTitle()).isEqualTo(searchTerm + <span class="string"><span class="delimiter">"</span><span class="content"> - Google Search</span><span class="delimiter">"</span></span>);
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Run these tests in parallel</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Use test data from this method</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Inject test data into this field through the constructor</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>By default, this will run your tests concurrently, by default using 
two threads per CPU core. If you want to fine-tune the number of threads
 to be used, you can specify the threads annotation property.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@RunWith</span>(SerenityParameterizedRunner.class)
<span class="annotation">@Concurrent</span>(threads=<span class="string"><span class="delimiter">"</span><span class="content">4</span><span class="delimiter">"</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also express this as a value relative to the number of 
available processors. For example, to run 4 threads per CPU, you could 
specify the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@RunWith</span>(SerenityParameterizedRunner.class)
<span class="annotation">@Concurrent</span>(threads=<span class="string"><span class="delimiter">"</span><span class="content">4x</span><span class="delimiter">"</span></span>)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_using_test_data_from_csv_files"><a class="anchor" href="#_using_test_data_from_csv_files"></a>7.8. Using test data from CSV files</h3>
<div class="paragraph">
<p>Serenity lets you perform data-driven testing using test data in a 
CSV file. You store your test data in a CSV file (by default with 
columns separated by commas), with the first column acting as a header:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="csv">KILOMETERS TRAVELLED,   EXPECTED STATUS
0,                      Bronze
9999,                   Bronze
10000,                  Silver
49999,                  Silver
50000,                  Gold</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next, create a test class containing properties that match the 
columns in the test data, as you did for the data-driven test in the 
previous example. The test class will typically contain one or more 
tests that use these properties as parameters to the test step or Page 
Object methods.</p>
</div>
<div class="paragraph">
<p>The class will also contain the <code>@UseTestDataFrom</code> 
annotation to indicate where to find the CSV file (this can either be a 
file on the classpath or a relative or absolute file path - putting the 
data set on the class path (e.g. in <code>src/test/resources</code>) makes the tests more portable).</p>
</div>
<div class="paragraph">
<p>An example of a test running against the CSV data listed above is shown here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@RunWith</span>(SerenityParameterizedRunner.class)
<span class="annotation">@UseTestDataFrom</span>(value=<span class="string"><span class="delimiter">"</span><span class="content">testdata/status-levels.csv</span><span class="delimiter">"</span></span>)                <i class="conum" data-value="1"></i><b>(1)</b>
<span class="directive">public</span> <span class="type">class</span> <span class="class">WhenEarningFrequentFlyerStatusUpgradesUsingCSV</span> {

    <span class="directive">private</span> <span class="type">int</span> kilometersTravelled;
    <span class="directive">private</span> Status expectedStatus;

    <span class="directive">public</span> <span class="type">void</span> setKilometersTravelled(<span class="type">int</span> kilometersTravelled) {
        <span class="local-variable">this</span>.kilometersTravelled = kilometersTravelled;
    }

    <span class="directive">public</span> <span class="type">void</span> setExpectedStatus(<span class="predefined-type">String</span> expectedStatus) {
        <span class="local-variable">this</span>.expectedStatus = Status.valueOf(expectedStatus);
    }

    <span class="annotation">@Qualifier</span>
    <span class="directive">public</span> <span class="predefined-type">String</span> qualifier() {
        <span class="keyword">return</span> kilometersTravelled + <span class="string"><span class="delimiter">"</span><span class="content">=&gt;</span><span class="delimiter">"</span></span> + expectedStatus;
    }
    <span class="annotation">@Steps</span>
    TravellerStatusSteps travellerSteps;

    <span class="annotation">@Test</span>
    <span class="directive">public</span> <span class="type">void</span> reallyhouldEarnNextStatusWithEnoughPoints() {
        <span class="comment">// GIVEN</span>
        travellerSteps.a_traveller_joins_the_frequent_flyer_program();

        <span class="comment">// WHEN</span>
        travellerSteps.the_traveller_flies(kilometersTravelled);

        <span class="comment">// THEN</span>
        travellerSteps.traveller_should_have_a_status_of(expectedStatus);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also specify multiple file paths separated by path separators – colon, semi-colon or comma. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@UseTestDataFrom</span>(<span class="string"><span class="delimiter">"</span><span class="content">test-data/simple-data.csv,test-data-subfolder/simple-data.csv</span><span class="delimiter">"</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also configure an arbitrary directory using system property serenity.data.dir and then refer to it as <code>$DATADIR</code> variable in the annotation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@UseTestDataFrom</span>(<span class="string"><span class="delimiter">"</span><span class="content">$DATADIR/simple-data.csv</span><span class="delimiter">"</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Each row of test data needs to be distinguished in the generated 
reports. By default, Serenity will call the toString() method. If you 
provide a public method returning a String that is annotated by the <code>@Qualifier</code> annotation, then this method will be used to distinguish data sets. It should return a value that is unique to each data set.</p>
</div>
<div class="paragraph">
<p>The test runner will create a new instance of this class for each row
 of data in the CSV file, assigning the properties with corresponding 
values in the test data.</p>
</div>
<div class="paragraph">
<p>There are a few points to note. The columns in the CSV files are converted to camel-case property names (so for example <code>KILOMETERS TRAVELLED</code> becomes <code>kilometersTravelled</code>). All of the fields should be strings or primitive types.</p>
</div>
<div class="paragraph">
<p>If some of the field values contain commas, you will need to use a 
different separator. You can use the separator attribute of the <code>@UseTestDataFrom</code> annotation to specify an alternative separator.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@UseTestDataFrom</span>(value=<span class="string"><span class="delimiter">"</span><span class="content">test-data/simple-semicolon-data.csv</span><span class="delimiter">"</span></span>, separator=<span class="string"><span class="delimiter">'</span><span class="content">;</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_modelling_requirements_in_junit"><a class="anchor" href="#_modelling_requirements_in_junit"></a>7.9. Modelling requirements in JUnit</h3>
<div class="paragraph">
<p>As we have seen previously, Serenity produces reports that summarize 
the test results, going into details about the steps that were executed 
within each test. Serenity also produces an overall list of the test 
results, as shown below:</p>
</div>
<div id="fig-test-report" class="imageblock">
<div class="content">
<img src="The%20Serenity%20Reference%20Manual_files/junit-overall-test-results.png" alt="junit overall test results">
</div>
<div class="title">Figure 19. Test results reported in Serenity</div>
</div>
<div class="paragraph">
<p>But Serenity also lets you group your tests in terms of features or 
user stories, in order to get a better high-level picture of the state 
of your application. The <em>Requirements</em> tab provides a high-level overview of your requirements.</p>
</div>
<div class="paragraph">
<p>For this to work, you need to organize your JUnit tests into 
meaningful packages. For example, you might group create packages for 
high-level features, and group your test cases by feature. By default, a
 test case is considered to represent a User Story in agile terms, and 
the tests within the test case correspond to the acceptance criteria for
 that user story.</p>
</div>
<div id="fig-test-report" class="imageblock">
<div class="content">
<img src="The%20Serenity%20Reference%20Manual_files/junit-feature-report.png" alt="junit feature report">
</div>
<div class="title">Figure 20. Test cases can be grouped by high level features</div>
</div>
<div class="paragraph">
<p>Serenity uses the test package structure to discover the requirements
 organization. For example, suppose your package structure looks like 
this:</p>
</div>
<div id="fig-test-package-structure" class="imageblock">
<div class="content">
<img src="The%20Serenity%20Reference%20Manual_files/junit-overall-test-results.png" alt="junit overall test results">
</div>
<div class="title">Figure 21. Test results reported in Serenity</div>
</div>
<div class="paragraph">
<p>In this structure, the test cases are organized by feature, in a number of directories under the <code>features</code> parent directory.</p>
</div>
<div class="paragraph">
<p>For this to work properly, you need to tell Serenity the root package
 that you are using, and what terms you use for your requirements. You 
do this in a special file called <code>serenity.properties</code>, which lives in the root directory of your project, e.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="properties">serenity.test.root=net.serenitybdd.samples.junit.features</code></pre>
</div>
</div>
<div class="paragraph">
<p>The way Serenity will report your requirements depends on the depth 
of the directory structure you use to store your requirements. By 
default, if you group your test cases in a single level of directories 
(as in the example above), Serenity will treat each directory as a <code>feature</code>. If there are two levels, the first level directories will be considered <code>capabilities</code>, and the second <code>features</code>.</p>
</div>
<div class="paragraph">
<p>You can define your own way of naming your requirements using the <code>serenity.requirement.types</code>
 property. For example, if you wanted top-level directories to represent
 "themes", and have a second level "epics" that actually contains the 
test cases, you could set this property to the following value:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="properties">serenity.requirement.types=theme,epic</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can provide extra information about stories and requirements in several ways. One is to use the <code>@Narrative</code> annotation in the test case, as shown here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Narrative</span>(text={<span class="string"><span class="delimiter">"</span><span class="content">In order to choose the best flight for my travels</span><span class="delimiter">"</span></span>,                      <i class="conum" data-value="1"></i><b>(1)</b>
                 <span class="string"><span class="delimiter">"</span><span class="content">As a traveller</span><span class="delimiter">"</span></span>,
                 <span class="string"><span class="delimiter">"</span><span class="content">I want to be able to search for flights between specific destinations</span><span class="delimiter">"</span></span>})
<span class="annotation">@RunWith</span>(SerenityRunner.class)
<span class="directive">public</span> <span class="type">class</span> <span class="class">WhenSearchingFlights</span> {

    <span class="annotation">@Managed</span>(driver = <span class="string"><span class="delimiter">"</span><span class="content">chrome</span><span class="delimiter">"</span></span>)
    WebDriver driver;

    <span class="annotation">@Steps</span>
    FlightSearchSteps theCustomer;

    <span class="annotation">@Test</span>
    <span class="directive">public</span> <span class="type">void</span> should_display_selected_flight_details() {
        <span class="comment">// GIVEN</span>
        theCustomer.searches_for_flights_between(<span class="string"><span class="delimiter">"</span><span class="content">Sydney</span><span class="delimiter">"</span></span>, <span class="string"><span class="delimiter">"</span><span class="content">London</span><span class="delimiter">"</span></span>);
        <span class="comment">// WHEN</span>
        theCustomer.view_flight_details_for_flight(<span class="integer">1</span>);
        <span class="comment">// THEN</span>
        theCustomer.should_see_the_destination_city_in_the_summary();
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A narrative text, represented as an array of Strings</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>This will produce a report like the following:</p>
</div>
<div id="fig-test-report-with-narrative" class="imageblock">
<div class="content">
<img src="The%20Serenity%20Reference%20Manual_files/story-with-narrative.png" alt="story with narrative">
</div>
<div class="title">Figure 22. The <code>@Narrative</code> annotation lets you add a narrative text to story reports</div>
</div>
<div class="paragraph">
<p>You can also add the <code>@Narrative</code> annotation to a <code>package-info.java</code> file. This will add a narrative to the requirement represented by this package in the requirements reports, e.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Narrative</span>(
        text = {<span class="string"><span class="delimiter">"</span><span class="content">Search-related functionality</span><span class="delimiter">"</span></span>}
)
<span class="keyword">package</span> <span class="namespace">net.serenitybdd.samples.junit.features.searching</span>;

<span class="keyword">import</span> <span class="include">net.thucydides.core.annotations.Narrative</span>;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_writing_serenity_page_objects"><a class="anchor" href="#_writing_serenity_page_objects"></a>8. Writing Serenity Page Objects</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you are working with WebDriver web tests, you will be familiar 
with the concept of Page Objects. Page Objects are a way of isolating 
the implementation details of a web page inside a class, exposing only 
business-focused methods related to that page. They are an excellent way
 of making your web tests more maintainable.</p>
</div>
<div class="paragraph">
<p>In Serenity, page objects can be just ordinary WebDriver page 
objects, on the condition that they have a constructor that accepts a 
WebDriver parameter. However, the Serenity <code>PageObject</code> class
 provides a number of utility methods that make page objects more 
convenient to work with, so a Serenity Page Object generally extends 
this class.</p>
</div>
<div class="paragraph">
<p>Here is a simple example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DefaultUrl</span>(<span class="string"><span class="delimiter">"</span><span class="content">http://localhost:9000/somepage</span><span class="delimiter">"</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">FindAJobPage</span> <span class="directive">extends</span> PageObject {

    WebElementFacade keywords;
    WebElementFacade searchButton;

    <span class="directive">public</span> FindAJobPage(WebDriver driver) {
        <span class="local-variable">super</span>(driver);
    }

    <span class="directive">public</span> <span class="type">void</span> look_for_jobs_with_keywords(<span class="predefined-type">String</span> values) {
        typeInto(keywords, values);
        searchButton.click();
    }

    <span class="directive">public</span> <span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; getJobTabs() {
        <span class="predefined-type">List</span>&lt;WebElementFacade&gt; tabs = findAll(<span class="string"><span class="delimiter">"</span><span class="content">//div[@id='tabs']//a</span><span class="delimiter">"</span></span>);
        <span class="keyword">return</span> extract(tabs, on(WebElement.class).getText());
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>typeInto</code> method is a shorthand that simply clears a 
field and enters the specified text. If you prefer a more fluent-API 
style, you can also do something like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DefaultUrl</span>(<span class="string"><span class="delimiter">"</span><span class="content">http://localhost:9000/somepage</span><span class="delimiter">"</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">FindAJobPage</span> <span class="directive">extends</span> PageObject {
        WebElementFacade keywordsField;
        WebElementFacade searchButton;

        <span class="directive">public</span> FindAJobPage(WebDriver driver) {
            <span class="local-variable">super</span>(driver);
        }

        <span class="directive">public</span> <span class="type">void</span> look_for_jobs_with_keywords(<span class="predefined-type">String</span> values) {
            **enter(values).into(keywordsField);**
            searchButton.click();
        }

        <span class="directive">public</span> <span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; getJobTabs() {
            <span class="predefined-type">List</span>&lt;WebElementFacade&gt; tabs = findAll(<span class="string"><span class="delimiter">"</span><span class="content">//div[@id='tabs']//a</span><span class="delimiter">"</span></span>);
            <span class="keyword">return</span> extract(tabs, on(WebElement.class).getText());
        }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can use an even more fluent style of expressing the implementation steps by using  methods like <code>find</code>, <code>findBy</code>  and <code>then</code>.</p>
</div>
<div class="paragraph">
<p>For example, you can use webdriver "By" finders with element name, id, css selector or xpath selector as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">find(By.name(<span class="string"><span class="delimiter">"</span><span class="content">demo</span><span class="delimiter">"</span></span>)).then(By.name(<span class="string"><span class="delimiter">"</span><span class="content">specialField</span><span class="delimiter">"</span></span>)).getValue();

find(By.cssSelector(<span class="string"><span class="delimiter">"</span><span class="content">.foo</span><span class="delimiter">"</span></span>)).getValue();

find(By.xpath(<span class="string"><span class="delimiter">"</span><span class="content">//th</span><span class="delimiter">"</span></span>)).getValue();</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>findBy</code> method lets you pass the css or xpath selector directly to WebDriver. For example,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">findBy(<span class="string"><span class="delimiter">"</span><span class="content">#demo</span><span class="delimiter">"</span></span>).then(<span class="string"><span class="delimiter">"</span><span class="content">#specialField</span><span class="delimiter">"</span></span>).getValue(); <span class="comment">//css selectors</span>

findBy(<span class="string"><span class="delimiter">"</span><span class="content">//div[@id='dataTable']</span><span class="delimiter">"</span></span>).getValue(); <span class="comment">//xpath selector</span></code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_using_pages_in_a_step_library"><a class="anchor" href="#_using_pages_in_a_step_library"></a>8.1. Using pages in a step library</h3>
<div class="paragraph">
<p>When you need to use a page object in one of your steps, you just 
need to declare a variable of type PageObject in your step library,  
e.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">FindAJobPage page;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you want to make sure you are on the right page, you can use the <code>currentPageAt()</code> method. This will check the page class for any <code>@At</code>
 annotations present in the Page Object class and, if present, check 
that the current URL corresponds to the URL pattern specified in the 
annotation. For example, when you invoke it using <code>currentPageAt()</code>, the following Page Object will check that the current URL is precisely <a href="http://www.apache.org/" class="bare">http://www.apache.org</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@At</span>(<span class="string"><span class="delimiter">"</span><span class="content">http://www.apache.org</span><span class="delimiter">"</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">ApacheHomePage</span> <span class="directive">extends</span> PageObject {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>@At</code> annotation also supports wildcards and regular expressions. The following page object will match any Apache sub-domain:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@At</span>(<span class="string"><span class="delimiter">"</span><span class="content">http://.*.apache.org</span><span class="delimiter">"</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">AnyApachePage</span> <span class="directive">extends</span> PageObject {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>More generally, however, you are more interested in what comes after the host name. You can use the special <code>#HOST</code> token to match any server name. So the following Page Object will match both <a href="http://localhost:8080/app/action/login.form" class="bare">http://localhost:8080/app/action/login.form</a> an <a href="http://staging.acme.com/app/action/login.form" class="bare">http://staging.acme.com/app/action/login.form</a>. It will also ignore parameters, so <a href="http://staging.acme.com/app/action/login.form?username=toto&amp;password=oz" class="bare">http://staging.acme.com/app/action/login.form?username=toto&amp;password=oz</a> will work fine too.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@At</span>(urls={<span class="string"><span class="delimiter">"</span><span class="content">#HOST/app/action/login.form</span><span class="delimiter">"</span></span>})
<span class="directive">public</span> <span class="type">class</span> <span class="class">LoginPage</span> <span class="directive">extends</span> PageObject {
   ...
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_opening_the_page"><a class="anchor" href="#_opening_the_page"></a>8.2. Opening the page</h3>
<div class="paragraph">
<p>A page object is usually designed to work with a particular web page. When the <code>open()</code> method is invoked, the browser will be opened to the default URL for the page.</p>
</div>
<div class="paragraph">
<p>The <code>@DefaultUrl</code> annotation indicates the URL that this 
test should use when run in isolation (e.g. from within your IDE). 
Generally, however, the host part of the default URL will be overridden 
by the <code>webdriver.base.url</code> property, as this allows you to 
set the base URL across the board for all of your tests, and so makes it
 easier to run your tests on different environments by simply changing 
this property value. For example, in the test class above, setting the <code>webdriver.base.url</code> to <em><a href="https://staging.mycompany.com/" class="bare">https://staging.mycompany.com</a></em> would result in the page being opened at the URL of <em><a href="https://staging.mycompany.com/somepage" class="bare">https://staging.mycompany.com/somepage</a></em>.</p>
</div>
<div class="paragraph">
<p>You can also define named URLs that can be used to open the web page,
 optionally with parameters. For example, in the following code, we 
define a URL called <em>open.issue</em>, that accepts a single parameter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DefaultUrl</span>(<span class="string"><span class="delimiter">"</span><span class="content">http://jira.mycompany.org</span><span class="delimiter">"</span></span>)
<span class="annotation">@NamedUrls</span>(
  {
    <span class="annotation">@NamedUrl</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">open.issue</span><span class="delimiter">"</span></span>, url = <span class="string"><span class="delimiter">"</span><span class="content">http://jira.mycompany.org/issues/{1}</span><span class="delimiter">"</span></span>)
  }
)
<span class="directive">public</span> <span class="type">class</span> <span class="class">JiraIssuePage</span> <span class="directive">extends</span> PageObject {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You could then open this page to the <a href="http://jira.mycompany.org/issues/ISSUE-1" class="bare">http://jira.mycompany.org/issues/ISSUE-1</a> URL as shown here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">page.open(<span class="string"><span class="delimiter">"</span><span class="content">open.issue</span><span class="delimiter">"</span></span>, withParameters(<span class="string"><span class="delimiter">"</span><span class="content">ISSUE-1</span><span class="delimiter">"</span></span>));</code></pre>
</div>
</div>
<div class="paragraph">
<p>You could also dispense entirely with the base URL in the named URL definition, and rely on the default values:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DefaultUrl</span>(<span class="string"><span class="delimiter">"</span><span class="content">http://jira.mycompany.org</span><span class="delimiter">"</span></span>)
<span class="annotation">@NamedUrls</span>(
  {
    <span class="annotation">@NamedUrl</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">open.issue</span><span class="delimiter">"</span></span>, url = <span class="string"><span class="delimiter">"</span><span class="content">/issues/{1}</span><span class="delimiter">"</span></span>)
  }
)
<span class="directive">public</span> <span class="type">class</span> <span class="class">JiraIssuePage</span> <span class="directive">extends</span> PageObject {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>And naturally you can define more than one definition:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@NamedUrls</span>(
  {
          <span class="annotation">@NamedUrl</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">open.issue</span><span class="delimiter">"</span></span>, url = <span class="string"><span class="delimiter">"</span><span class="content">/issues/{1}</span><span class="delimiter">"</span></span>),
          <span class="annotation">@NamedUrl</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">close.issue</span><span class="delimiter">"</span></span>, url = <span class="string"><span class="delimiter">"</span><span class="content">/issues/close/{1}</span><span class="delimiter">"</span></span>)
  }
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>You should never try to implement the <code>open()</code> method 
yourself. In fact, it is final. If you need your page to do something 
upon loading, such as waiting for a dynamic element to appear, you can 
use the @WhenPageOpens annotation. Methods in the PageObject with this 
annotation will be invoked (in an unspecified order) after the URL has 
been opened. In this example, the <code>open()</code> method will not return until the dataSection web element is visible:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DefaultUrl</span>(<span class="string"><span class="delimiter">"</span><span class="content">http://localhost:8080/client/list</span><span class="delimiter">"</span></span>)
    <span class="directive">public</span> <span class="type">class</span> <span class="class">ClientList</span> <span class="directive">extends</span> PageObject {

     <span class="annotation">@FindBy</span>(id=<span class="string"><span class="delimiter">"</span><span class="content">data-section</span><span class="delimiter">"</span></span>);
     WebElement dataSection;
     ...

     <span class="annotation">@WhenPageOpens</span>
     <span class="directive">public</span> <span class="type">void</span> waitUntilTitleAppears() {
         element(dataSection).waitUntilVisible();
     }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_working_with_web_elements"><a class="anchor" href="#_working_with_web_elements"></a>8.3. Working with web elements</h3>
<div class="sect3">
<h4 id="_checking_whether_elements_are_visible"><a class="anchor" href="#_checking_whether_elements_are_visible"></a>8.3.1. Checking whether elements are visible</h4>
<div class="paragraph">
<p>The WebElementFacade class convenient fluent API for dealing with web
 elements, providing some commonly-used extra features that are not 
provided out-of-the-box by the WebDriver API. WebElementFacades are 
largely interchangeable with WebElements: you just declare a variable of
 type <code>WebElementFacade</code> instead of type <code>WebElement</code>. For example, you can check that an element is visible as shown here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">FindAJobPage</span> <span class="directive">extends</span> PageObject {

    WebElementFacade searchButton;

    <span class="directive">public</span> <span class="type">boolean</span> searchButtonIsVisible() {
        <span class="keyword">return</span> searchButton.isVisible();
    }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the button is not present on the screen, the test will wait for a 
short period in case it appears due to some Ajax magic. If you don’t 
want the test to do this, you can use the faster version:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">boolean</span> searchButtonIsVisibleNow() {
    <span class="keyword">return</span> searchButton.isCurrentlyVisible();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can turn this into an assert by using the <code>shouldBeVisible()</code> method instead:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">void</span> checkThatSearchButtonIsVisible() {
    searchButton.shouldBeVisible();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This method will through an assertion error if the search button is not visible to the end user.</p>
</div>
<div class="paragraph">
<p>If you are happy to expose the fact that your page has a search 
button to your step methods, you can make things even simpler by adding 
an accessor method that returns a WebElementState, as shown here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> WebElementState searchButton() {
    <span class="keyword">return</span> element(searchButton);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then your steps will contain code like the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">        searchPage.searchButton().shouldBeVisible();</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_checking_whether_elements_are_enabled"><a class="anchor" href="#_checking_whether_elements_are_enabled"></a>8.3.2. Checking whether elements are enabled</h4>
<div class="paragraph">
<p>You can also check whether an element is enabled or not:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>searchButton.isEnabled()
searchButton.shouldBeEnabled()</pre>
</div>
</div>
<div class="paragraph">
<p>There are also equivalent negative methods:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>searchButton.shouldNotBeVisible();
searchButton.shouldNotBeCurrentlyVisible();
searchButton.shouldNotBeEnabled()</pre>
</div>
</div>
<div class="paragraph">
<p>You can also check for elements that are present on the page but not visible, e.g:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>searchButton.isPresent();
searchButton.isNotPresent();
searchButton.shouldBePresent();
searchButton.shouldNotBePresent();</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_manipulating_select_lists"><a class="anchor" href="#_manipulating_select_lists"></a>8.3.3. Manipulating select lists</h4>
<div class="paragraph">
<p>There are also helper methods available for drop-down lists. Suppose you have the following dropdown on your page:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;select</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">color</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;option</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">"</span><span class="content">red</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>Red<span class="tag">&lt;/option&gt;</span>
    <span class="tag">&lt;option</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">"</span><span class="content">blue</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>Blue<span class="tag">&lt;/option&gt;</span>
    <span class="tag">&lt;option</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">"</span><span class="content">green</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>Green<span class="tag">&lt;/option&gt;</span>
<span class="tag">&lt;/select&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You could write a page object to manipulate this dropdown as shown here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">FindAJobPage</span> <span class="directive">extends</span> PageObject {

        <span class="annotation">@FindBy</span>(id=<span class="string"><span class="delimiter">"</span><span class="content">color</span><span class="delimiter">"</span></span>)
        WebElementFacade colorDropdown;

        <span class="directive">public</span> selectDropdownValues() {
            colorDropdown.selectByVisibleText(<span class="string"><span class="delimiter">"</span><span class="content">Blue</span><span class="delimiter">"</span></span>);
            assertThat(colorDropdown.getSelectedVisibleTextValue(), is(<span class="string"><span class="delimiter">"</span><span class="content">Blue</span><span class="delimiter">"</span></span>));

            colorDropdown.selectByValue(<span class="string"><span class="delimiter">"</span><span class="content">blue</span><span class="delimiter">"</span></span>);
            assertThat(colorDropdown.getSelectedValue(), is(<span class="string"><span class="delimiter">"</span><span class="content">blue</span><span class="delimiter">"</span></span>));

            colorDropdown.selectByIndex(<span class="integer">2</span>);
            assertThat(colorDropdown.getSelectedValue(), is(<span class="string"><span class="delimiter">"</span><span class="content">green</span><span class="delimiter">"</span></span>));

        }
        ...
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_determining_focus"><a class="anchor" href="#_determining_focus"></a>8.3.4. Determining focus</h4>
<div class="paragraph">
<p>You can determine whether a given field has the focus as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>firstName.hasFocus()</pre>
</div>
</div>
<div class="paragraph">
<p>You can also wait for elements to appear, disappear, or become enabled or disabled:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>button.waitUntilEnabled()
button.waitUntilDisabled()</pre>
</div>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="listingblock">
<div class="content">
<pre>field.waitUntilVisible()
button.waitUntilNotVisible()</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_using_direct_xpath_and_css_selectors"><a class="anchor" href="#_using_direct_xpath_and_css_selectors"></a>8.3.5. Using direct XPath and CSS selectors</h4>
<div class="paragraph">
<p>Another way to access a web element is to use an XPath or CSS expression. You can use the <code>$()</code>
 method with an XPath expression to do this more simply. For example, 
imagine your web application needs to click on a list item containing a 
given post code. One way would be as shown here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">WebElement selectedSuburb = getDriver().findElement(By.xpath(<span class="string"><span class="delimiter">"</span><span class="content">//li/a[contains(.,'</span><span class="delimiter">"</span></span> + postcode + <span class="string"><span class="delimiter">"</span><span class="content">')]</span><span class="delimiter">"</span></span>));
selectedSuburb.click();</code></pre>
</div>
</div>
<div class="paragraph">
<p>However, a simpler option would be to do this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="error">$</span>(<span class="string"><span class="delimiter">"</span><span class="content">//li/a[contains(.,'</span><span class="delimiter">"</span></span> + postcode + <span class="string"><span class="delimiter">"</span><span class="content">')]</span><span class="delimiter">"</span></span>).click();</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_working_with_asynchronous_pages"><a class="anchor" href="#_working_with_asynchronous_pages"></a>8.4. Working with Asynchronous Pages</h3>
<div class="paragraph">
<p>Asynchronous pages are those whose fields or data is not all 
displayed when the page is loaded. Sometimes, you need to wait for 
certain elements to appear, or to disappear, before being able to 
proceed with your tests. Serenity provides some handy methods in the 
PageObject base class to help with these scenarios. They are primarily 
designed to be used as part of your business methods in your page 
objects, though in the examples we will show them used as external calls
 on a PageObject instance for clarity.</p>
</div>
<div class="sect3">
<h4 id="_checking_whether_an_element_is_visible"><a class="anchor" href="#_checking_whether_an_element_is_visible"></a>8.4.1. Checking whether an element is visible</h4>
<div class="paragraph">
<p>In WebDriver terms, there is a distinction between when an element is
 present on the screen (i.e. in the HTML source code), and when it is 
rendered (i.e. visible to the user). You may also need to check whether 
an element is visible on the screen. You can do this in two ways. Your 
first option is to use the isElementVisible method, which returns a 
boolean value based on whether the element is rendered (visible to the 
user) or not:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">isElementVisible(By.xpath(<span class="string"><span class="delimiter">"</span><span class="content">//h2[.='A visible title']</span><span class="delimiter">"</span></span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p>Your second option is to actively assert that the element should be visible:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">shouldBeVisible(By.xpath(<span class="string"><span class="delimiter">"</span><span class="content">//h2[.='An invisible title']</span><span class="delimiter">"</span></span>));</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the element does not appear immediately, you can wait for it to appear:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">waitForRenderedElements(By.xpath(<span class="string"><span class="delimiter">"</span><span class="content">//h2[.='A title that is not immediately visible']</span><span class="delimiter">"</span></span>));</code></pre>
</div>
</div>
<div class="paragraph">
<p>An alternative to the above syntax is to use the more fluid <code>waitFor</code> method which takes a css or xpath selector as argument:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">waitFor(<span class="string"><span class="delimiter">"</span><span class="content">#popup</span><span class="delimiter">"</span></span>); <span class="comment">//css selector</span>

waitFor(<span class="string"><span class="delimiter">"</span><span class="content">//h2[.='A title that is not immediately visible']</span><span class="delimiter">"</span></span>); <span class="comment">//xpath selector</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If you just want to check if the element is present though not necessarily visible, you can use <code>waitForRenderedElementsToBePresent</code> :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">waitForRenderedElementsToBePresent(By.xpath(<span class="string"><span class="delimiter">"</span><span class="content">//h2[.='A title that is not immediately visible']</span><span class="delimiter">"</span></span>));</code></pre>
</div>
</div>
<div class="paragraph">
<p>or its more expressive flavour, <code>waitForPresenceOf</code> which takes a css or xpath selector as argument.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">waitForPresenceOf(<span class="string"><span class="delimiter">"</span><span class="content">#popup</span><span class="delimiter">"</span></span>); <span class="comment">//css</span>

waitForPresenceOf(<span class="string"><span class="delimiter">"</span><span class="content">//h2[.='A title that is not immediately visible']</span><span class="delimiter">"</span></span>); <span class="comment">//xpath</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also wait for an element to disappear by using <code>waitForRenderedElementsToDisappear</code> or <code>waitForAbsenceOf</code> :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">waitForRenderedElementsToDisappear(By.xpath(<span class="string"><span class="delimiter">"</span><span class="content">//h2[.='A title that will soon disappear']</span><span class="delimiter">"</span></span>));

waitForAbsenceOf(<span class="string"><span class="delimiter">"</span><span class="content">#popup</span><span class="delimiter">"</span></span>);

waitForAbsenceOf(<span class="string"><span class="delimiter">"</span><span class="content">//h2[.='A title that will soon disappear']</span><span class="delimiter">"</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>For simplicity, you can also use the <code>waitForTextToAppear</code> and <code>waitForTextToDisappear</code> methods:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">waitForTextToDisappear(<span class="string"><span class="delimiter">"</span><span class="content">A visible bit of text</span><span class="delimiter">"</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>If several possible texts may appear, you can use <code>waitForAnyTextToAppear</code> or <code>waitForAllTextToAppear</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">waitForAnyTextToAppear(<span class="string"><span class="delimiter">"</span><span class="content">this might appear</span><span class="delimiter">"</span></span>,<span class="string"><span class="delimiter">"</span><span class="content">or this</span><span class="delimiter">"</span></span>, <span class="string"><span class="delimiter">"</span><span class="content">or even this</span><span class="delimiter">"</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you need to wait for one of several possible elements to appear, you can also use the <code>waitForAnyRenderedElementOf</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">waitForAnyRenderedElementOf(By.id(<span class="string"><span class="delimiter">"</span><span class="content">color</span><span class="delimiter">"</span></span>), By.id(<span class="string"><span class="delimiter">"</span><span class="content">taste</span><span class="delimiter">"</span></span>), By.id(<span class="string"><span class="delimiter">"</span><span class="content">sound</span><span class="delimiter">"</span></span>));</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_working_with_timeouts"><a class="anchor" href="#_working_with_timeouts"></a>8.5. Working with timeouts</h3>
<div class="paragraph">
<p>Modern AJAX-based web applications add a great deal of complexity to 
web testing. The basic problem is, when you access a web element on a 
page, it may not be available yet. So you need to wait a bit. Indeed, 
many tests contain hard-coded pauses scattered through the code to cater
 for this sort of thing.</p>
</div>
<div class="paragraph">
<p>But hard-coded waits are evil. They slow down your test suite, and 
cause them to fail randomly if they are not long enough. Rather, you 
need to wait for a particular state or event. Selenium provides great 
support for this, and Serenity builds on this support to make it easier 
to use.</p>
</div>
<div class="sect3">
<h4 id="_implicit_waits"><a class="anchor" href="#_implicit_waits"></a>8.5.1. Implicit Waits</h4>
<div class="paragraph">
<p>The first way you can manage how WebDriver handles tardy fields is to
 use the  webdriver.timeouts.implicitlywait property. This determines 
how long, in milliseconds, WebDriver will wait if an element it tries to
 access is not present on the page. To quote the WebDriver 
documentation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>“An implicit wait is to tell WebDriver to poll the DOM for a certain amount of time when trying to find an element or elements if they are not immediately available.”</pre>
</div>
</div>
<div class="paragraph">
<p>The default value in Serenity for this property is currently 2 
seconds. This is different from standard WebDriver, where the default is
 zero.</p>
</div>
<div class="paragraph">
<p>Let’s look at an example. Suppose we have a PageObject with a field defined like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@FindBy</span>(id=<span class="string"><span class="delimiter">"</span><span class="content">slow-loader</span><span class="delimiter">"</span></span>)
<span class="directive">public</span> WebElementFacade slowLoadingField;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This field takes a little while to load, so won’t be ready immediately on the page.</p>
</div>
<div class="paragraph">
<p>Now suppose we set the webdriver.timeouts.implicitlywait value to 5000, and that our test uses the slowLoadingField:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">boolean</span> loadingFinished = slowLoadingField.isDisplayed()</code></pre>
</div>
</div>
<div class="paragraph">
<p>When we access this field, two things can happen. If the field takes 
less than 5 seconds to load, all will be good. But if it takes more than
 5 seconds, a NoSuchElementException (or something similar) will be 
thrown.</p>
</div>
<div class="paragraph">
<p>That this timeout also applies for lists. Suppose we have defined a field like this, which takes some time to dynamically load:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@FindBy</span>(css=<span class="string"><span class="delimiter">"</span><span class="content">#elements option</span><span class="delimiter">"</span></span>)
<span class="directive">public</span> <span class="predefined-type">List</span>&lt;WebElementFacade&gt; elementItems;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now suppose we count the values of the element like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">int</span> itemCount = elementItems.size()</code></pre>
</div>
</div>
<div class="paragraph">
<p>The number of items returned will depend on the implicit wait value. 
If we set the webdriver.timeouts.implicitlywait value to a very small 
value, WebDriver may only load some of the values. But if we give the 
list enough time to load completely, we will get the full list.</p>
</div>
<div class="paragraph">
<p>The implicit wait value is set globally for each WebDriver instance, 
but you can override the value yourself. The simplest way to do this 
from within a Serenity PageObject is to use the setImplicitTimeout() 
method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">setImplicitTimeout(<span class="integer">5</span>, SECONDS)</code></pre>
</div>
</div>
<div class="paragraph">
<p>But remember this is a global configuration, so will also affect 
other page objects. So once you are done, you should always reset the 
implicit timeout to its previous value. Serenity gives you a handy 
method to do this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">resetImplicitTimeout()</code></pre>
</div>
</div>
<div class="paragraph">
<p>See <a href="http://docs.seleniumhq.org/docs/04_webdriver_advanced.jsp#implicit-waits">Selenium Documentation</a> for more details on how the WebDriver implicit waits work.</p>
</div>
</div>
<div class="sect3">
<h4 id="_explicit_timeouts"><a class="anchor" href="#_explicit_timeouts"></a>8.5.2. Explicit Timeouts</h4>
<div class="paragraph">
<p>You can also wait until an element is in a particular state. For example, we could wait until a field becomes visible:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">slowLoadingField.waitUntilVisible()</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also wait for more arbitrary conditions, e.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">waitFor(ExpectedConditions.alertIsPresent())</code></pre>
</div>
</div>
<div class="paragraph">
<p>The default time that Serenity will wait is determined by the 
webdriver.wait.for.timeout property. The default value for this property
 is 5 seconds.</p>
</div>
<div class="paragraph">
<p>Sometimes you want to give WebDriver some more time for a specific 
operation. From within a PageObject, you can override or extend the 
implicit timeout by using the withTimeoutOf() method. For example, you 
could wait for the #elements list to load for up to 5 seconds like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">withTimeoutOf(<span class="integer">5</span>, SECONDS).waitForPresenceOf(By.cssSelector(<span class="string"><span class="delimiter">"</span><span class="content">#elements option</span><span class="delimiter">"</span></span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also specify the timeout for a field. For example, if you 
wanted to wait for up to 5 seconds for a button to become clickable 
before clicking on it, you could do the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">someButton.withTimeoutOf(<span class="integer">5</span>, SECONDS).waitUntilClickable().click()</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also use this approach to retrieve elements:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">elements = withTimeoutOf(<span class="integer">5</span>, SECONDS).findAll(<span class="string"><span class="delimiter">"</span><span class="content">#elements option</span><span class="delimiter">"</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, if a specific element a PageObject needs to have a bit more 
time to load, you can use the timeoutInSeconds attribute in the Serenity
 @FindBy annotation, e.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">net.serenitybdd.core.annotations.findby.FindBy</span>;
...
<span class="annotation">@FindBy</span>(name = <span class="string"><span class="delimiter">"</span><span class="content">country</span><span class="delimiter">"</span></span>, timeoutInSeconds=<span class="string"><span class="delimiter">"</span><span class="content">10</span><span class="delimiter">"</span></span>)
<span class="directive">public</span> WebElementFacade country;</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also wait for an element to be in a particular state, and 
then perform an action on the element. Here we wait for an element to be
 clickable before clicking on the element:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">addToCartButton.withTimeoutOf(<span class="integer">5</span>, SECONDS).waitUntilClickable().click()</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or, you can wait directly on a web element:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@FindBy</span>(id=<span class="string"><span class="delimiter">"</span><span class="content">share1-fb-like</span><span class="delimiter">"</span></span>)
WebElementFacade facebookIcon;
  ...
public WebElementState facebookIcon() {
    <span class="keyword">return</span> withTimeoutOf(<span class="integer">5</span>, <span class="predefined-type">TimeUnit</span>.SECONDS).waitFor(facebookIcon);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or even:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">List</span>&lt;WebElementFacade&gt; currencies = withTimeoutOf(<span class="integer">5</span>, <span class="predefined-type">TimeUnit</span>.SECONDS)
                              .waitFor(currencyTab)
                              .thenFindAll(<span class="string"><span class="delimiter">"</span><span class="content">.currency-code</span><span class="delimiter">"</span></span>);</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_executing_javascript"><a class="anchor" href="#_executing_javascript"></a>8.6. Executing Javascript</h3>
<div class="paragraph">
<p>There are times when you may find it useful to execute a little 
Javascript directly within the browser to get the job done. You can use 
the <code>evaluateJavascript()</code> method of the <code>PageObject</code>
 class to do this. For example, you might need to evaluate an expression
 and use the result in your tests. The following command will evaluate 
the document title and return it to the calling Java code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">String</span> result = (<span class="predefined-type">String</span>) evaluateJavascript(<span class="string"><span class="delimiter">"</span><span class="content">return document.title</span><span class="delimiter">"</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, you may just want to execute a Javascript command 
locally in the browser. In the following code, for example, we set the 
focus to the <em>firstname</em> input field:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">        evaluateJavascript(<span class="string"><span class="delimiter">"</span><span class="content">document.getElementById('firstname').focus()</span><span class="delimiter">"</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>And, if you are familiar with JQuery, you can also invoke JQuery expressions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">        evaluateJavascript(<span class="string"><span class="delimiter">"</span><span class="content">$('#firstname').focus()</span><span class="delimiter">"</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is often a useful strategy if you need to trigger events such as
 mouse-overs that are not currently supported by the WebDriver API.</p>
</div>
</div>
<div class="sect2">
<h3 id="_uploading_files"><a class="anchor" href="#_uploading_files"></a>8.7. Uploading files</h3>
<div class="paragraph">
<p>Uploading files is easy. Files to be uploaded can be either placed in
 a hard-coded location (bad) or stored on the classpath (better). Here 
is a simple example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">NewCompanyPage</span> <span class="directive">extends</span> PageObject {
    ...
    <span class="annotation">@FindBy</span>(id=<span class="string"><span class="delimiter">"</span><span class="content">object_logo</span><span class="delimiter">"</span></span>)
    WebElementFacade logoField;

    <span class="directive">public</span> NewCompanyPage(WebDriver driver) {
        <span class="local-variable">super</span>(driver);
    }

    <span class="directive">public</span> <span class="type">void</span> loadLogoFrom(<span class="predefined-type">String</span> filename) {
        upload(filename).to(logoField);
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_using_fluent_matcher_expressions"><a class="anchor" href="#_using_fluent_matcher_expressions"></a>8.8. Using Fluent Matcher expressions</h3>
<div class="paragraph">
<p>When writing acceptance tests, you often find yourself expressing 
expectations about individual domain objects or collections of domain 
objects. For example, if you are testing a multi-criteria search 
feature, you will want to know that the application finds the records 
you expected. You might be able to do this in a very precise manner (for
 example, knowing exactly what field values you expect), or you might 
want to make your tests more flexible by expressing the ranges of values
 that would be acceptable. Serenity provides a few features that make it
 easier to write acceptance tests for this sort of case.</p>
</div>
<div class="paragraph">
<p>In the rest of this section, we will study some examples based on tests for the Maven Central search site (see <a href="#maven-search-report">The results page for the Maven Central search page</a>). This site lets you search the Maven repository for Maven artifacts, and view the details of a particular artifact.</p>
</div>
<div id="maven-search-report" class="imageblock">
<div class="content">
<img src="The%20Serenity%20Reference%20Manual_files/maven-search-report.png" alt="maven search report" width="800">
</div>
<div class="title">Figure 23. The results page for the Maven Central search page</div>
</div>
<div class="paragraph">
<p>We will use some imaginary regression tests for this site to 
illustrate how the Serenity matchers can be used to write more 
expressive tests. The first scenario we will consider is simply 
searching for an artifact by name, and making sure that only artifacts 
matching this name appear in the results list. We might express this 
acceptance criteria informally in the following way:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Give that the developer is on the search page,</p>
</li>
<li>
<p>And the developer searches for artifacts called <em>Serenity</em></p>
</li>
<li>
<p>Then the developer should see at least 16 Serenity artifacts, each with a unique artifact Id</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In JUnit, a Serenity test for this scenario might look like the one:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">...
import <span class="directive">static</span> net.thucydides.core.matchers.BeanMatchers.the_count;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">net.thucydides.core.matchers.BeanMatchers.each</span>;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">net.thucydides.core.matchers.BeanMatchers.the</span>;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">org.hamcrest.Matchers.greaterThanOrEqualTo</span>;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">org.hamcrest.Matchers.is</span>;
<span class="keyword">import</span> <span class="include">static</span> <span class="include">org.hamcrest.Matchers.startsWith</span>;

<span class="annotation">@RunWith</span>(SerenityRunner.class)
<span class="directive">public</span> <span class="type">class</span> <span class="class">WhenSearchingForArtifacts</span> {

    <span class="annotation">@Managed</span>
    WebDriver driver;

    <span class="annotation">@ManagedPages</span>(defaultUrl = <span class="string"><span class="delimiter">"</span><span class="content">http://search.maven.org</span><span class="delimiter">"</span></span>)
    <span class="directive">public</span> Pages pages;

    <span class="annotation">@Steps</span>
    <span class="directive">public</span> DeveloperSteps developer;

    <span class="annotation">@Test</span>
    <span class="directive">public</span> <span class="type">void</span> should_find_the_right_number_of_artifacts() {
        developer.opens_the_search_page();
        developer.searches_for(<span class="string"><span class="delimiter">"</span><span class="content">Serenity</span><span class="delimiter">"</span></span>);
        developer.should_see_artifacts_where(the(<span class="string"><span class="delimiter">"</span><span class="content">GroupId</span><span class="delimiter">"</span></span>, startsWith(<span class="string"><span class="delimiter">"</span><span class="content">net.thucydides</span><span class="delimiter">"</span></span>)),
                                             each(<span class="string"><span class="delimiter">"</span><span class="content">ArtifactId</span><span class="delimiter">"</span></span>).isDifferent(),
                                             the_count(is(greaterThanOrEqualTo(<span class="integer">16</span>))));

    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Let’s see how the test in this class is implemented. The <code>should_find_the_right_number_of_artifacts()</code> test could be expressed as follows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>When we open the search page</p>
</li>
<li>
<p>And we search for artifacts containing the word <em>Serenity</em></p>
</li>
<li>
<p>Then we should see a list of artifacts where each Group ID starts 
with "net.Serenity", each Artifact ID is unique, and that there are at 
least 16 such entries displayed.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The implementation of these steps is illustrated here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">...
import <span class="directive">static</span> net.thucydides.core.matchers.BeanMatcherAsserts.shouldMatch;

<span class="directive">public</span> <span class="type">class</span> <span class="class">DeveloperSteps</span> <span class="directive">extends</span> ScenarioSteps {

    <span class="directive">public</span> DeveloperSteps(Pages pages) {
        <span class="local-variable">super</span>(pages);
    }

    <span class="annotation">@Step</span>
    <span class="directive">public</span> <span class="type">void</span> opens_the_search_page() {
        onSearchPage().open();
    }

    <span class="annotation">@Step</span>
    <span class="directive">public</span> <span class="type">void</span> searches_for(<span class="predefined-type">String</span> search_terms) {
        onSearchPage().enter_search_terms(search_terms);
        onSearchPage().starts_search();
    }

    <span class="annotation">@Step</span>
    <span class="directive">public</span> <span class="type">void</span> should_see_artifacts_where(BeanMatcher... matchers) {
        shouldMatch(onSearchResultsPage().getSearchResults(), matchers);
    }

    <span class="directive">private</span> SearchPage onSearchPage() {
        <span class="keyword">return</span> getPages().get(SearchPage.class);
    }

    <span class="directive">private</span> SearchResultsPage onSearchResultsPage() {
        <span class="keyword">return</span> getPages().get(SearchResultsPage.class);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The first two steps are implemented by relatively simple methods. 
However the third step is more interesting. Let’s look at it more 
closely:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    <span class="annotation">@Step</span>
    <span class="directive">public</span> <span class="type">void</span> should_see_artifacts_where(BeanMatcher... matchers) {
        shouldMatch(onSearchResultsPage().getSearchResults(), matchers);
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here, we are passing an arbitrary number of expressions into the method. These expressions actually <em>matchers</em>,
 instances of the BeanMatcher class. Not that you usually have to worry 
about that level of detail - you create these matcher expressions using a
 set of static methods provided in the BeanMatchers class. So you 
typically would pass fairly readable expressions like <code>the("GroupId", startsWith("net.Serenity"))</code> or <code>each("ArtifactId").isDifferent()</code>.</p>
</div>
<div class="paragraph">
<p>The <code>shouldMatch()</code> method from the BeanMatcherAsserts 
class takes either a single Java object, or a collection of Java 
objects, and checks that at least some of the objects match the 
constraints specified by the matchers. In the context of web testing, 
these objects are typically POJOs provided by the Page Object to 
represent the domain object or objects displayed on a screen.</p>
</div>
<div class="paragraph">
<p>There are a number of different matcher expressions to choose from. 
The most commonly used matcher just checks the value of a field in an 
object. For example, suppose you are using the domain object shown here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">     <span class="directive">public</span> <span class="type">class</span> <span class="class">Person</span> {
        <span class="directive">private</span> <span class="directive">final</span> <span class="predefined-type">String</span> firstName;
        <span class="directive">private</span> <span class="directive">final</span> <span class="predefined-type">String</span> lastName;

        Person(<span class="predefined-type">String</span> firstName, <span class="predefined-type">String</span> lastName) {
            <span class="local-variable">this</span>.firstName = firstName;
            <span class="local-variable">this</span>.lastName = lastName;
        }

        <span class="directive">public</span> <span class="predefined-type">String</span> getFirstName() {...}

        <span class="directive">public</span> <span class="predefined-type">String</span> getLastName() {...}
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>You could write a test to ensure that a list of Persons contained at 
least one person named "Bill" by using the "the" static method, as shown
 here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    <span class="predefined-type">List</span>&lt;Person&gt; persons = <span class="predefined-type">Arrays</span>.asList(<span class="keyword">new</span> Person(<span class="string"><span class="delimiter">"</span><span class="content">Bill</span><span class="delimiter">"</span></span>, <span class="string"><span class="delimiter">"</span><span class="content">Oddie</span><span class="delimiter">"</span></span>), <span class="keyword">new</span> Person(<span class="string"><span class="delimiter">"</span><span class="content">Tim</span><span class="delimiter">"</span></span>, <span class="string"><span class="delimiter">"</span><span class="content">Brooke-Taylor</span><span class="delimiter">"</span></span>));

    shouldMatch(persons, the(<span class="string"><span class="delimiter">"</span><span class="content">firstName</span><span class="delimiter">"</span></span>, is(<span class="string"><span class="delimiter">"</span><span class="content">Bill</span><span class="delimiter">"</span></span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p>The second parameter in the the() method is a Hamcrest matcher, which
 gives you a great deal of flexibility with your expressions. For 
example, you could also write the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    <span class="predefined-type">List</span>&lt;Person&gt; persons = <span class="predefined-type">Arrays</span>.asList(<span class="keyword">new</span> Person(<span class="string"><span class="delimiter">"</span><span class="content">Bill</span><span class="delimiter">"</span></span>, <span class="string"><span class="delimiter">"</span><span class="content">Oddie</span><span class="delimiter">"</span></span>), <span class="keyword">new</span> Person(<span class="string"><span class="delimiter">"</span><span class="content">Tim</span><span class="delimiter">"</span></span>, <span class="string"><span class="delimiter">"</span><span class="content">Brooke-Taylor</span><span class="delimiter">"</span></span>));

    shouldMatch(persons, the(<span class="string"><span class="delimiter">"</span><span class="content">firstName</span><span class="delimiter">"</span></span>, is(not(<span class="string"><span class="delimiter">"</span><span class="content">Tim</span><span class="delimiter">"</span></span>))));
    shouldMatch(persons, the(<span class="string"><span class="delimiter">"</span><span class="content">firstName</span><span class="delimiter">"</span></span>, startsWith(<span class="string"><span class="delimiter">"</span><span class="content">B</span><span class="delimiter">"</span></span>)));</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also pass in multiple conditions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    <span class="predefined-type">List</span>&lt;Person&gt; persons = <span class="predefined-type">Arrays</span>.asList(<span class="keyword">new</span> Person(<span class="string"><span class="delimiter">"</span><span class="content">Bill</span><span class="delimiter">"</span></span>, <span class="string"><span class="delimiter">"</span><span class="content">Oddie</span><span class="delimiter">"</span></span>), <span class="keyword">new</span> Person(<span class="string"><span class="delimiter">"</span><span class="content">Tim</span><span class="delimiter">"</span></span>, <span class="string"><span class="delimiter">"</span><span class="content">Brooke-Taylor</span><span class="delimiter">"</span></span>));

    shouldMatch(persons, the(<span class="string"><span class="delimiter">"</span><span class="content">firstName</span><span class="delimiter">"</span></span>, is(<span class="string"><span class="delimiter">"</span><span class="content">Bill</span><span class="delimiter">"</span></span>), the(<span class="string"><span class="delimiter">"</span><span class="content">lastName</span><span class="delimiter">"</span></span>, is(<span class="string"><span class="delimiter">"</span><span class="content">Oddie</span><span class="delimiter">"</span></span>));</code></pre>
</div>
</div>
<div class="paragraph">
<p>Serenity also provides the DateMatchers class, which lets you apply Hamcrest matches to standard java Dates and <code>JodaTime</code> DateTimes. The following code samples illustrate how these might be used:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    DateTime january1st2010 = <span class="keyword">new</span> DateTime(<span class="integer">2010</span>,<span class="octal">01</span>,<span class="octal">01</span>,<span class="integer">12</span>,<span class="integer">0</span>).toDate();
    DateTime may31st2010 = <span class="keyword">new</span> DateTime(<span class="integer">2010</span>,<span class="octal">05</span>,<span class="integer">31</span>,<span class="integer">12</span>,<span class="integer">0</span>).toDate();

    the(<span class="string"><span class="delimiter">"</span><span class="content">purchaseDate</span><span class="delimiter">"</span></span>, isBefore(january1st2010))
    the(<span class="string"><span class="delimiter">"</span><span class="content">purchaseDate</span><span class="delimiter">"</span></span>, isAfter(january1st2010))
    the(<span class="string"><span class="delimiter">"</span><span class="content">purchaseDate</span><span class="delimiter">"</span></span>, isSameAs(january1st2010))
    the(<span class="string"><span class="delimiter">"</span><span class="content">purchaseDate</span><span class="delimiter">"</span></span>, isBetween(january1st2010, may31st2010))</code></pre>
</div>
</div>
<div class="paragraph">
<p>You sometimes also need to check constraints that apply to all of the
 elements under consideration. The simplest of these is to check that 
all of the field values for a particular field are unique. You can do 
this using the <code>each()</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    shouldMatch(persons, each(<span class="string"><span class="delimiter">"</span><span class="content">lastName</span><span class="delimiter">"</span></span>).isDifferent())</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also check that the number of matching elements corresponds 
to what you are expecting. For example, to check that there is only one 
person who’s first name is Bill, you could do this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">     shouldMatch(persons, the(<span class="string"><span class="delimiter">"</span><span class="content">firstName</span><span class="delimiter">"</span></span>, is(<span class="string"><span class="delimiter">"</span><span class="content">Bill</span><span class="delimiter">"</span></span>), the_count(is(<span class="integer">1</span>)));</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also check the minimum and maximum values using the max() and min() methods. For example, if the Person class had a <code>getAge()</code> method, we could ensure that every person is over 21 and under 65 by doing the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">     shouldMatch(persons, min(<span class="string"><span class="delimiter">"</span><span class="content">age</span><span class="delimiter">"</span></span>, greaterThanOrEqualTo(<span class="integer">21</span>)),
                          max(<span class="string"><span class="delimiter">"</span><span class="content">age</span><span class="delimiter">"</span></span>, lessThanOrEqualTo(<span class="integer">65</span>)));</code></pre>
</div>
</div>
<div class="paragraph">
<p>These methods work with normal Java objects, but also with Maps. So the following code will also work:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; person = <span class="keyword">new</span> <span class="predefined-type">HashMap</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt;();
    person.put(<span class="string"><span class="delimiter">"</span><span class="content">firstName</span><span class="delimiter">"</span></span>, <span class="string"><span class="delimiter">"</span><span class="content">Bill</span><span class="delimiter">"</span></span>);
    person.put(<span class="string"><span class="delimiter">"</span><span class="content">lastName</span><span class="delimiter">"</span></span>, <span class="string"><span class="delimiter">"</span><span class="content">Oddie</span><span class="delimiter">"</span></span>);

    <span class="predefined-type">List</span>&lt;<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>,<span class="predefined-type">String</span>&gt;&gt; persons = <span class="predefined-type">Arrays</span>.asList(person);
    shouldMatch(persons, the(<span class="string"><span class="delimiter">"</span><span class="content">firstName</span><span class="delimiter">"</span></span>, is(<span class="string"><span class="delimiter">"</span><span class="content">Bill</span><span class="delimiter">"</span></span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p>The other nice thing about this approach is that the matchers play 
nicely with the Serenity reports. So when you use the BeanMatcher class 
as a parameter in your test steps, the conditions expressed in the step 
will be displayed in the test report, as shown in <a href="#fig-maven-search-report">Conditional expressions are displayed in the test reports</a>.</p>
</div>
<div id="fig-maven-search-report" class="imageblock">
<div class="content">
<img src="The%20Serenity%20Reference%20Manual_files/maven-search-report.png" alt="maven search report" width="800">
</div>
<div class="title">Figure 24. Conditional expressions are displayed in the test reports</div>
</div>
<div class="paragraph">
<p>There are two common usage patterns when building Page Objects and 
steps that use this sort of matcher. The first is to write a Page Object
 method that returns the list of domain objects (for example, Persons) 
displayed on the table. For example, the getSearchResults() method used 
in the should_see_artifacts_where() step could be implemented as 
follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    <span class="directive">public</span> <span class="predefined-type">List</span>&lt;Artifact&gt; getSearchResults() {
        <span class="predefined-type">List</span>&lt;WebElement&gt; rows = resultTable.findElements(By.xpath(<span class="string"><span class="delimiter">"</span><span class="content">.//tr[td]</span><span class="delimiter">"</span></span>));
        <span class="predefined-type">List</span>&lt;Artifact&gt; artifacts = <span class="keyword">new</span> <span class="predefined-type">ArrayList</span>&lt;Artifact&gt;();
        <span class="keyword">for</span> (WebElement row : rows) {
            <span class="predefined-type">List</span>&lt;WebElement&gt; cells = row.findElements(By.tagName(<span class="string"><span class="delimiter">"</span><span class="content">td</span><span class="delimiter">"</span></span>));
            artifacts.add(<span class="keyword">new</span> Artifact(cells.get(<span class="integer">0</span>).getText(),
                                       cells.get(<span class="integer">1</span>).getText(),
                                       cells.get(<span class="integer">2</span>).getText()));

        }
        <span class="keyword">return</span> artifacts;
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The second is to access the HTML table contents directly, without 
explicitly modelling the data contained in the table. This approach is 
faster and more effective if you don’t expect to reuse the domain object
 in other pages. We will see how to do this next.</p>
</div>
<div class="sect3">
<h4 id="_working_with_html_tables"><a class="anchor" href="#_working_with_html_tables"></a>8.8.1. Working with HTML Tables</h4>
<div class="paragraph">
<p>Since HTML tables are still widely used to represent sets of data on 
web applications, Serenity comes the HtmlTable class, which provides a 
number of useful methods that make it easier to write Page Objects that 
contain tables. For example, the rowsFrom method returns the contents of
 an HTML table as a list of Maps, where each map contains the cell 
values for a row indexed by the corresponding heading, as shown here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">...
import <span class="directive">static</span> net.thucydides.core.pages.components.HtmlTable.rowsFrom;

<span class="directive">public</span> <span class="type">class</span> <span class="class">SearchResultsPage</span> <span class="directive">extends</span> PageObject {

    WebElement resultTable;

    <span class="directive">public</span> SearchResultsPage(WebDriver driver) {
        <span class="local-variable">super</span>(driver);
    }

    <span class="directive">public</span> <span class="predefined-type">List</span>&lt;<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt;&gt; getSearchResults() {
        <span class="keyword">return</span> rowsFrom(resultTable);
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This saves a lot of typing - our <code>getSearchResults()</code> method now looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    <span class="directive">public</span> <span class="predefined-type">List</span>&lt;<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt;&gt; getSearchResults() {
        <span class="keyword">return</span> rowsFrom(resultTable);
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>And since the Serenity matchers work with both Java objects and Maps,
 the matcher expressions will be very similar. The only difference is 
that the Maps returned are indexed by the text values contained in the 
table headings, rather than by java-friendly property names.</p>
</div>
<div class="paragraph">
<p>You can also read tables without headers (i.e., &lt;th&gt; elements) by specifying your own headings using the <code>withColumns</code> method. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    <span class="predefined-type">List</span>&lt;<span class="predefined-type">Map</span>&lt;<span class="predefined-type">Object</span>, <span class="predefined-type">String</span>&gt;&gt; tableRows =
                    HtmlTable.withColumns(<span class="string"><span class="delimiter">"</span><span class="content">First Name</span><span class="delimiter">"</span></span>,<span class="string"><span class="delimiter">"</span><span class="content">Last Name</span><span class="delimiter">"</span></span>, <span class="string"><span class="delimiter">"</span><span class="content">Favorite Colour</span><span class="delimiter">"</span></span>)
                             .readRowsFrom(page.table_with_no_headings);</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also use the HtmlTable class to select particular rows within
 a table to work with. For example, another test scenario for the Maven 
Search page involves clicking on an artifact and displaying the details 
for that artifact. The test for this might look something like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    <span class="annotation">@Test</span>
    <span class="directive">public</span> <span class="type">void</span> clicking_on_artifact_should_display_details_page() {
        developer.opens_the_search_page();
        developer.searches_for(<span class="string"><span class="delimiter">"</span><span class="content">Serenity</span><span class="delimiter">"</span></span>);
        developer.open_artifact_where(the(<span class="string"><span class="delimiter">"</span><span class="content">ArtifactId</span><span class="delimiter">"</span></span>, is(<span class="string"><span class="delimiter">"</span><span class="content">Serenity</span><span class="delimiter">"</span></span>)),
                                      the(<span class="string"><span class="delimiter">"</span><span class="content">GroupId</span><span class="delimiter">"</span></span>, is(<span class="string"><span class="delimiter">"</span><span class="content">net.Serenity</span><span class="delimiter">"</span></span>)));

        developer.should_see_artifact_details_where(the(<span class="string"><span class="delimiter">"</span><span class="content">artifactId</span><span class="delimiter">"</span></span>, is(<span class="string"><span class="delimiter">"</span><span class="content">Serenity</span><span class="delimiter">"</span></span>)),
                                                    the(<span class="string"><span class="delimiter">"</span><span class="content">groupId</span><span class="delimiter">"</span></span>, is(<span class="string"><span class="delimiter">"</span><span class="content">net.Serenity</span><span class="delimiter">"</span></span>)));
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now the open_artifact_where() method needs to click on a particular row in the table. This step looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    <span class="annotation">@Step</span>
    <span class="directive">public</span> <span class="type">void</span> open_artifact_where(BeanMatcher... matchers) {
        onSearchResultsPage().clickOnFirstRowMatching(matchers);
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>So we are effectively delegating to the Page Object, who does the 
real work. The corresponding Page Object method looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">static</span> <span class="include">net.thucydides.core.pages.components.HtmlTable.filterRows</span>;
...
    public <span class="type">void</span> clickOnFirstRowMatching(BeanMatcher... matchers) {
        <span class="predefined-type">List</span>&lt;WebElement&gt; matchingRows = filterRows(resultTable, matchers);
        WebElement targetRow = matchingRows.get(<span class="integer">0</span>);
        WebElement detailsLink = targetRow.findElement(By.xpath(<span class="string"><span class="delimiter">"</span><span class="content">.//a[contains(@href,'artifactdetails')]</span><span class="delimiter">"</span></span>));
        detailsLink.click();
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The interesting part here is the first line of the method, where we 
use the filterRows() method. This method will return a list of 
WebElements that match the matchers you have passed in. This method 
makes it fairly easy to select the rows you are interested in for 
special treatment.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_running_several_steps_using_the_same_page_object"><a class="anchor" href="#_running_several_steps_using_the_same_page_object"></a>8.9. Running several steps using the same page object</h3>
<div class="paragraph">
<p>Sometimes, querying the browser can be expensive. For example, if you
 are testing tables with large numbers of web elements (e.g. a web 
element for each cell), performance can be slow, and memory usage high. 
Normally, Serenity will requery the page (and create a new Page Object) 
each time you call <code>Pages.get()</code> or <code>Pages.currentPageAt()</code>.
 If you are certain that the page will not change (i.e., that you are 
only performing read-only operations on the page), you can use the 
onSamePage() method of the ScenarioSteps class to ensure that subsequent
 calls to <code>Pages.get()</code> or <code>Pages.currentPageAt()</code> will return the same page object:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@RunWith</span>(SerenityRunner.class)
<span class="directive">public</span> <span class="type">class</span> <span class="class">WhenDisplayingTableContents</span> {

    <span class="annotation">@Managed</span>
    <span class="directive">public</span> WebDriver webdriver;

    <span class="annotation">@ManagedPages</span>(defaultUrl = <span class="string"><span class="delimiter">"</span><span class="content">http://my.web.site/index.html</span><span class="delimiter">"</span></span>)
    <span class="directive">public</span> Pages pages;

    <span class="annotation">@Steps</span>
    <span class="directive">public</span> DemoSiteSteps steps;

    <span class="annotation">@Test</span>
    <span class="directive">public</span> <span class="type">void</span> the_user_opens_another_page() {
        steps.navigate_to_page_with_a_large_table();
        steps.onSamePage(DemoSiteSteps.class).check_row(<span class="integer">1</span>);
        steps.onSamePage(DemoSiteSteps.class).check_row(<span class="integer">2</span>);
        steps.onSamePage(DemoSiteSteps.class).check_row(<span class="integer">3</span>);
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_switching_to_another_page"><a class="anchor" href="#_switching_to_another_page"></a>8.10. Switching to another page</h3>
<div class="paragraph">
<p>A method, switchToPage() is provided in PageObject class to make it 
convenient to return a new PageObject after navigation from within a 
method of a PageObject class. For example,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@DefaultUrl</span>(<span class="string"><span class="delimiter">"</span><span class="content">http://mail.acme.com/login.html</span><span class="delimiter">"</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">EmailLoginPage</span> <span class="directive">extends</span> PageObject {

    ...
    public <span class="type">void</span> forgotPassword() {
        ...
        forgotPassword.click();
        ForgotPasswordPage forgotPasswordPage = <span class="local-variable">this</span>.switchToPage(ForgotPasswordPage.class);
        forgotPasswordPage.open();
        ...
    }
    ...
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_serenity_and_the_screenplay_pattern"><a class="anchor" href="#_serenity_and_the_screenplay_pattern"></a>9. Serenity and the Screenplay Pattern</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Screenplay Pattern is an approach to writing high quality 
automated acceptance tests based on good software engineering principles
 such as the Single Responsibility Principle, the Open-Closed Principle,
 and effective use of Layers of Abstraction. It encourages good testing 
habits and well-designed test suites that are easy to read, easy to 
maintain and easy to extend, enabling teams to write more robust and 
more reliable automated tests more effectively.</p>
</div>
<div class="paragraph">
<p>In this section we will look at how to use the Screenplay Pattern 
with Serenity BDD. We will be illustrating the Screenplay Pattern using 
the AngularJS implementation of the well-known TodoMVC (<a href="http://todomvc.com/" class="bare">http://todomvc.com</a>) project (see <a href="#fig-todomvc-app">The Screenplay Pattern will be illustrated by some tests against the TodoMVC application</a>). You can experiment with this application at <a href="http://todomvc.com/examples/angularjs/#/" class="bare">http://todomvc.com/examples/angularjs/#/</a>.</p>
</div>
<div id="fig-todomvc-app" class="imageblock">
<div class="content">
<img src="The%20Serenity%20Reference%20Manual_files/journey-todo-app.png" alt="journey todo app">
</div>
<div class="title">Figure 25. The Screenplay Pattern will be illustrated by some tests against the TodoMVC application</div>
</div>
<div class="paragraph">
<p>You can use the Screenplay Pattern with Serenity BDD in JUnit, 
Cucumber or JBehave. For simplicity, the examples will be using JUnit.</p>
</div>
<div class="sect2">
<h3 id="_introducing_the_screenplay_pattern"><a class="anchor" href="#_introducing_the_screenplay_pattern"></a>9.1. Introducing the Screenplay Pattern</h3>
<div class="paragraph">
<p>Suppose we are implementing the “Add new todo items” feature of the 
ToDo MVC application. This feature could have an acceptance criteria 
along the lines of “Should be able to add a new todo item”. If we were 
testing these scenarios manually, we could create test plans like the 
following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Should be able to add a new todo item</p>
<div class="ulist">
<ul>
<li>
<p>Open the application</p>
</li>
<li>
<p>Add an item called ‘Buy some milk’</p>
</li>
<li>
<p>The ‘Buy some milk’ item should appear in the todo list</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Using the Screenplay Pattern, we could write this code very naturally like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    <span class="annotation">@Test</span>
    <span class="directive">public</span> <span class="type">void</span> should_be_able_to_add_a_todo_item() {

        givenThat(james).wasAbleTo(OpenTheApplication.onTheHomePage());

        when(james).attemptsTo(AddATodoItem.called(<span class="string"><span class="delimiter">"</span><span class="content">Buy some milk</span><span class="delimiter">"</span></span>));

        then(james).should(seeThat(theDisplayedItems, hasItem(<span class="string"><span class="delimiter">"</span><span class="content">Buy some milk</span><span class="delimiter">"</span></span>)));
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>One of the motivations behind the Screenplay Pattern is the highly 
readable test code that it produces. Even if you are not familiar with 
how this code is implemented under the hood, it should be quite obvious 
what the test is trying to demonstrate, and how it is going about it.</p>
</div>
<div class="paragraph">
<p>In addition, the Serenity reports produced for this test also reflect
 this narrative structure, making it easier for testers, business 
analysts and business people to understand what the tests are actually 
demonstrating. A typical Screenplay Pattern report is shown in <a href="#fig-todomvc-report">The Serenity report documents both the intent and the implementation of the test</a>.</p>
</div>
<div id="fig-todomvc-report" class="imageblock">
<div class="content">
<img src="The%20Serenity%20Reference%20Manual_files/journey-report.png" alt="journey report">
</div>
<div class="title">Figure 26. The Serenity report documents both the intent and the implementation of the test</div>
</div>
<div class="paragraph">
<p>The code listed above certainly reads cleanly, but it may leave you 
wondering how it actually works under the hood. Let’s see how it all 
fits together.</p>
</div>
</div>
<div class="sect2">
<h3 id="_screenplay_pattern_tests_runs_like_any_other_serenity_test"><a class="anchor" href="#_screenplay_pattern_tests_runs_like_any_other_serenity_test"></a>9.2. Screenplay Pattern tests runs like any other Serenity test</h3>
<div class="paragraph">
<p>The Serenity Screenplay Pattern currently integrates with both JUnit 
and Cucumber. In JUnit, you use the SerenityRunner JUnit runner, as for 
any other Serenity JUnit tests. The full source code of the test we saw 
earlier is shown here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@RunWith</span>(SerenityRunner.class)
<span class="directive">public</span> <span class="type">class</span> <span class="class">AddNewTodos</span> {

    <span class="directive">private</span> Actor james = Actor.named(<span class="string"><span class="delimiter">"</span><span class="content">James</span><span class="delimiter">"</span></span>);

    <span class="annotation">@Managed</span>
    <span class="directive">private</span> WebDriver hisBrowser;

    <span class="annotation">@Steps</span>
    <span class="directive">private</span> PlaceholderText thePlaceholderText;

    <span class="directive">private</span> DisplayedItems theDisplayedItems = <span class="keyword">new</span> DisplayedItems();

    <span class="annotation">@Before</span>
    <span class="directive">public</span> <span class="type">void</span> jamesCanBrowseTheWeb() {
        james.can(BrowseTheWeb.with(hisBrowser));
    }

    <span class="annotation">@Test</span>
    <span class="directive">public</span> <span class="type">void</span> should_be_able_to_add_a_todo_item() {

        givenThat(james).wasAbleTo(OpenTheApplication.onTheHomePage());

        when(james).attemptsTo(AddATodoItem.called(<span class="string"><span class="delimiter">"</span><span class="content">Buy some milk</span><span class="delimiter">"</span></span>));

        then(james).should(seeThat(theDisplayedItems, hasItem(<span class="string"><span class="delimiter">"</span><span class="content">Buy some milk</span><span class="delimiter">"</span></span>)));
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>It’s not hard to guess what this test does just by reading the code. 
There are however a few things here that are new. In the following 
sections, we will take a closer look at the details.</p>
</div>
</div>
<div class="sect2">
<h3 id="_layers_of_abstraction"><a class="anchor" href="#_layers_of_abstraction"></a>9.3. Layers of abstraction</h3>
<div class="paragraph">
<p>Experienced automated testers use layers of abstraction to separate 
the intent of the test (what you are trying to achieve) from the 
implementation details (how you achieve it). By separating the what from
 the how, the intent from the implementation, layers of abstraction help
 make tests easier to understand and to maintain. Indeed, well defined 
layers of abstraction are perhaps the single most important factor in 
writing high quality automated tests.</p>
</div>
<div class="paragraph">
<p>In User Experience (UX) Design, we break down the way a user interacts with an application into goals, tasks and actions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The goal describes what the user is trying to achieve in business terms</p>
</li>
<li>
<p>The tasks describe the high level steps the user needs to perform to achieve this goal, and</p>
</li>
<li>
<p>The actions correspond to how a user interacts with the system to 
perform a particular task, such as by clicking on a button or entering a
 value into a field.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Screenplay Pattern in Serenity BDD provides a clear distinction 
between tasks and actions, which makes it easier for teams to write 
layered tests more consistently.</p>
</div>
</div>
<div class="sect2">
<h3 id="_actors_and_the_screenplay_pattern"><a class="anchor" href="#_actors_and_the_screenplay_pattern"></a>9.4. Actors and the Screenplay Pattern</h3>
<div class="paragraph">
<p>Tests describe how a user interacts with the application to achieve a
 goal. For this reason, tests read much better if they are presented 
from the point of view of the user.</p>
</div>
<div class="paragraph">
<p>In the Screenplay Pattern, we call a user interacting with the system an <em>Actor</em>. Actors are at the heart of the Screenplay Pattern (see <a href="#fig-journey-actors">The Screenplay Pattern uses an actor-centric model</a>). Each actor has a certain number of <em>Abilities</em>, such as the ability to browse the web or to query a restful web service. Actors can also perform <em>Tasks</em>
 such as adding an item to the Todo list. To achieve these tasks, they 
will typically need to interact with the application, such as by 
entering a value into a field or by clicking on a button. We call these 
interactions <em>Actions</em>. Actors can also ask <em>Questions</em> about the state of the application, such as by reading the value of a field on the screen or by querying a web service.</p>
</div>
<div id="fig-journey-actors" class="imageblock">
<div class="content">
<img src="The%20Serenity%20Reference%20Manual_files/journey-actors.png" alt="journey actors">
</div>
<div class="title">Figure 27. The Screenplay Pattern uses an actor-centric model</div>
</div>
<div class="paragraph">
<p>In Serenity, creating an actor is as simple as creating an instance of the Actor class and providing a name:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Actor james = Actor.named(<span class="string"><span class="delimiter">"</span><span class="content">James</span><span class="delimiter">"</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>We find it useful to give the actors real names, rather than just to 
use a generic one such as "the user". Different names can be a 
short-hand for different user roles or personas, and make the scenarios 
easier to relate to.</p>
</div>
</div>
<div class="sect2">
<h3 id="_actors_have_abilities"><a class="anchor" href="#_actors_have_abilities"></a>9.5. Actors have abilities</h3>
<div class="paragraph">
<p>Actors need to be able to do things to perform their assigned tasks. 
So we give our actors “abilities”, a bit like the superpowers of a 
super-hero, but in more mundane. If this is a web test, for example, we 
need James to be able to browse the web using a browser.</p>
</div>
<div class="paragraph">
<p>Serenity BDD plays well with Selenium WebDriver, and is happy to 
manage the browser lifecycle for you. All you need to do is to use the 
@Managed annotation with a WebDriver member variable, as shown here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Managed</span>
WebDriver hisBrowser;</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can then let James use this browser like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">james.can(BrowseTheWeb.with(hisBrowser));</code></pre>
</div>
</div>
<div class="paragraph">
<p>To make it clear that this is a precondition for the test (and could very well go in a JUnit <code>@Before</code> method), we can use the syntactic sugar method givenThat():</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">givenThat(james).can(BrowseTheWeb.with(hisBrowser));</code></pre>
</div>
</div>
<div class="paragraph">
<p>Each of the actor’s abilities is represented by an Ability class (in this case, <code>BrowseTheWeb</code>) which keeps track of the things the actor needs to perform this ability (for example, the <code>WebDriver</code>
 instance used to interact with the browser). Keeping the things an 
actor can do (browse the web, invoke a web service…​) separate from the 
actor makes it easier to extend the actor’s abilities. For example, to 
add a new custom ability, you just need to implement a new <code>Ability</code> class.</p>
</div>
</div>
<div class="sect2">
<h3 id="_actors_perform_tasks"><a class="anchor" href="#_actors_perform_tasks"></a>9.6. Actors perform tasks</h3>
<div class="paragraph">
<p>An actor needs to perform a number of tasks to achieve a business 
goal. A fairly typical example of a task is “adding a todo item”, which 
we could write as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">james.attemptsTo(AddATodoItem.called(<span class="string"><span class="delimiter">"</span><span class="content">Buy some milk</span><span class="delimiter">"</span></span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or, if the task is a precondition, rather than the main subject of the test, we could write something like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">james.wasAbleTo(AddATodoItem.called(<span class="string"><span class="delimiter">"</span><span class="content">Buy some milk</span><span class="delimiter">"</span></span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more readability, we can also wrap the actor in a static method from the <code>GivenWhenThen</code> class:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>givenThat()</p>
</li>
<li>
<p>andThat()</p>
</li>
<li>
<p>when()</p>
</li>
<li>
<p>then()</p>
</li>
<li>
<p>and()</p>
</li>
<li>
<p>but()</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, we could have written the last line of code like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">givenThat(james).wasAbleTo(AddATodoItem.called(<span class="string"><span class="delimiter">"</span><span class="content">Buy some milk</span><span class="delimiter">"</span></span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p>Let’s break it down to understand what is going on. At the heart of 
the Screenplay Pattern, an actor performs a sequence of tasks. In 
Serenity, this mechanism is implemented in the Actor class using a 
variation of the Command Pattern, where the actor executes each task by 
invoking a special method called performAs() on the corresponding Task 
object (see <a href="#fig-journey-command-pattern">The actor invokes the <code>performAs()</code> method on a sequence of tasks</a>).</p>
</div>
<div id="fig-journey-command-pattern" class="imageblock">
<div class="content">
<img src="The%20Serenity%20Reference%20Manual_files/journey-command-pattern.png" alt="journey command pattern">
</div>
<div class="title">Figure 28. The actor invokes the <code>performAs()</code> method on a sequence of tasks</div>
</div>
<div class="paragraph">
<p>Tasks are just objects that implement the <code>Task</code> interface, and need to implement the <code>performAs(actor)</code> method. In fact, you can think of any Task class as basically a <code>performAs()</code> method alongside a supporting cast of helper methods.</p>
</div>
</div>
<div class="sect2">
<h3 id="_tasks_can_be_created_using_annotated_fields_or_builders"><a class="anchor" href="#_tasks_can_be_created_using_annotated_fields_or_builders"></a>9.7. Tasks can be created using annotated fields or builders</h3>
<div class="paragraph">
<p>To do its reporting magic, Serenity BDD needs to instrument the task 
and action objects used during the tests. The simplest way to do arrange
 this is to let Serenity create it for you, just like any other Serenity
 step library, using the @Steps annotation. In the following code 
snippet, Serenity will instantiate the openTheApplication field for you,
 so that James can use it to open the application:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Steps</span>
OpenTheApplication openTheApplication;
<span class="error">…</span>
james.attemptsTo(openTheApplication);</code></pre>
</div>
</div>
<div class="paragraph">
<p>This works well for very simple tasks or actions, for example ones 
that take no parameters. But for more sophisticated tasks or actions, a 
builder pattern like the one used with the AddATodoItem earlier on is 
more convenient. Experienced practitioners generally like to make the 
builder method and the class name combine to read like an English 
sentence, so that the intent of the task remains crystal clear:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">AddATodoItem.called(<span class="string"><span class="delimiter">"</span><span class="content">Buy some milk</span><span class="delimiter">"</span></span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p>Serenity BDD provides the special Instrumented class that makes it 
easy to create task or action objects using the builder pattern. For 
example, the <code>AddATodoItem</code> class has an immutable field called <code>thingToDo</code>, that contains the text to go in the new Todo item.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">AddATodoItem</span> <span class="directive">implements</span> Task {

    <span class="directive">private</span> <span class="directive">final</span> <span class="predefined-type">String</span> thingToDo;

    <span class="directive">protected</span> AddATodoItem(<span class="predefined-type">String</span> thingToDo) { <span class="local-variable">this</span>.thingToDo = thingToDo; }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can invoke this constructor using the <code>Instrumented.instanceOf().withProperties()</code> methods, as shown here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">AddATodoItem</span> <span class="directive">implements</span> Task {

    <span class="directive">private</span> <span class="directive">final</span> <span class="predefined-type">String</span> thingToDo;

    <span class="directive">protected</span> AddATodoItem(<span class="predefined-type">String</span> thingToDo) { <span class="local-variable">this</span>.thingToDo = thingToDo; }

    <span class="directive">public</span> <span class="directive">static</span> AddATodoItem called(<span class="predefined-type">String</span> thingToDo) {
        <span class="keyword">return</span> Instrumented.instanceOf(AddATodoItem.class).withProperties(thingToDo);
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_high_level_tasks_rely_on_other_lower_level_tasks_or_actions"><a class="anchor" href="#_high_level_tasks_rely_on_other_lower_level_tasks_or_actions"></a>9.8. High level tasks rely on other lower-level tasks or actions</h3>
<div class="paragraph">
<p>To get the job done, a high level business task will usually need to 
call either lower level business tasks or actions that interact more 
directly with the application. In practice, this means that the <code>performAs()</code>
 method of a task typically executes other, lower level tasks or 
interacts with the application in some other way. For example, adding a 
todo item requires two UI actions:
  1. Enter the todo text in the text field
  2. Press Return</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    <span class="annotation">@Step</span>(<span class="string"><span class="delimiter">"</span><span class="content">{0} adds a todo item called #thingToDo</span><span class="delimiter">"</span></span>)
    <span class="directive">public</span> &lt;T <span class="directive">extends</span> Actor&gt; <span class="type">void</span> performAs(T actor) {
        actor.attemptsTo(
                Enter.theValue(thingToDo).into(NewTodoForm.NEW_TODO_FIELD),
                Hit.the(RETURN).keyIn(NewTodoForm.NEW_TODO_FIELD)
        );
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The actual implementation uses pre-defined <code>Action</code> classes (such as <code>Enter</code> and <code>Hit `shown here) that come with Serenity.  `Action</code> classes are very similar to <code>Task</code>
 classes, except that they focus on interacting directly with the 
application. Serenity provides a small number of basic Action classes 
for core UI interactions such as entering field values, clicking on 
elements, or selecting values from drop-down lists. You can find these 
in the <code>net.serenitybdd.screenplay.actions</code> package. In 
practice, these provide a convenient and readable DSL that let you 
describe common low-level UI interactions needed to perform a task.</p>
</div>
<div class="paragraph">
<p>For example, the UI Action to enter the text defined in the <code>thingToDo</code> field into the input field with an ID value of “new-todo” would look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Enter.theValue(thingToDo).into(<span class="string"><span class="delimiter">"</span><span class="content">#new-todo</span><span class="delimiter">"</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>However, hard-coding the CSS selector could lead to duplication. A 
better practice would be to refactor the selector into a simple Page 
Object class, like this one:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">NewTodoForm</span> <span class="directive">extends</span> PageObject {
    <span class="directive">public</span> <span class="directive">static</span> <span class="predefined-type">String</span> NEW_TODO_FIELD = <span class="string"><span class="delimiter">"</span><span class="content">#new-todo</span><span class="delimiter">"</span></span>;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, we could use the Serenity Target class to associate a 
meaningful label with a CSS selector. These labels appear in the test 
reports and make them more readable:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">NewTodoForm</span> <span class="directive">extends</span> PageObject {
    <span class="directive">public</span> <span class="directive">static</span> <span class="predefined-type">Target</span> NEW_TODO_FIELD  = <span class="predefined-type">Target</span>.the(<span class="string"><span class="delimiter">"</span><span class="content">New Todo Field</span><span class="delimiter">"</span></span>).locatedBy(<span class="string"><span class="delimiter">"</span><span class="content">#new-todo</span><span class="delimiter">"</span></span>);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>@Step</code> annotation on the performAs() method is used to provide information about how the task will appear in the test reports:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Step</span>(<span class="string"><span class="delimiter">"</span><span class="content">{0} adds a todo item called #thingToDo</span><span class="delimiter">"</span></span>)
<span class="directive">public</span> &lt;T <span class="directive">extends</span> Actor&gt; <span class="type">void</span> performAs(T actor) {...}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Any member variables can be referred to in the @Step annotation by 
name using the hash (‘#’) prefix (like "#thingToDo" in the example). You
 can also reference the actor itself using the special
"{0} placeholder. The end result is a blow-by-blow account of how each 
business task was performed (see <a href="#fig-journey-action-report">Test reports show details about both tasks and UI interactions</a>).</p>
</div>
<div id="fig-journey-action-report" class="imageblock">
<div class="content">
<img src="The%20Serenity%20Reference%20Manual_files/journey-action-report.png" alt="journey action report">
</div>
<div class="title">Figure 29. Test reports show details about both tasks and UI interactions</div>
</div>
</div>
<div class="sect2">
<h3 id="_action_classes_can_access_the_serenity_webdriver_integration"><a class="anchor" href="#_action_classes_can_access_the_serenity_webdriver_integration"></a>9.9. Action classes can access the Serenity WebDriver integration</h3>
<div class="paragraph">
<p>You can also write your own <code>Action</code> classes. If the actor has the <code>BrowseTheWeb</code> ability, the Action class can integrate with the Serenity WebDriver support in several ways.</p>
</div>
<div class="paragraph">
<p>One approach is to use the <code>BrowseTheWeb</code> class to access the WebDriver instance associated with an actor. To do this, you use the <code>BrowseTheWeb.as(theActor)</code> method, as shown here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> &lt;T <span class="directive">extends</span> Actor&gt; <span class="type">void</span> performAs(T theActor) {
    WebElement deleteButton = BrowseTheWeb.as(theActor).findBy(pathTo(target));
    BrowseTheWeb.as(theActor).evaluateJavascript(<span class="string"><span class="delimiter">"</span><span class="content">arguments[0].click()</span><span class="delimiter">"</span></span>, deleteButton);
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_tasks_can_be_used_as_building_blocks_by_other_tasks"><a class="anchor" href="#_tasks_can_be_used_as_building_blocks_by_other_tasks"></a>9.10. Tasks can be used as building blocks by other tasks</h3>
<div class="paragraph">
<p>It is easy to reuse tasks in other, higher level tasks. For example, 
the sample project uses a AddTodoItems task to add a number of todo 
items to the list, like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">givenThat(james).wasAbleTo(AddTodoItems.called(<span class="string"><span class="delimiter">"</span><span class="content">Walk the dog</span><span class="delimiter">"</span></span>, <span class="string"><span class="delimiter">"</span><span class="content">Put out the garbage</span><span class="delimiter">"</span></span>));</code></pre>
</div>
</div>
<div class="paragraph">
<p>This task is defined using the AddATodoItem class, as shown here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">AddTodoItems</span> <span class="directive">implements</span> Task {

    <span class="directive">private</span> <span class="directive">final</span> <span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; todos;

    <span class="directive">protected</span> AddTodoItems(<span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; items) { <span class="local-variable">this</span>.todos = ImmutableList.copyOf(items); }

    <span class="annotation">@Step</span>(<span class="string"><span class="delimiter">"</span><span class="content">{0} adds the todo items called #todos</span><span class="delimiter">"</span></span>)
    <span class="directive">public</span> &lt;T <span class="directive">extends</span> Actor&gt; <span class="type">void</span> performAs(T actor) {
        todos.forEach(
                todo -&gt; actor.attemptsTo(AddATodoItem.called(todo))
        );
    }

    <span class="directive">public</span> <span class="directive">static</span> AddTodoItems called(<span class="predefined-type">String</span>... items) {
        <span class="keyword">return</span> Instrumented.instanceOf(AddTodoItems.class).withProperties(asList(items));
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is quite frequent to reuse existing tasks to build up more sophisticated business tasks in this way.</p>
</div>
</div>
<div class="sect2">
<h3 id="_actors_can_ask_questions_about_the_state_of_the_application"><a class="anchor" href="#_actors_can_ask_questions_about_the_state_of_the_application"></a>9.11. Actors can ask questions about the state of the application</h3>
<div class="paragraph">
<p>A typical automated acceptance test has three parts:
1. Set up some test data and/or get the application into a known state
2. Perform some action
3. Compare the new application state with what is expected.</p>
</div>
<div class="paragraph">
<p>From a testing perspective, the third step is where the real value 
lies – this is where we check that the application does what it is 
supposed to do.</p>
</div>
<div class="paragraph">
<p>In a traditional Serenity test, we would write an assertion using a 
library like Hamcrest or AssertJ to check an outcome against an expected
 value. Using the Serenity Screenplay Pattern, we express assertions 
using a flexible, fluent API quite similar to the one used for Tasks and
 Actions. In the test shown above, the assertion looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">then(james).should(seeThat(theDisplayedItems, hasItem(<span class="string"><span class="delimiter">"</span><span class="content">Buy some milk</span><span class="delimiter">"</span></span>)));</code></pre>
</div>
</div>
<div class="paragraph">
<p>The structure of this code is illustrated in <a href="#fig-journey-breakdown">A Serenity Screenplay Pattern assertion</a></p>
</div>
<div id="fig-journey-breakdown" class="imageblock">
<div class="content">
<img src="The%20Serenity%20Reference%20Manual_files/journey-breakdown.png" alt="journey breakdown">
</div>
<div class="title">Figure 30. A Serenity Screenplay Pattern assertion</div>
</div>
<div class="paragraph">
<p>As you might expect, this code checks a value retrieved from the 
application (the items displayed on the screen) against an expected 
value (described by a Hamcrest expression). However, rather than passing
 an actual value, we pass a Question object. The role of a Question 
object is to answer a precise question about the state of the 
application, from the point of view of the actor, and typically using 
the abilities of the actor to do so.</p>
</div>
</div>
<div class="sect2">
<h3 id="_actors_use_their_abilities_to_interact_with_the_system"><a class="anchor" href="#_actors_use_their_abilities_to_interact_with_the_system"></a>9.12. Actors use their abilities to interact with the system</h3>
<div class="paragraph">
<p>Let’s see this principle in action in another test. The Todo 
application has a counter in the bottom left hand corner indicating the 
remaining number of items (see <a href="#fig-journey-remaining-count">The number of remaining items is displayed in the bottom left corner of the list</a>).</p>
</div>
<div id="fig-journey-remaining-count" class="imageblock">
<div class="content">
<img src="The%20Serenity%20Reference%20Manual_files/journey-remaining-count.png" alt="journey remaining count">
</div>
<div class="title">Figure 31. The number of remaining items is displayed in the bottom left corner of the list</div>
</div>
<div class="paragraph">
<p>The test to describe and verify this behavior could look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    <span class="annotation">@Test</span>
    <span class="directive">public</span> <span class="type">void</span> items_left_counter_should_be_decremented_when_an_item_is_completed() {

        givenThat(james).wasAbleTo(OpenTheApplication.onTheHomePage());
        andThat(james).wasAbleTo(AddTodoItems.called(<span class="string"><span class="delimiter">"</span><span class="content">Walk the dog</span><span class="delimiter">"</span></span>, <span class="string"><span class="delimiter">"</span><span class="content">Put out the garbage</span><span class="delimiter">"</span></span>));

        when(james).attemptsTo(
                Complete.itemCalled(<span class="string"><span class="delimiter">"</span><span class="content">Walk the dog</span><span class="delimiter">"</span></span>)
        );

        then(james).should(seeThat(TheRemainingItemCount.value(), is(<span class="integer">1</span>)));
    }
    <span class="comment">// end::items_left_counter_should_be_decremented_when_an_item_is_completed</span>

    <span class="annotation">@Test</span>
    <span class="directive">public</span> <span class="type">void</span> completed_items_should_not_appear_in_the_active_list() {

        givenThat(james).wasAbleTo(OpenTheApplication.onTheHomePage());
        andThat(james).wasAbleTo(AddTodoItems.called(<span class="string"><span class="delimiter">"</span><span class="content">Walk the dog</span><span class="delimiter">"</span></span>, <span class="string"><span class="delimiter">"</span><span class="content">Put out the garbage</span><span class="delimiter">"</span></span>));

        when(james).attemptsTo(
                Complete.itemCalled(<span class="string"><span class="delimiter">"</span><span class="content">Walk the dog</span><span class="delimiter">"</span></span>),
                FilterItems.byStatus(Active)
        );

        then(james).should(seeThat(theDisplayedItems, not(contains(<span class="string"><span class="delimiter">"</span><span class="content">Walk the dog</span><span class="delimiter">"</span></span>))));
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The test needs to check that the number of remaining items is 1. The corresponding assertion is in the last line of the test:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">then(james).should(seeThat(TheRemainingItemCount.value(), is(<span class="integer">1</span>)));</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Question object here is defined by the <code>TheRemainingItemCount</code>
 class.  This class has one very precise responsibility: to read the 
number in the remaining item count text displayed at the bottom of the 
todo list.</p>
</div>
<div class="paragraph">
<p>The static <code>value()`</code> method is a simple factory method that returns a new instance of the <code>TheRemainingItemCount</code> class.  This is simply to make the code read more fluently.</p>
</div>
<div class="paragraph">
<p><code>Question</code> objects are similar to <code>Task</code> and <code>Action</code> objects. However, instead of the <code>performAs()</code> used for Tasks and Actions, a Question class needs to implement the <code>answeredBy(actor)</code> method, and return a result of a specified type. The <code>TheRemainingItemCount</code>
 class is configured to return an Integer. Since it will be querying the
 web interface, we can extend the WebQuestion class to give us access to
 the powerful Serenity WebDriver API.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">TheRemainingItemCount</span> <span class="directive">extends</span> WebQuestion <span class="directive">implements</span> Question&lt;<span class="predefined-type">Integer</span>&gt; {
    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">Integer</span> answeredBy(Actor actor) {...}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Serenity provides a number of Interaction classes that let you query 
the web page using a fluent API. A simple implementation using this 
approach might be the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    <span class="directive">public</span> <span class="predefined-type">Integer</span> answeredBy(Actor actor) {
        <span class="keyword">return</span> Text.of(TodoCounter.ITEM_COUNT)
                   .onTheScreenOf(actor)
                   .asInteger();
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>There are interaction classes for most WebDriver calls, including:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Attribute</p>
</li>
<li>
<p>CSSValue</p>
</li>
<li>
<p>CurrentlyEnabled</p>
</li>
<li>
<p>CurrentVisibility</p>
</li>
<li>
<p>Enabled</p>
</li>
<li>
<p>JavaScript</p>
</li>
<li>
<p>Presence</p>
</li>
<li>
<p>SelectedOptions</p>
</li>
<li>
<p>SelectedStatus</p>
</li>
<li>
<p>SelectedValue</p>
</li>
<li>
<p>SelectedVisibleTextValue</p>
</li>
<li>
<p>Text</p>
</li>
<li>
<p>TheCoordinates</p>
</li>
<li>
<p>TheLocation</p>
</li>
<li>
<p>TheSize</p>
</li>
<li>
<p>Value</p>
</li>
<li>
<p>Visibility</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A few examples of these methods are shown here:</p>
</div>
<div class="paragraph">
<p>Read the visible text value of a the <code>COUNTRY</code> dropdown list:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">String</span> country = SelectedVisibleTextValue.of(ProfilePage.COUNTRY).onTheScreenOf(actor).value();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Determine whether the <code>completeItemButton</code> checkbox is checked:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Boolean</span> itemChecked = SelectedStatus.of(completeItemButton).onTheScreenOf(actor).as(<span class="predefined-type">Boolean</span>.class);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Determine whether the <code>completeItemButton</code> checkbox is checked:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Boolean</span> itemChecked = SelectedStatus.of(completeItemButton).onTheScreenOf(actor).as(<span class="predefined-type">Boolean</span>.class);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Return a list of all the elements matching the <code>TODO_ITEMS</code> target:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">return</span> Text.of(ToDoList.TODO_ITEMS)
           .onTheScreenOf(actor)
           .asList();</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_advanced_webdriver_integration"><a class="anchor" href="#_advanced_webdriver_integration"></a>10. Advanced WebDriver integration</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_custom_webdriver_implementations"><a class="anchor" href="#_custom_webdriver_implementations"></a>10.1. Custom WebDriver implementations</h3>
<div class="paragraph">
<p>You can add your own custom WebDriver provider by implementing the 
DriverSource interface. First, you need to set up the following system 
properties (e.g. in your <code>serenity.properties</code> file):</p>
</div>
<div class="listingblock">
<div class="content">
<pre>webdriver.driver = provided
webdriver.provided.type = mydriver
webdriver.provided.mydriver = com.acme.MyPhantomJSDriver
thucydides.driver.capabilities = mydriver</pre>
</div>
</div>
<div class="paragraph">
<p>Your custom driver must implement the DriverSource interface, as shown here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">MyPhantomJSDriver</span> <span class="directive">implements</span> DriverSource {

    <span class="annotation">@Override</span>
    <span class="directive">public</span> WebDriver newDriver() {
        <span class="keyword">try</span> {
            DesiredCapabilities capabilities = DesiredCapabilities.phantomjs();
            <span class="comment">// Add</span>
            <span class="keyword">return</span> <span class="keyword">new</span> PhantomJSDriver(ResolvingPhantomJSDriverService.createDefaultService(), capabilities);
        }
        <span class="keyword">catch</span> (<span class="exception">IOException</span> e) {
            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">Error</span>(e);
        }
    }

        <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">boolean</span> takesScreenshots() {
        <span class="keyword">return</span> <span class="predefined-constant">true</span>;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This driver will now take screenshots normally.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_running_remote_tests"><a class="anchor" href="#_running_remote_tests"></a>11. Running Remote tests</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can also use Serenity to run your WebDriver tests on a remote 
machine, such as a Selenium Grid or a remote service such as provided by
 <a href="http://www.saucelabs.com/">SauceLabs</a> or <a href="https://www.browserstack.com/">BrowserStack</a>.
 This allows you to run your web tests against a variety of different 
browsers and operating systems, and also benefit from faster test 
execution when running the tests in parallel.</p>
</div>
<div class="paragraph">
<p>In all cases, you tell Serenity to run tests remotely by using the Selenium Remote driver,</p>
</div>
<div class="sect2">
<h3 id="_running_tests_against_a_selenium_grid_server"><a class="anchor" href="#_running_tests_against_a_selenium_grid_server"></a>11.1. Running tests against a Selenium Grid server</h3>
<div class="paragraph">
<p><a href="https://code.google.com/p/selenium/wiki/Grid2">Selenium Grid</a> allows you to run tests on a number of remote machines. It is open source, and relatively easy to set up and configure.</p>
</div>
<div class="paragraph">
<p>To run your Serenity tests on a Selenium Grid, you need to provide the URL of the Selenium Hub using the <code>webdriver.remote.url</code>
 property. You may also want to provide more information about how and 
where you want to run your tests, using the following properties:
<code>webdriver.remote.driver</code>:: What driver to use remotely (<em>firefox</em>,<em>chrome</em>,<em>iexplorer</em> etc.)
<code>webdriver.remote.browser.version</code>:: What version of the remote browser to use
<code>webdriver.remote.os</code>:: What operating system the tests should be run on.</p>
</div>
<div class="paragraph">
<p>For example, if you were running a Selenium Hub locally on port 4444 (the default),</p>
</div>
<div class="listingblock">
<div class="content">
<pre>mvn verify -Dwebdriver.remote.url=http://localhost:4444/wd/hub -Dwebdriver.remote.driver=chrome -Dwebdriver.remote.os=WINDOWS</pre>
</div>
</div>
<div class="paragraph">
<p>If you are running PhantomJS remotely, you may need to specify what port PhantomJS is to run on using the <code>phantomjs.webdriver</code> property.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>mvn verify -Dphantomjs.webdriver=5555 -Dwebdriver.remote.url=http://seleniumgrid:4444/wd/hub</pre>
</div>
</div>
<div class="paragraph">
<p>You can also pass the usual driver-specific capabilities to the remote browser</p>
</div>
<div class="listingblock">
<div class="content">
<pre>mvn verify -Dwebdriver.remote.url=http://localhost:4444/wd/hub -Dwebdriver.remote.driver=chrome -Dwebdriver.remote.os=WINDOWS -Dchrome.switches="--no-sandbox,--ignore-certificate-errors,--homepage=about:blank,--no-first-run"</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_running_tests_on_appium"><a class="anchor" href="#_running_tests_on_appium"></a>11.2. Running tests on Appium</h3>
<div class="paragraph">
<p>Serenity supports running tests on mobile devices/emulators out of the box with <a href="http://appium.io/">Appium</a>.</p>
</div>
<div class="paragraph">
<p>You just need to install Appium:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>(sudo) npm install -g appium --chromedriver_version="2.16"</pre>
</div>
</div>
<div class="paragraph">
<p>Afterwards Appium is available as command and can be started by invoking the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>appium</pre>
</div>
</div>
<div class="paragraph">
<p>Then adopt <code>serenity.properties</code> to run on an Android device:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>webdriver.driver= appium
webdriver.base.url = http://www.google.com/
appium.hub = http://127.0.0.1:4723/wd/hub
appium.platformName = Android
appium.platformVersion = 5.1.1
appium.deviceName = e2f5c460
appium.browserName = Chrome</pre>
</div>
</div>
<div class="paragraph">
<p>Here’s an example for iOS:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>webdriver.driver= appium
webdriver.base.url = http://www.google.com/
appium.hub = http://127.0.0.1:4723/wd/hub
appium.platformName = iOS
appium.platformVersion = 8.1
appium.deviceName = iPhone 5
appium.browserName = Safari</pre>
</div>
</div>
<div class="paragraph">
<p>Besides the properties file you can also use commandline switches:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>mvn test -Dappium.hub=http://127.0.0.1:4723/wd/hub -Dwebdriver.driver=appium -Dappium.platformName=iOS -Dappium.browserName=Safari -Dappium.deviceName="iPhone 5"</pre>
</div>
</div>
<div class="paragraph">
<p>You can also add Appium to an existing grid. See the <a href="http://appium.io/slate/en/v1.2.3/?java#server-flags">Appium documentation</a> for more details about the node-config option.</p>
</div>
</div>
<div class="sect2">
<h3 id="_running_tests_on_saucelabs"><a class="anchor" href="#_running_tests_on_saucelabs"></a>11.3. Running tests on SauceLabs</h3>
<div class="paragraph">
<p>Serenity has special support for running tests on the Cloud-based testing platform <a href="http://www.saucelabs.com/">SauceLabs</a>. The general approach is the same as discussed above, but there are a few extra Saucelabs-specific properties:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>saucelabs.url</code></dt>
<dd>
<p>Usually of the form <a href="http://&lt;my_id&gt;:&lt;my_API" class="bare">http://&lt;my_id&gt;:&lt;my_API</a> Key&gt;@ondemand.saucelabs.com:80/wd/hub</p>
</dd>
<dt class="hdlist1"><code>saucelabs.target.platform</code></dt>
<dd>
<p>See <a href="https://saucelabs.com/platforms/" class="bare">https://saucelabs.com/platforms/</a></p>
</dd>
<dt class="hdlist1"><code>saucelabs.driver.version</code></dt>
<dd>
<p>See <a href="https://saucelabs.com/platforms/" class="bare">https://saucelabs.com/platforms/</a></p>
</dd>
<dt class="hdlist1"><code>saucelabs.test.name</code></dt>
<dd>
<p>The name of the test as it will appear on the Saucelabs site</p>
</dd>
<dt class="hdlist1"><code>saucelabs.access.key</code></dt>
<dd>
<p>Your Saucelabs API key, optional, used to generate links to the Saucelabs results</p>
</dd>
<dt class="hdlist1"><code>saucelabs.user.id</code></dt>
<dd>
<p>Your Saucelabs User ID, optional, used to generate links to the Saucelabs results
<code>saucelabs.record.screenshots</code>::Saucelabs records screenshots
 as well as videos by default. Since Serenity also records screenshots, 
this feature is disabled by default. It can be reactivated using this 
system property</p>
</dd>
<dt class="hdlist1"><code>saucelabs.implicit.wait</code></dt>
<dd>
<p>Override the default implicit timeout value for the Saucelabs driver</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>An example of running tests on Saucelabs is shown here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>mvn verify -Dsaucelabs.target.platform=XP -Dwebdriver.driver=chrome -Dsaucelabs.driver.version=26 -Dsaucelabs.url=http://&lt;my_id&gt;:&lt;my_API Key&gt;@ondemand.saucelabs.com:80/wd/hub -Dsaucelabs.access.key=&lt;My_API_Key&gt; -Dsaucelabs.user.id=&lt;my_id&gt; -Dwebdriver.base.url=https://www.website.com -Dmaven.test.failure.ignore=true</pre>
</div>
</div>
<div class="paragraph">
<p>In case if you need to define an OS-Browser Combination, you should change <strong>serenity.driver.capabilities</strong> as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>serenity.driver.capabilities="browserName:iphone; deviceName:iPad Retina; version:9.2"</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_running_tests_on_mobile_devices_with_appium"><a class="anchor" href="#_running_tests_on_mobile_devices_with_appium"></a>11.4. Running tests on Mobile Devices with Appium</h3>

</div>
<div class="sect2">
<h3 id="_running_tests_on_browserstack"><a class="anchor" href="#_running_tests_on_browserstack"></a>11.5. Running tests on BrowserStack</h3>
<div class="paragraph">
<p>The setup for running tests on BrowserStack is similar to the one for SauceLabs. The following system properties are available:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>browserstack.url</code></dt>
<dd>
<p>BrowserStack Hub URL if running the tests on BrowserStack Cloud</p>
</dd>
<dt class="hdlist1"><code>browserstack.os</code></dt>
<dd>
<p>OS type (e.g. WINDOWS, OS X)</p>
</dd>
<dt class="hdlist1"><code>browserstack.os_version</code></dt>
<dd>
<p>OS version (e.g. Windows: XP, 7, 8 and 8.1; OS X: Snow Leopard, Lion, Mountain Lion, Mavericks, Yosemite, El Capitan)</p>
</dd>
<dt class="hdlist1"><code>browserstack.browser</code></dt>
<dd>
<p>Browser type (e.g. Firefox, Safari, IE, Chrome, Opera)</p>
</dd>
<dt class="hdlist1"><code>browserstack.browser_version</code></dt>
<dd>
<p>Browser version (defaults to latest stable; check <a href="https://www.browserstack.com/list-of-browsers-and-platforms?product=automate">list of available browsers</a>)</p>
</dd>
<dt class="hdlist1"><code>browserstack.device</code></dt>
<dd>
<p>BrowserStack <a href="https://www.browserstack.com/list-of-browsers-and-platforms?product=automate">mobile device</a> name on which tests should be run</p>
</dd>
<dt class="hdlist1"><code>browserstack.deviceOrientation</code></dt>
<dd>
<p>Set the screen orientation of BrowserStack mobile device (portrait or landscape, default: portrait)</p>
</dd>
<dt class="hdlist1"><code>browserstack.project</code></dt>
<dd>
<p>Specify a name for a logical group of builds on BrowserStack</p>
</dd>
<dt class="hdlist1"><code>browserstack.build</code></dt>
<dd>
<p>Specify a name for a logical group of tests on BrowserStack</p>
</dd>
<dt class="hdlist1"><code>browserstack.name</code></dt>
<dd>
<p>Specify an identifier for the test run on BrowserStack</p>
</dd>
<dt class="hdlist1"><code>browserstack.local</code></dt>
<dd>
<p>For Testing against <a href="https://www.browserstack.com/local-testing">internal/local</a> servers on BrowserStack</p>
</dd>
<dt class="hdlist1"><code>browserstack.debug</code></dt>
<dd>
<p>Generates screenshots at various steps in tests on BrowserStack</p>
</dd>
<dt class="hdlist1"><code>browserstack.resolution</code></dt>
<dd>
<p>Sets resolution of VM on BrowserStack</p>
</dd>
<dt class="hdlist1"><code>browserstack.selenium_version</code></dt>
<dt class="hdlist1"><code>browserstack.ie.noFlash</code></dt>
<dd>
<p>Disable flash on Internet Explorer on BrowserStack</p>
</dd>
<dt class="hdlist1"><code>browserstack.ie.driver</code></dt>
<dd>
<p>Specify the Internet Explorer webdriver version on BrowserStack</p>
</dd>
<dt class="hdlist1"><code>browserstack.ie.enablePopups</code></dt>
<dd>
<p>Enable the popup blocker in Internet Explorer on BrowserStack</p>
</dd>
</dl>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_managing_screenshots"><a class="anchor" href="#_managing_screenshots"></a>12. Managing screenshots</h2>
<div class="sectionbody">
<div class="paragraph">
<p>By default, Serenity saves a screenshot for every step executed 
during the tests. Serenity can be configured to control when screenshots
 are stored.</p>
</div>
<div class="sect2">
<h3 id="_configuring_when_screenshots_are_taken"><a class="anchor" href="#_configuring_when_screenshots_are_taken"></a>12.1. Configuring when screenshots are taken</h3>
<div class="paragraph">
<p>The property <code>serenity.take.screenshots</code> can be set to configure how often the screenshots are taken. This property can take the following values:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>FOR_EACH_ACTION</code></dt>
<dd>
<p>Saves a screenshot at every web element action (like click(), typeAndEnter(), type(), typeAndTab() etc.).</p>
</dd>
<dt class="hdlist1"><code>BEFORE_AND_AFTER_EACH_STEP</code></dt>
<dd>
<p>Saves a screeshot before and asfter every step.</p>
</dd>
<dt class="hdlist1"><code>AFTER_EACH_STEP</code></dt>
<dd>
<p>Saves a screenshot after every step</p>
</dd>
<dt class="hdlist1"><code>FOR_FAILURES</code></dt>
<dd>
<p>Saves screenshots only for failing steps. This can save disk space 
and speed up the tests a little. It is very useful for data-driven 
testing.</p>
</dd>
<dt class="hdlist1"><code>DISABLED</code></dt>
<dd>
<p>Doesn’t save screenshots for any steps.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="_using_annotations_to_control_screenshots"><a class="anchor" href="#_using_annotations_to_control_screenshots"></a>12.2. Using annotations to control screenshots</h3>
<div class="paragraph">
<p>An even more granular level of control is possible using annotations.
 You can annotate any test or step method (or any method used by a step 
or test) with the <code>@Screenshots</code> annotation to override the number of screenshots taken within this step (or sub-step). Some sample uses are shown here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Step</span>
<span class="annotation">@Screenshots</span>(onlyOnFailures=<span class="predefined-constant">true</span>)
<span class="directive">public</span> <span class="type">void</span> screenshots_will_only_be_taken_for_failures_from_here_on() {<span class="error">…</span>}

<span class="annotation">@Test</span>
<span class="annotation">@Screenshots</span>(forEachStep=<span class="predefined-constant">true</span>)
<span class="directive">public</span> <span class="type">void</span> should_take_screenshots_for_each_step_in_this_test() {<span class="error">…</span>}

<span class="annotation">@Test</span>
<span class="annotation">@Screenshots</span>(forEachAction=<span class="predefined-constant">true</span>)
<span class="directive">public</span> <span class="type">void</span> should_take_screenshots_for_each_action_in_this_test() {<span class="error">…</span>}

<span class="annotation">@Test</span>
<span class="annotation">@Screenshots</span>(disabled=<span class="predefined-constant">true</span>)
<span class="directive">public</span> <span class="type">void</span> should_not_take_screenshots_for_any_action_in_this_test(() {<span class="error">…</span>}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_taking_screenshots_at_any_arbitrary_point_during_a_step"><a class="anchor" href="#_taking_screenshots_at_any_arbitrary_point_during_a_step"></a>12.3. Taking screenshots at any arbitrary point during a step</h3>
<div class="paragraph">
<p>It is possible to have even finer control on capturing screenshots in the tests. Using the <code>takeScreenshot</code>
 method, you can  instruct Serenity to take a screenshot at any 
arbitrary point in the step irrespective of the screenshot level set 
using configuration or annotations.</p>
</div>
<div class="paragraph">
<p>Simply call <code>Serenity.takeScreenshot()</code> in the step methods whenever you want a screenshot to be captured.</p>
</div>
</div>
<div class="sect2">
<h3 id="_increasing_the_size_of_screenshots"><a class="anchor" href="#_increasing_the_size_of_screenshots"></a>12.4. Increasing the size of screenshots</h3>
<div class="paragraph">
<p>Sometimes the default window size is too small to display all of the 
application screen in the screenshots. You can increase the size of the 
window Serenity opens by providing the <code>Serenity.browser.width</code> and <code>Serenity.browser.height</code> system properties. For example, to use a browser window with dimensions of 1200x1024, you could do the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ mvn clean verify -Dserenity.browser.width=1200 -DSerenity.browser.height=1024</pre>
</div>
</div>
<div class="paragraph">
<p>Typically, the width parameter is the only one you will need to 
specify, as the height will be determined by the contents of the browser
 page.</p>
</div>
<div class="paragraph">
<p>If you are running Serenity with JUnit, you can also specify this 
parameter (and any of the others, for that matter) directly in your 
pom.xml file, in the maven-surefire-plugin configuration, e.g:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;build&gt;</span>
    <span class="tag">&lt;plugins&gt;</span>
        <span class="tag">&lt;plugin&gt;</span>
            <span class="tag">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/groupId&gt;</span>
            <span class="tag">&lt;artifactId&gt;</span>maven-surefire-plugin<span class="tag">&lt;/artifactId&gt;</span>
            <span class="tag">&lt;version&gt;</span>2.7.1<span class="tag">&lt;/version&gt;</span>
            <span class="tag">&lt;configuration&gt;</span>
                <span class="tag">&lt;argLine&gt;</span>-Xmx1024m<span class="tag">&lt;/argLine&gt;</span>
                <span class="tag">&lt;systemPropertyVariables&gt;</span>
                    <span class="tag">&lt;serenity.browser.width&gt;</span>1200<span class="tag">&lt;/serenity.browser.width&gt;</span>
                <span class="tag">&lt;/systemPropertyVariables&gt;</span>
            <span class="tag">&lt;/configuration&gt;</span>
        <span class="tag">&lt;/plugin&gt;</span>
        ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>When the browser width is larger than 1000px, the slideshow view in the reports will expand to show the full screenshots.</p>
</div>
<div class="paragraph">
<p>Note there are some caveats with this feature. In particular, it will
 not work at all with Chrome, as Chrome, by design, does not support 
window resizing. In addition, since WebDriver uses a real browser, so 
the maximum size will be limited by the physical size of the browser. 
This limitation applies to the browser width, as the full vertical 
length of the screen will still be recorded in the screenshot even if it
 scrolls beyond a single page.</p>
</div>
<div class="sect3">
<h4 id="_screenshots_and_outofmemoryerror_issues"><a class="anchor" href="#_screenshots_and_outofmemoryerror_issues"></a>12.4.1. Screenshots and OutOfMemoryError issues</h4>
<div class="paragraph">
<p>Selenium needs memory to take screenshots, particularly if the 
screens are large. If Selenium runs out of memory when taking 
screenshots, it will log an error in the test output. In this case, 
configure the maven-surefire-plugin to use more memory, as illustrated 
here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;plugin&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>maven-surefire-plugin<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;version&gt;</span>2.7.1<span class="tag">&lt;/version&gt;</span>
    <span class="tag">&lt;configuration&gt;</span>
        <span class="tag">&lt;argLine&gt;</span>-Xmx1024m<span class="tag">&lt;/argLine&gt;</span>
    <span class="tag">&lt;/configuration&gt;</span>
<span class="tag">&lt;/plugin&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_saving_raw_screenshots"><a class="anchor" href="#_saving_raw_screenshots"></a>12.5. Saving raw screenshots</h3>
<div class="paragraph">
<p>Serenity saves only rescaled screenshots by default. This is done to 
help reduce the disk space taken by reports. If you require to save the 
original unscaled screenshots, this default can be easily overridden by 
setting the property, <code>serenity.keep.unscaled.screenshots</code> to <code>true</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_saving_html_source_files_for_screenshots"><a class="anchor" href="#_saving_html_source_files_for_screenshots"></a>12.6. Saving HTML source files for screenshots</h3>
<div class="paragraph">
<p>It is possible to save html source files for the screenshots by setting the property, <code>serenity.store.html.source</code> to <code>true</code>. Html source files are not saved by default to conserve disk space.</p>
</div>
</div>
<div class="sect2">
<h3 id="_blurring_sensitive_screenshots"><a class="anchor" href="#_blurring_sensitive_screenshots"></a>12.7. Blurring sensitive screenshots</h3>
<div class="paragraph">
<p>For security/privacy reasons, it may be required to blur sensitive 
screenshots in Serenity reports. This can be done by annotating the test
 methods or steps with the annotation <code>@BlurScreenshots</code>. 
When defined on a test, all screenshots for that test will be blurred. 
When defined on a step, only the screenshot for that step will be 
blurred. @BlurredScreenshot takes a string parameter with values <code>LIGHT, MEDIUM</code> or <code>HEAVY</code> to indicate the amount of blurring. For example,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Test</span>
<span class="annotation">@BlurScreenshots</span>(<span class="string"><span class="delimiter">"</span><span class="content">HEAVY</span><span class="delimiter">"</span></span>)
<span class="directive">public</span> <span class="type">void</span> looking_up_the_definition_of_pineapple_should_display_the_corresponding_article() {
    endUser.is_the_home_page();
    endUser.looks_for(<span class="string"><span class="delimiter">"</span><span class="content">pineapple</span><span class="delimiter">"</span></span>);
    endUser.should_see_definition_containing_words(<span class="string"><span class="delimiter">"</span><span class="content">A thorny fruit</span><span class="delimiter">"</span></span>);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A screen at various blur levels is shown below.</p>
</div>
<div id="fig-screen_blur_light" class="imageblock">
<div class="content">
<img src="The%20Serenity%20Reference%20Manual_files/light.png" alt="light" width="475">
</div>
<div class="title">Figure 32. A lightly blurred screenshot</div>
</div>
<div id="fig-screen_blur_medium" class="imageblock">
<div class="content">
<img src="The%20Serenity%20Reference%20Manual_files/medium.png" alt="medium" width="475">
</div>
<div class="title">Figure 33. A medium blurred screenshot</div>
</div>
<div id="fig-screen_blur_heavy" class="imageblock">
<div class="content">
<img src="The%20Serenity%20Reference%20Manual_files/heavy.png" alt="heavy" width="475">
</div>
<div class="title">Figure 34. A heavily blurred screenshot</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_retrying_failed_tests"><a class="anchor" href="#_retrying_failed_tests"></a>13. Retrying failed tests</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Sometimes it is required to retry a failed test. This can be achieved by setting the system properties <code>junit.retry.tests</code> to true and <code>max.retries</code> to the number of times you want failed tests to be retried. If <code>max.retries</code> provided and <code>junit.retry.tests</code>=true, all method tests will be executed until first successful run, but not more than 1 + <code>max.retries</code> times.</p>
</div>
<div class="paragraph">
<p>Here is short example, for it we will use next test class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@RunWith</span>(SerenityRunner.class)
<span class="directive">public</span> <span class="type">class</span> <span class="class">SampleTest</span> {

    <span class="annotation">@Steps</span>
    TestSteps steps;

    <span class="annotation">@Test</span>
    <span class="directive">public</span> <span class="type">void</span> shouldExecuteThisTest() {
        steps.initialization(<span class="integer">2</span>);
        steps.when_example_action_for(<span class="integer">1</span>);
        steps.then_example_result_should_be(<span class="integer">2</span>);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Steps class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">TestSteps</span> {

    <span class="directive">private</span> <span class="directive">static</span> <span class="predefined-type">Integer</span> counter = <span class="integer">2</span>;

    <span class="annotation">@Step</span>
    <span class="directive">public</span> <span class="type">void</span> initialization(<span class="directive">final</span> <span class="type">int</span> value) {
        action();
    }

    <span class="annotation">@Step</span>
    <span class="directive">public</span> <span class="type">void</span> when_example_action_for(<span class="directive">final</span> <span class="type">int</span> value) {
        action();
        Assert.assertTrue(<span class="predefined-constant">true</span>);
    }

    <span class="annotation">@Step</span>
    <span class="directive">public</span> <span class="type">void</span> then_example_result_should_be(<span class="directive">final</span> <span class="type">int</span> value) {
        action();
        Assert.assertTrue(--counter &lt;= <span class="integer">0</span>);
    }

    <span class="directive">private</span> <span class="type">void</span> action() {
        <span class="comment">//some action</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If this test will be executed - it will fail:</p>
</div>
<div id="retry_test_fail" class="imageblock">
<div class="content">
<img src="The%20Serenity%20Reference%20Manual_files/retry_test_fail.png" alt="retry test fail">
</div>
<div class="title">Figure 35. Report with failed scenario</div>
</div>
<div class="paragraph">
<p>If we provide next properties in serenity.property file, framework 
will execute tests more according to configuration until test will be 
successful or number of tries will be reached:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>max.retries=4
junit.retry.tests=true</pre>
</div>
</div>
<div class="paragraph">
<p>After executing same test it will be successful - because method <code>then_example_result_should_be</code> fails only twice, and third "try" will successful:</p>
</div>
<div id="retry_test_fail" class="imageblock">
<div class="content">
<img src="The%20Serenity%20Reference%20Manual_files/retry_test_success.png" alt="retry test success">
</div>
<div class="title">Figure 36. Report with successful scenario</div>
</div>
<div class="paragraph">
<p>If you’re using Jenkins for aggregating your test results use this folder pattern for JUnit test results:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>target/site/serenity/SERENITY-JUNIT-*.xml</pre>
</div>
</div>
<div class="paragraph">
<p>This will exclude the previous failed tests from your report.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_filtering_test_executing_with_tags"><a class="anchor" href="#_filtering_test_executing_with_tags"></a>14. Filtering test executing with tags</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In real-world projects, scenarios can become quite numerous, and it’s
 important to keep them well organized. You may also need to be able to 
identify and group scenarios in different ways;
for example, you might want to distinguish UI-related scenarios from 
batch-processing scenarios, or identify the regression scenarios only.</p>
</div>
<div class="paragraph">
<p>Tags are also a great way to help organize test execution. For 
example, you might want to flag all of the web services tests, or mark 
certain tests to run against Internet Explorer browser only.</p>
</div>
<div class="sect2">
<h3 id="_annotating_scenarios_with_tags"><a class="anchor" href="#_annotating_scenarios_with_tags"></a>14.1. Annotating scenarios with tags</h3>
<div class="paragraph">
<p>Tags are added to JUnit tests using <code>WithTag</code> annotation. The following will add a tag of type <em>epic</em> with name <em>Audit</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@WithTag</span>(type=<span class="string"><span class="delimiter">"</span><span class="content">epic</span><span class="delimiter">"</span></span>, name=<span class="string"><span class="delimiter">"</span><span class="content">Audit</span><span class="delimiter">"</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>If no type is defined, the default tag type is assumed to be <em>feature</em>. In other words, the following two tags are equivalent:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@WithTag</span>(type=<span class="string"><span class="delimiter">"</span><span class="content">feature</span><span class="delimiter">"</span></span>, name=<span class="string"><span class="delimiter">"</span><span class="content">Reporting</span><span class="delimiter">"</span></span>)
<span class="annotation">@WithTag</span>(name=<span class="string"><span class="delimiter">"</span><span class="content">Reporting</span><span class="delimiter">"</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>WithTag</code> has an alternative, more concise syntax using a colon (:) to separate the tag <em>type</em> and <em>name</em>. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@WithTag</span>(<span class="string"><span class="delimiter">"</span><span class="content">epic:Audit</span><span class="delimiter">"</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@WithTag</span>(<span class="string"><span class="delimiter">"</span><span class="content">feature:Reporting</span><span class="delimiter">"</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Multiple tags can be added using <code>@WithTags</code> annotation or it’s shorter version - <code>@WithTagsValuesOf</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@WithTags</span> (
        {
                <span class="annotation">@WithTag</span>(type=<span class="string"><span class="delimiter">"</span><span class="content">feature</span><span class="delimiter">"</span></span>, name=<span class="string"><span class="delimiter">"</span><span class="content">Reporting</span><span class="delimiter">"</span></span>),
                <span class="annotation">@WithTag</span>(type=<span class="string"><span class="delimiter">"</span><span class="content">release</span><span class="delimiter">"</span></span>, name=<span class="string"><span class="delimiter">"</span><span class="content">sprint-2</span><span class="delimiter">"</span></span>)
        }
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using <code>@WithTagsValuesOf</code>, the above can be written more succinctly as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@WithTagsValuesOf</span>({<span class="string"><span class="delimiter">"</span><span class="content">Reporting</span><span class="delimiter">"</span></span>, <span class="string"><span class="delimiter">"</span><span class="content">release:sprint-2</span><span class="delimiter">"</span></span>})</code></pre>
</div>
</div>
<div class="paragraph">
<p>In JBehave, you can add tags using the <code>Meta</code> keyword:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Download account statements

Meta:               <i class="conum" data-value="1"></i><b>(1)</b>
<span class="annotation">@web</span> <span class="annotation">@iexplorer</span>     <i class="conum" data-value="2"></i><b>(2)</b>

Scenario: Download account statement in SWIFT MT940 format</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Tags need to be introduced by the Meta keyword</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Tags start with @ and can be any text value</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>With Cucumber, things are even simpler:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="gherkin">Feature: Download account statements
@web @iexplorer     <i class="conum" data-value="1"></i><b>(1)</b>
Scenario: Download account statement in SWIFT MT940 format</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Cucumber doesn’t need the Meta keyword</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>This way, when executing the tests, you can configure one or more 
filters to run (or exclude from run) the tests with a particular tag.</p>
</div>
<div class="paragraph">
<p>You can also use tags as a powerful reporting tool. Using <code>@tag</code> or <code>@tags</code>, Serenity lets you define tags that will appear in the test reports:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Executing an international payment

Meta:
@tag component: payment     <i class="conum" data-value="1"></i><b>(1)</b>

Scenario: Executing an international payment as a standing order</pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Scenarios in this file all involve the Payment component</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>These tags can take any <em>name</em> and <em>value</em> combination and so can be used to report on whatever aspects you need in the living documentation.</p>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
In <code>@Step</code> libraries you have access to both read and add tag values.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>To access current tags:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Step</span>
<span class="directive">public</span> <span class="type">void</span> should_run_just_for_end_to_end_tests () {

        <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; metadata = Serenity.getCurrentSession().getMetaData();

        <span class="keyword">if</span> (!metadata.get(<span class="string"><span class="delimiter">"</span><span class="content">level</span><span class="delimiter">"</span></span>).equalsIgnoreCase(<span class="string"><span class="delimiter">"</span><span class="content">system</span><span class="delimiter">"</span></span>)) {
                StepEventBus.getEventBus().testIgnored();
        }
        <span class="keyword">else</span> {
                <span class="comment">// step logic</span>
        }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To add tags to existing ones:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">void</span> add_tags_based_on_sidebar_status () {
        <span class="keyword">if</span> (sidebar().shows(REPORTS)) {
                <span class="predefined-type">List</span>&lt;TestTag&gt; myTags = Lists.newArrayList(TestTag.withName(<span class="string"><span class="delimiter">"</span><span class="content">Reports</span><span class="delimiter">"</span></span>).andType(<span class="string"><span class="delimiter">"</span><span class="content">feature</span><span class="delimiter">"</span></span>));
                StepEventBus.getEventBus().addTagsToCurrentStory(myTags);
        } elseif (sidebar().shows(DOCUMENTS)) {
                <span class="predefined-type">List</span>&lt;TestTag&gt; myTags = Lists.newArrayList(TestTag.withName(<span class="string"><span class="delimiter">"</span><span class="content">Documents</span><span class="delimiter">"</span></span>).andType(<span class="string"><span class="delimiter">"</span><span class="content">feature</span><span class="delimiter">"</span></span>));
                StepEventBus.getEventBus().addTagsToCurrentStory(myTags);
        }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_running_scenarios_by_tags"><a class="anchor" href="#_running_scenarios_by_tags"></a>14.2. Running scenarios by tags</h3>
<div class="paragraph">
<p>You can filter tests by tag while running Serenity.</p>
</div>
<div class="sect3">
<h4 id="_junit"><a class="anchor" href="#_junit"></a>14.2.1. JUnit</h4>
<div class="paragraph">
<p>With JUnit tests, this can be achieved by providing a single tag or a comma separated list of tags from command line.
If provided, only classes and/or methods with tags in this list will be executed.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">mvn clean verify -Dtags="release:sprint-2"</code></pre>
</div>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">mvn clean verify -Dtags="feature:Reporting, release:sprint-2"</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_cucumber"><a class="anchor" href="#_cucumber"></a>14.2.2. Cucumber</h4>
<div class="paragraph">
<p>With Cucumber framework, you need to use the cucumber.options system property for tests filtering.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">mvn clean verify -Dcucumber.options="--tags release:sprint-2"</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_jbehave"><a class="anchor" href="#_jbehave"></a>14.2.3. JBehave</h4>
<div class="paragraph">
<p>In case JBehave is your framework of choice, you can filter tests by using <code>-Dmetafilter</code> in your maven command, as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">mvn clean verify -Dmetafilter="+feature Reporting"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using JBehave meta matchers you are not only able to specify which tests to run, but also which tests to skip:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">mvn clean verify -Dmetafilter="+release sprint-1 -skip"</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above example, will skip running all the tests assigned to sprint-1. We can even skip a subset of tests, as shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">mvn clean verify -Dmetafilter="+release sprint-2 -feature Reporting"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using this command, we will execute all test cases assigned to sprint-2, excluding those ones written for Reporting feature.</p>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
With JBehave meta matchers, you can use powerful groovy matchers for advanced tests filtering
</td>
</tr>
</tbody></table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">mvn clean verify -Dmetafilter="groovy: level ==~ /.*[testing|regression].*/"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Please read available <a href="http://jbehave.org/reference/stable/meta-filtering.html">JBehave documentation</a> for more info on meta matchers.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_integration_with_issue_project_tracking_systems"><a class="anchor" href="#_integration_with_issue_project_tracking_systems"></a>15. Integration with Issue &amp; Project Tracking systems</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Serenity BDD provides different ways of integration with issue and 
project tracking systems. Most simple way - including references to 
issues in reports of tests. Also Serenity BDD allow create two way JIRA 
integrations.</p>
</div>
<div class="sect2">
<h3 id="_linking_scenarios_tests_with_issues"><a class="anchor" href="#_linking_scenarios_tests_with_issues"></a>15.1. Linking scenarios/tests with issues</h3>
<div class="paragraph">
<p>Serenity BDD allows create links between stories/tests and issues. 
Sometimes it is useful for complex development workflow, and for 
organizing self-documented tests.</p>
</div>
<div class="paragraph">
<p>Configuration of links is made by annotations and property <code>serenity.issue.tracker.url</code> that can be provided in serenity.params or using system variables. The URL provided by <code>serenity.issue.tracker.url</code> is used as "body of link", and issue name provided in annotations - last part of this link.</p>
</div>
<div class="paragraph">
<p>Generally in annotations you should use name of issues according to 
mask #(NAME)(-)(NUMBER), link will be created to (NAME)(-)(NUMBER), 
below you can find example.</p>
</div>
<div class="sect3">
<h4 id="_linking_with_issues_for_junit"><a class="anchor" href="#_linking_with_issues_for_junit"></a>15.1.1. Linking with issues for JUnit</h4>
<div class="paragraph">
<p>When tests created with JUnit you can use annotations <code>@Issue</code>, <code>@Issues</code>, <code>@Title</code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>@Issue</code> used for linking single issue. It should be initialised with name of referenced issue, started with <code>#</code></p>
</li>
<li>
<p><code>@Issues</code> used for linking multiple issues. It should be initialised with array with names of referenced issues, started with <code>#</code></p>
</li>
<li>
<p><code>@Title</code> used for providing readable name of test case (more in <a href="#_human_readable_method_titles">Human-readable method titles</a>), also it can be used to linking multiple issues to this scenario - in title should be included name of issue started with <code>#</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Here is little example with test cases linked to issues:</p>
</div>
<div class="paragraph">
<p>serenity.properties contains:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="gherkin">serenity.issue.tracker.url = https://example.server.com/cases/view/{0}</code></pre>
</div>
</div>
<div class="paragraph">
<p>test class looks like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@RunWith</span>(SerenityRunner.class)
<span class="directive">public</span> <span class="type">class</span> <span class="class">SampleTest</span> {

    <span class="annotation">@Steps</span>
    TestSteps steps;

    <span class="annotation">@Test</span>
    <span class="annotation">@Title</span>(<span class="string"><span class="delimiter">"</span><span class="content">Test case for some issue #BP-64  </span><span class="delimiter">"</span></span>)
    <span class="directive">public</span> <span class="type">void</span> shouldExecuteThisTest() {
        steps.initialization();
        steps.when_example_action_for(<span class="integer">1</span>);
        steps.then_example_result_should_be(<span class="integer">2</span>);
    }

    <span class="annotation">@Test</span>
    <span class="annotation">@Title</span>(<span class="string"><span class="delimiter">"</span><span class="content">Tests important bugs : #BP-64,#IS-84</span><span class="delimiter">"</span></span>)
    <span class="directive">public</span> <span class="type">void</span> shouldExecuteThisTestTwo() {
        steps.initialization();
        steps.when_example_action_for(<span class="integer">1</span>);
        steps.then_example_result_should_be(<span class="integer">2</span>);
    }

    <span class="annotation">@Test</span>
    <span class="annotation">@Issue</span>(<span class="string"><span class="delimiter">"</span><span class="content">#NO-97</span><span class="delimiter">"</span></span>)
    <span class="directive">public</span> <span class="type">void</span> shouldExecuteThisTestThree() {
        steps.initialization();
        steps.when_example_action_for(<span class="integer">1</span>);
        steps.then_example_result_should_be(<span class="integer">2</span>);
    }

    <span class="annotation">@Test</span>
    <span class="annotation">@Issues</span>({<span class="string"><span class="delimiter">"</span><span class="content">#PN-97</span><span class="delimiter">"</span></span>, <span class="string"><span class="delimiter">"</span><span class="content">#KB-927</span><span class="delimiter">"</span></span>})
    <span class="directive">public</span> <span class="type">void</span> shouldExecuteThisTestLast() {
        steps.initialization();
        steps.when_example_action_for(<span class="integer">1</span>);
        steps.then_example_result_should_be(<span class="integer">2</span>);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case report will look like:</p>
</div>
<div id="jbehave-requirements-report" class="imageblock">
<div class="content">
<img src="The%20Serenity%20Reference%20Manual_files/tests_with_references_to_issues.png" alt="tests with references to issues">
</div>
<div class="title">Figure 37. Report with test cases linked to issues</div>
</div>
<div class="paragraph">
<p>Also, all references clickable and will be :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>#PN-97:  https://example.server.com/cases/view/PN-97
#KB-927: https://example.server.com/cases/view/KB-927
#NO-97:  https://example.server.com/cases/view/NO-97</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_linking_with_issues_for_jbehave"><a class="anchor" href="#_linking_with_issues_for_jbehave"></a>15.1.2. Linking with issues for JBehave</h4>
<div class="paragraph">
<p>Also you can use the <code>@issue</code> annotation or <code>#</code> in scenario name to link scenarios with issues when using JBehave, as illustrated here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="gherkin">Meta:
@issue #MYPROJ-1, #MYPROJ-2

Scenario: A scenario that works according #MP-4
Meta:
@issues #MYPROJ-3,#MYPROJ-4
@issue #MYPROJ-5

Given I have an implemented JBehave scenario
And the scenario works
When I run the scenario
Then I should get a successful result</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case links will be created according same rules as for <a href="#_linking_with_issues_for_junit">Linking with issues for JUnit</a></p>
</div>
</div>
<div class="sect3">
<h4 id="_linking_with_issues_for_cucumber"><a class="anchor" href="#_linking_with_issues_for_cucumber"></a>15.1.3. Linking with issues for Cucumber</h4>
<div class="paragraph">
<p>The <code>@issue</code> or <code>@issues</code> annotations can be used in Cucumber <code>.feature</code> files to link scenarios with issues , as shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="gherkin">@issues:ISSUE-123,ISSUE-789
Feature: Basic Arithmetic
  Calculating Additions

  Background: A Calculator
    Given a calculator I just turned on

  @issues:ISSUE-456,ISSUE-001
  Scenario: Addition
    When I add 4 and 5
    Then the result is 9

  @issue:ISSUE-456
  Scenario: Another Addition
    When I add 4 and 7
    Then the result is 11</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_integrating_with_jira"><a class="anchor" href="#_integrating_with_jira"></a>16. Integrating with JIRA</h2>
<div class="sectionbody">
<div class="paragraph">
<p>With Selenium BDD it is possible create tight one and two-way integration with JIRA</p>
</div>
<div class="sect2">
<h3 id="_one_way_integration_with_jira"><a class="anchor" href="#_one_way_integration_with_jira"></a>16.1. One way integration with JIRA</h3>
<div class="paragraph">
<p><a href="https://www.atlassian.com/software/jira">JIRA</a> is a 
popular issue tracking system that is also often used for Agile project 
and requirements management. Many teams using JIRA store their 
requirements electronically in the form of story cards and epics in JIRA</p>
</div>
<div class="paragraph">
<p>Suppose we are implementing a Frequent Flyer application for an 
airline. The idea is that travellers will earn points when they fly with
 our airline, based on the distance they fly. Travellers start out with a
 “Bronze” status, and can earn a better status by flying more 
frequently. Travellers with a higher frequent flyer status benefit from 
advantages such as lounge access, prioritized boarding, and so on. One 
of the story cards for this feature might look like the following:</p>
</div>
<div id="frequent-flyer-story-card" class="imageblock">
<div class="content">
<img src="The%20Serenity%20Reference%20Manual_files/frequent-flyer-story-card.png" alt="frequent flyer story card">
</div>
<div class="title">Figure 38. Frequent Flyer story card</div>
</div>
<div class="paragraph">
<p>This story contains a description following one of the 
frequently-used formats for user story descriptions (“as a..I want..so 
that”). It also contains a custom “Acceptance Criteria” field, where we 
can write down a brief outline of the “definition of done” for this 
story.</p>
</div>
<div class="paragraph">
<p>These stories can be grouped into epics, and placed into sprints for 
project planning, as illustrated in the JIRA Agile board shown here:</p>
</div>
<div id="jira-agile-board" class="imageblock">
<div class="content">
<img src="The%20Serenity%20Reference%20Manual_files/jira-agile-board.png" alt="jira agile board">
</div>
<div class="title">Figure 39. JIRA sample agile board</div>
</div>
<div class="paragraph">
<p>As illustrated in the story card, each of these stories has a set of 
acceptance criteria, which we can build into more detailed scenarios, 
based on concrete examples. We can then automate these scenarios using a
 BDD tool like JBehave.</p>
</div>
<div class="paragraph">
<p>The story in <a href="#frequent-flyer-story-card">Frequent Flyer story card</a>
 describes how many points members need to earn to be awarded each 
status level. A JBehave scenario for the story card illustrated earlier 
might look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="gherkin">Frequent Flyer status is calculated based on points

Meta:
@issue #FH-17

Scenario: New members should start out as Bronze members
Given Jill Smith is not a Frequent Flyer member
When she registers on the Frequent Flyer program
Then she should have a status of Bronze

Scenario: Members should get status updates based on status points earned
Given a member has a status of &lt;initialStatus&gt;
And he has &lt;initialStatusPoints&gt; status points
When he earns &lt;extraPoints&gt; extra status points
Then he should have a status of &lt;finalStatus&gt;
Examples:
| initialStatus | initialStatusPoints | extraPoints | finalStatus | notes                    |
| Bronze        | 0                   | 300         | Silver      | 300 points for Silver    |
| Silver        | 0                   | 700         | Gold        | 700 points for Gold      |
| Gold          | 0                   | 1500        | Platinum    | 1500 points for Platinum |</code></pre>
</div>
</div>
<div class="paragraph">
<p>Serenity lets you associate JBehave stories or JUnit tests with a 
JIRA card using the @issue meta tag (illustrated above), or the 
equivalent @Issue annotation in JUnit. At the most basic level, this 
will generate links back to the corresponding JIRA cards in your test 
reports, as illustrated here:</p>
</div>
<div id="jira-serenity-report" class="imageblock">
<div class="content">
<img src="The%20Serenity%20Reference%20Manual_files/jira-serenity-report.png" alt="jira serenity report">
</div>
<div class="title">Figure 40. Serenity report with links to JIRA</div>
</div>
<div class="paragraph">
<p>For this to work, Serenity needs to know where your JIRA server. The 
simplest way to do this is to define the following properties in a file 
called serenity.properties in your project root directory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="gherkin">jira.url=https://myserver.atlassian.net
jira.project=FH
jira.username=jirauser
jira.password=t0psecret</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also set these properties up in your Maven pom.xml file or pass them in as system properties.</p>
</div>
<div class="sect3">
<h4 id="_feature_coverage"><a class="anchor" href="#_feature_coverage"></a>16.1.1. Feature Coverage</h4>
<div class="paragraph">
<p>But test results only report part of the picture. If you are using 
JIRA to store your stories and epics, you can use these to keep track of
 progress. But how do you know what automated acceptance tests have been
 implemented for your stories and epics, and, equally importantly, how 
do you know which stories or epics have no automated acceptance tests? 
In agile terms, a story cannot be declared “done” until the automated 
acceptance tests pass. Furthermore, we need to be confident not only 
that the tests exist, but they test the right requirements, and that 
they test them sufficiently well.</p>
</div>
<div class="paragraph">
<p>We call this idea of measuring the number (and quality) of the 
acceptance tests for each of the features we want to build “feature 
coverage”. Serenity can provide feature coverage reporting in addition 
to the more conventional test results. If you are using JIRA, you will 
need to add serenity-jira-requirements-provider to the dependencies 
section of your pom.xml file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependencies&gt;</span>
    ...
    <span class="tag">&lt;dependency&gt;</span>
        <span class="tag">&lt;groupId&gt;</span>net.serenity.plugins.jira<span class="tag">&lt;/groupId&gt;</span>
        <span class="tag">&lt;artifactId&gt;</span>serenity-jira-requirements-provider<span class="tag">&lt;/artifactId&gt;</span>
        <span class="tag">&lt;version&gt;</span>xxx<span class="tag">&lt;/version&gt;</span>
    <span class="tag">&lt;/dependency&gt;</span>
<span class="tag">&lt;/dependencies&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>(The actual version number might be different for you – always take a look at <a href="http://search.maven.org/#search%7Cga%7C1%7Cthucydides">Maven Central</a> to know what the latest version is).</p>
</div>
<div class="paragraph">
<p>You will also need to add this dependency to the Serenity reporting plugin configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;build&gt;</span>
    ...
    <span class="tag">&lt;plugins&gt;</span>
        ...
        <span class="tag">&lt;plugin&gt;</span>
            <span class="tag">&lt;groupId&gt;</span>net.serenity.maven.plugins<span class="tag">&lt;/groupId&gt;</span>
            <span class="tag">&lt;artifactId&gt;</span>maven-serenity-plugin<span class="tag">&lt;/artifactId&gt;</span>
            <span class="tag">&lt;version&gt;</span>xxx<span class="tag">&lt;/version&gt;</span>
            <span class="tag">&lt;executions&gt;</span>
                <span class="tag">&lt;execution&gt;</span>
                    <span class="tag">&lt;id&gt;</span>serenity-reports<span class="tag">&lt;/id&gt;</span>
                    <span class="tag">&lt;phase&gt;</span>post-integration-test<span class="tag">&lt;/phase&gt;</span>
                    <span class="tag">&lt;goals&gt;</span>
                        <span class="tag">&lt;goal&gt;</span>aggregate<span class="tag">&lt;/goal&gt;</span>
                    <span class="tag">&lt;/goals&gt;</span>
                <span class="tag">&lt;/execution&gt;</span>
            <span class="tag">&lt;/executions&gt;</span>
            <span class="tag">&lt;dependencies&gt;</span>
                <span class="tag">&lt;dependency&gt;</span>
                    <span class="tag">&lt;groupId&gt;</span>net.serenity.plugins.jira<span class="tag">&lt;/groupId&gt;</span>
                    <span class="tag">&lt;artifactId&gt;</span>serenity-jira-requirements-provider<span class="tag">&lt;/artifactId&gt;</span>
                    <span class="tag">&lt;version&gt;</span>xxx<span class="tag">&lt;/version&gt;</span>
                <span class="tag">&lt;/dependency&gt;</span>
            <span class="tag">&lt;/dependencies&gt;</span>
        <span class="tag">&lt;/plugin&gt;</span>
    <span class="tag">&lt;/plugins&gt;</span>
<span class="tag">&lt;/build&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, when you run the tests, Serenity will query JIRA to determine 
the epics and stories that you have defined, and list them in the 
Requirements page. This page gives you an overview of how many 
requirements (epics and stories) have passing tests (green), how many 
have failing (red) or broken (orange) tests, and how many have no tests 
at all (blue):</p>
</div>
<div id="serenity-jira-requirements-view" class="imageblock">
<div class="content">
<img src="The%20Serenity%20Reference%20Manual_files/serenity-jira-requirements-view.png" alt="serenity jira requirements view">
</div>
<div class="title">Figure 41. Requirements in Serenity report</div>
</div>
<div class="paragraph">
<p>If you click on an epic, you can see the stories defined for the 
epic, including an indicator (in the “Coverage” column) of how well each
 story has been tested.</p>
</div>
<div id="serenity-jira-report-epic-details" class="imageblock">
<div class="content">
<img src="The%20Serenity%20Reference%20Manual_files/serenity-jira-report-epic-details.png" alt="serenity jira report epic details">
</div>
<div class="title">Figure 42. Epic details in Serenity report</div>
</div>
<div class="paragraph">
<p>From here, you may want to drill down into the details about a given 
story, including what acceptance tests have been defined for this story,
 and whether they ran successfully:</p>
</div>
<div id="serenity-jira-story-report" class="imageblock">
<div class="content">
<img src="The%20Serenity%20Reference%20Manual_files/serenity-jira-story-report.png" alt="serenity jira story report">
</div>
<div class="title">Figure 43. Story in Serenity report</div>
</div>
<div class="paragraph">
<p>Both JIRA and the JIRA-Serenity integration are quite flexible. We 
saw earlier that we had configured a custom “Acceptance Criteria” field 
in our JIRA stories. We have displayed this custom field in the report 
shown above by including it in the serenity.properties file, like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>jira.custom.field.1=Acceptance Criteria</pre>
</div>
</div>
<div class="paragraph">
<p>Serenity reads the narrative text appearing in this report (“As a 
frequent flyer…”) from the Descriptionfield of the corresponding JIRA 
card. We can override this behavior and get Serenity to read this value 
from a different custom field using the <code>jira.custom.narrative.field</code>
 property. For example, some teams use a custom field called “User 
Story” to store the narrative text, instead of the Description field. We
 could get Serenity to use this field as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>jira.custom.narrative.field=User Story</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_two_way_integration_with_jira"><a class="anchor" href="#_two_way_integration_with_jira"></a>16.2. Two way integration with JIRA</h3>
<div class="sect3">
<h4 id="_links_from_jira_to_serenity"><a class="anchor" href="#_links_from_jira_to_serenity"></a>16.2.1. Links from JIRA to Serenity</h4>
<div class="paragraph">
<p>The simplest form of two-way integration between Serenity and JIRA is
 to get Serenity to insert a comment containing links to the Serenity 
test reports for each related issue card. To get this to work, you need 
to tell Serenity where the reports live. One way to do this is to add a 
property called serenity.public.url to your serenity.properties file 
with the address of the serenity reports.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>serenity.public.url=http://buildserver.myorg.com/latest/serenity/report</pre>
</div>
</div>
<div class="paragraph">
<p>This will tell Serenity that you not only want links from the 
Serenity reports to JIRA, but you also want to include links in the JIRA
 cards back to the corresponding Serenity reports. When this property is
 defined, Serenity will add a comment like the following to any issues 
associated with the executed tests:</p>
</div>
<div id="jira-serenity-comment" class="imageblock">
<div class="content">
<img src="The%20Serenity%20Reference%20Manual_files/jira-serenity-comment.png" alt="jira serenity comment">
</div>
<div class="title">Figure 44. JIRA report with Serenity comments</div>
</div>
<div class="paragraph">
<p>The <code>serenity.public.url</code> will typically point to a local 
web server where you deploy your reports, or to a path within your CI 
server. For example you could publish the Serenity reports on Jenkins 
using the <a href="https://wiki.jenkins-ci.org/display/JENKINS/HTML+Publisher+Plugin">Jenkins HTML Publisher Plugin</a>, and then add a line like the following to your serenity.properties file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>serenity.public.url=http://jenkins.myorg.com/job/myproject-acceptance-tests/Serenity_Report/</pre>
</div>
</div>
<div class="paragraph">
<p>If you do not want Serenity to update the JIRA issues for a 
particular run (e.g. when running your tests locally), you can also set <code>serenity.skip.jira.updates</code> to true, e.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>serenity.skip.jira.updates=true</pre>
</div>
</div>
<div class="paragraph">
<p>This will simply write the relevant issue numbers to the log rather than trying to connect to JIRA.</p>
</div>
</div>
<div class="sect3">
<h4 id="_updating_jira_issue_states"><a class="anchor" href="#_updating_jira_issue_states"></a>16.2.2. Updating JIRA issue states</h4>
<div class="paragraph">
<p>You can also configure the plugin to update the status of JIRA 
issues. This is deactivated by default: to use this option, you need to 
set the <code>serenity.jira.workflow.active</code> option to true, e.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>serenity.jira.workflow.active=true</pre>
</div>
</div>
<div class="paragraph">
<p>The default configuration will work with the default JIRA workflow: 
open or in progress issues associated with successful tests will be 
resolved, and closed or resolved issues associated with failing tests 
will be reopened. If you are using a customized workflow, or want to 
modify the way the transitions work, you can write your own workflow 
configuration. Workflow configuration uses a simple Groovy DSL. The 
following is an example of the configuration file used for the default 
workflow:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">when <span class="string"><span class="delimiter">'</span><span class="content">Open</span><span class="delimiter">'</span></span>, {
    <span class="string"><span class="delimiter">'</span><span class="content">success</span><span class="delimiter">'</span></span> <span class="key">should</span>: <span class="string"><span class="delimiter">'</span><span class="content">Resolve Issue</span><span class="delimiter">'</span></span>
}

when <span class="string"><span class="delimiter">'</span><span class="content">Reopened</span><span class="delimiter">'</span></span>, {
    <span class="string"><span class="delimiter">'</span><span class="content">success</span><span class="delimiter">'</span></span> <span class="key">should</span>: <span class="string"><span class="delimiter">'</span><span class="content">Resolve Issue</span><span class="delimiter">'</span></span>
}

when <span class="string"><span class="delimiter">'</span><span class="content">Resolved</span><span class="delimiter">'</span></span>, {
    <span class="string"><span class="delimiter">'</span><span class="content">failure</span><span class="delimiter">'</span></span> <span class="key">should</span>: <span class="string"><span class="delimiter">'</span><span class="content">Reopen Issue</span><span class="delimiter">'</span></span>
}

when <span class="string"><span class="delimiter">'</span><span class="content">In Progress</span><span class="delimiter">'</span></span>, {
    <span class="string"><span class="delimiter">'</span><span class="content">success</span><span class="delimiter">'</span></span> <span class="key">should</span>: [<span class="string"><span class="delimiter">'</span><span class="content">Stop Progress</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">Resolve Issue</span><span class="delimiter">'</span></span>]
}

when <span class="string"><span class="delimiter">'</span><span class="content">Closed</span><span class="delimiter">'</span></span>, {
    <span class="string"><span class="delimiter">'</span><span class="content">failure</span><span class="delimiter">'</span></span> <span class="key">should</span>: <span class="string"><span class="delimiter">'</span><span class="content">Reopen Issue</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can write your own configuration file and place it on the 
classpath of your test project (e.g. in serenity’s directory). Then you 
can override the default configuration by using <code>serenity.jira.workflow</code> property, e.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>serenity.jira.workflow=my-workflow.groovy</pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, you can simply create a file called 
jira-workflow.groovy and place it somewhere on your classpath (e.g. in 
the src/test/resources directory). Serenity will then use this workflow.
 In both these cases, you don’t need to explicitly set the <code>serenity.jira.workflow.active</code> property.</p>
</div>
</div>
<div class="sect3">
<h4 id="_release_management"><a class="anchor" href="#_release_management"></a>16.2.3. Release management</h4>
<div class="paragraph">
<p>In JIRA, you can organize your project releases into versions, as illustrated here:</p>
</div>
<div id="jira-versions" class="imageblock">
<div class="content">
<img src="The%20Serenity%20Reference%20Manual_files/jira-versions.png" alt="jira versions">
</div>
<div class="title">Figure 45. JIRA project releases - versions</div>
</div>
<div class="paragraph">
<p>You can and assign cards to one or more versions using the <code>Fix Version/s</code> field:</p>
</div>
<div id="jira-fix-versions" class="imageblock">
<div class="content">
<img src="The%20Serenity%20Reference%20Manual_files/jira-fix-versions.png" alt="jira fix versions">
</div>
<div class="title">Figure 46. JIRA fix versions</div>
</div>
<div class="paragraph">
<p>By default, Serenity will read version details from the Releases in 
JIRA. Test outcomes will be associated with a particular version using 
the “Fixed versions” field. The <strong>Releases</strong> tab gives you a run-down of the different planned versions, and how well they have been tested so far:</p>
</div>
<div id="releases-tab" class="imageblock">
<div class="content">
<img src="The%20Serenity%20Reference%20Manual_files/releases-tab.png" alt="releases tab">
</div>
<div class="title">Figure 47. JIRA releases tab</div>
</div>
<div class="paragraph">
<p>JIRA uses a flat version structure – you can’t have for example 
releases that are made up of a number of sprints. Serenity lets you 
organize these in a hierarchical structure based on a simple naming 
convention. By default, Serenity uses “release” as the highest level 
release, and either “iteration” or “sprint” as the second level. For 
example, suppose you have the the following list of versions in JIRA – 
Release 1 – Iteration 1.1 – Iteration 1.2 – Release 2 – Release 3</p>
</div>
<div class="paragraph">
<p>This will produce Release reports for Release 1, Release 2, and 
Release 3, with Iteration 1.2 and Iteration 1.2 appearing underneath 
Release 1. The reports will contain the list of requirements and test 
outcomes associated with each release. You can drill down into any of 
the releases to see details about that particular release.</p>
</div>
<div id="serenity-jira-releases" class="imageblock">
<div class="content">
<img src="The%20Serenity%20Reference%20Manual_files/serenity-jira-releases.png" alt="serenity jira releases">
</div>
<div class="title">Figure 48. Serenity releases reports</div>
</div>
<div class="paragraph">
<p>You can also customize the names of the types of release usinge the serenity.release.types property, e.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>serenity.release.types=milestone, release, version</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_integrating_with_spring"><a class="anchor" href="#_integrating_with_spring"></a>17. Integrating with Spring</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you are running your acceptance tests against an embedded web 
server (for example, using Jetty), it can occasionally be useful to 
access the service layers directly for fixture or infrastructure-related
 code. For example, you may have a scenario where a user action must, as
 a side effect, record an audit log in a table in the database. To keep 
your test focused and simple, you may want to call the service layer 
directly to check the audit logs, rather than logging on as an 
administrator and navigating to the audit logs screen.</p>
</div>
<div class="paragraph">
<p>Spring provides excellent support for integration tests, via the 
SpringJUnit4ClassRunner test runner. Unfortunately, if you are using 
Serenity, this is not an option, as a test cannot have two runners at 
the same time. Fortunately, however, there is a solution! To inject 
dependencies using a Spring configuration file, you just need to include
 the Serenity SpringIntegration rule in your test class. You instantiate
 this variable as shown here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Rule</span>
<span class="directive">public</span> SpringIntegration springIntegration = <span class="keyword">new</span> SpringIntegration();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then you use the <code>@ContextConfiguration</code> annotation to 
define the configuration file or files to use. The you can inject 
dependencies as you would with an ordinary Spring integration test, 
using the usual Spring annotations such as @Autowired or <code>@Resource</code>. For example, suppose we are using the following Spring configuration file, called ‘config.xml’:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;beans&gt;</span>
    <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">widgetService</span><span class="delimiter">"</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">"</span><span class="content">net.serenity.junit.spring.WidgetService</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">name</span><span class="delimiter">"</span></span><span class="tag">&gt;</span><span class="tag">&lt;value&gt;</span>Widgets<span class="tag">&lt;/value&gt;</span><span class="tag">&lt;/property&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">quota</span><span class="delimiter">"</span></span><span class="tag">&gt;</span><span class="tag">&lt;value&gt;</span>1<span class="tag">&lt;/value&gt;</span><span class="tag">&lt;/property&gt;</span>
    <span class="tag">&lt;/bean&gt;</span>
    <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">"</span><span class="content">gizmoService</span><span class="delimiter">"</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">"</span><span class="content">net.serenity.junit.spring.GizmoService</span><span class="delimiter">"</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">name</span><span class="delimiter">"</span></span><span class="tag">&gt;</span><span class="tag">&lt;value&gt;</span>Gizmos<span class="tag">&lt;/value&gt;</span><span class="tag">&lt;/property&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">"</span><span class="content">widgetService</span><span class="delimiter">"</span></span><span class="tag">&gt;</span><span class="tag">&lt;ref</span> <span class="attribute-name">bean</span>=<span class="string"><span class="delimiter">"</span><span class="content">widgetService</span><span class="delimiter">"</span></span> <span class="tag">/&gt;</span><span class="tag">&lt;/property&gt;</span>
    <span class="tag">&lt;/bean&gt;</span>
<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We can use this configuration file to inject dependencies as shown here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@RunWith</span>(SerenityRunner.class)
<span class="annotation">@ContextConfiguration</span>(locations = <span class="string"><span class="delimiter">"</span><span class="content">/config.xml</span><span class="delimiter">"</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">WhenInjectingSpringDependencies</span> {

    <span class="annotation">@Managed</span>
    WebDriver driver;

    <span class="annotation">@ManagedPages</span>(defaultUrl = <span class="string"><span class="delimiter">"</span><span class="content">http://www.google.com</span><span class="delimiter">"</span></span>)
    <span class="directive">public</span> Pages pages;

    <span class="annotation">@Rule</span>
    <span class="directive">public</span> SpringIntegration springIntegration = <span class="keyword">new</span> SpringIntegration();

    <span class="annotation">@Autowired</span>
    <span class="directive">public</span> GizmoService gizmoService;

    <span class="annotation">@Test</span>
    <span class="directive">public</span> <span class="type">void</span> shouldInstanciateGizmoService() {
        assertThat(gizmoService, is(not(nullValue())));
    }

    <span class="annotation">@Test</span>
    <span class="directive">public</span> <span class="type">void</span> shouldInstanciateNestedServices() {
        assertThat(gizmoService.getWidgetService(), is(not(nullValue())));
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Other context-related annotations such as <code>@DirtiesContext</code>
 will also work as they would in a traditional Spring Integration test. 
Spring will create a new ApplicationContext for each test, but it will 
use a single ApplicationContext for all of the methods in your test. If 
one of your tests modifies an object in the ApplicationContext, you may 
want to tell Spring so that it can reset the context for the next test. 
You do this using the <code>@DirtiesContext</code> annotation. In the following test case, for example, the tests will fail without the <code>@DirtiesContext</code> annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@RunWith</span>(SerenityRunner.class)
<span class="annotation">@ContextConfiguration</span>(locations = <span class="string"><span class="delimiter">"</span><span class="content">/spring/config.xml</span><span class="delimiter">"</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">WhenWorkingWithDirtyContexts</span> {

    <span class="annotation">@Managed</span>
    WebDriver driver;

    <span class="annotation">@ManagedPages</span>(defaultUrl = <span class="string"><span class="delimiter">"</span><span class="content">http://www.google.com</span><span class="delimiter">"</span></span>)
    <span class="directive">public</span> Pages pages;

    <span class="annotation">@Rule</span>
    <span class="directive">public</span> SpringIntegration springIntegration = <span class="keyword">new</span> SpringIntegration();

    <span class="annotation">@Autowired</span>
    <span class="directive">public</span> GizmoService gizmoService;

    <span class="annotation">@Test</span>
    <span class="annotation">@DirtiesContext</span>
    <span class="directive">public</span> <span class="type">void</span> shouldNotBeAffectedByTheOtherTest() {
        assertThat(gizmoService.getName(), is(<span class="string"><span class="delimiter">"</span><span class="content">Gizmos</span><span class="delimiter">"</span></span>));
        gizmoService.setName(<span class="string"><span class="delimiter">"</span><span class="content">New Gizmos</span><span class="delimiter">"</span></span>);
    }

    <span class="annotation">@Test</span>
    <span class="annotation">@DirtiesContext</span>
    <span class="directive">public</span> <span class="type">void</span> shouldNotBeAffectedByTheOtherTestEither() {
        assertThat(gizmoService.getName(), is(<span class="string"><span class="delimiter">"</span><span class="content">Gizmos</span><span class="delimiter">"</span></span>));
        gizmoService.setName(<span class="string"><span class="delimiter">"</span><span class="content">New Gizmos</span><span class="delimiter">"</span></span>);
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also inject Spring dependencies directly into your Step 
libraries, for JUnit, Cucumber and JBehave, as shown in this example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@ContextConfiguration</span>(locations = <span class="string"><span class="delimiter">"</span><span class="content">/spring/config.xml</span><span class="delimiter">"</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">NestedSpringEnabledSteps</span> {

    <span class="annotation">@Autowired</span>
    <span class="directive">public</span> WidgetService widgetService;

    <span class="directive">private</span> <span class="predefined-type">String</span> widgetName;

    <span class="annotation">@Steps</span>
    <span class="directive">private</span> NestedSteps nestedSteps;

    <span class="annotation">@Given</span>(<span class="string"><span class="delimiter">"</span><span class="content">I hava a nested autowired Spring bean</span><span class="delimiter">"</span></span>)
    <span class="directive">public</span> <span class="type">void</span> givenIHavaAnAutowiredSpringBean() {
        assertThat(nestedSteps.widgetService, notNullValue());
    }

    <span class="annotation">@When</span>(<span class="string"><span class="delimiter">"</span><span class="content">I use the nested bean</span><span class="delimiter">"</span></span>)
    <span class="directive">public</span> <span class="type">void</span> whenIUseTheBean() {
        widgetName = nestedSteps.widgetService.getName();
    }

    <span class="annotation">@Then</span>(<span class="string"><span class="delimiter">"</span><span class="content">the nested bean should be instanciated</span><span class="delimiter">"</span></span>)
    <span class="directive">public</span> <span class="type">void</span> thenItShouldBeInstanciated() {
        assertThat(widgetName, is(<span class="string"><span class="delimiter">"</span><span class="content">Widgets</span><span class="delimiter">"</span></span>));
    }

}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_running_serenity_tests_in_parallel_batches"><a class="anchor" href="#_running_serenity_tests_in_parallel_batches"></a>18. Running Serenity tests in parallel batches</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Sometimes projects have a lot of tests, and executing of them takes a
 lot of time. Testing can be sped up significantly by running different 
tests in parallel. However, this is often harder to implement than it 
sounds.</p>
</div>
<div class="paragraph">
<p>Some build automation tools have builtin parallel test execution, but
 this not so good for huge amount of tests and heavy tests. For example 
web tests are as a rule much slower than other types of tests, it make 
them good candidates for concurrent testing, in theory at least, but the
 implementation can be tricky. For example, although it is easy enough 
to configure running tests in parallel, on the other hand running 
several webdriver instances of Firefox/Chrome in parallel on the same 
display, tends to become unreliable.</p>
</div>
<div class="paragraph">
<p>The natural solution in this case is to split the web tests into 
smaller batches, and to run each batch on a different machine and/or on a
 different virtual display. When each batch has finished, the results 
can be retrieved and aggregated into the final test reports.</p>
</div>
<div class="paragraph">
<p>However splitting tests into batches by hand tends to be tedious and 
unreliable – it is easy to forget to add a new test to a batch, for 
example, or have unevenly-distributed batches.</p>
</div>
<div class="paragraph">
<p>Serenity lets you do this automatically, by splitting your test cases
 evenly into batches of a given size. In practice, you run a build job 
for each batch - you take same sources with all tests and configure 
serenity to run from current copy some amount of test by providing 
several parameters. After that you retrieve all tests results generated 
by each batch to aggregate into the final serenity test report.</p>
</div>
<div class="sect2">
<h3 id="_splitting_serenity_tests_to_batches"><a class="anchor" href="#_splitting_serenity_tests_to_batches"></a>18.1. Splitting serenity tests to batches</h3>
<div class="paragraph">
<p>To split tests to batches you need configure serenity run some tests 
and skip others. For different batches it will be different tests, below
 you can find short example of such configuration.</p>
</div>
<div class="paragraph">
<p>For configuration batches three parameters are used:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>serenity.batch.strategy</strong></dt>
<dd>
<p>Optional parameter for choosing batch creating strategy. Possible values are <code>DIVIDE_EQUALLY</code> and <code>DIVIDE_BY_TEST_COUNT</code>. Default value is <code>DIVIDE_EQUALLY</code>. Instead of it can be used redundant <code>thucydides.batch.strategy</code>, but it strongly not recommended</p>
</dd>
<dt class="hdlist1"><strong>serenity.batch.size</strong></dt>
<dd>
<p>This parameter should be the same for each batch, and should more 
than 0. This is amount of all bathes for current sources, and synonym of
 <em>serenity.batch.count</em>. Instead of it can be used redundant <code>thucydides.batch.size</code>, but it strongly not recommended</p>
</dd>
<dt class="hdlist1"><strong>serenity.batch.count</strong></dt>
<dd>
<p>This parameter should be the same for each batch, and should more 
than 0. This is amount of all bathes for current sources, and synonym of
 <em>serenity.batch.size</em>. Instead of it can be used redundant <code>thucydides.batch.count</code>, but it strongly not recommended</p>
</dd>
<dt class="hdlist1"><strong>serenity.batch.number</strong></dt>
<dd>
<p>This parameter should be different for each batch, and should be less or equal <code>serenity.batch.size</code> and more than 0. This is number of bath for execution in current build. Instead of it can be used redundant <code>thucydides.batch.number</code>, but it strongly not recommended</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Those parameters can be populated as system parameters of in 
serenity.properties file. Meaning of parameters size/number depends on <code>serenity.batch.strategy</code> value. For explanation strategies will be used tests with next structure (full sources available under <a href="https://github.com/serenity-bdd/serenity-demos">serenity-demos</a> repository):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">...
<span class="annotation">@RunWith</span>(SerenityRunner.class)
<span class="directive">public</span> <span class="type">class</span> <span class="class">LoginUserTest</span> {
    <span class="annotation">@Steps</span>
    UserActionSteps steps;

    <span class="annotation">@Test</span>
    <span class="directive">public</span> <span class="type">void</span> should_create_login_record_after_login() {
        <span class="comment">// GIVEN</span>
        <span class="directive">final</span> User user = <span class="keyword">new</span> User(<span class="string"><span class="delimiter">"</span><span class="content">user.login</span><span class="delimiter">"</span></span>, <span class="string"><span class="delimiter">"</span><span class="content">user@mail.com</span><span class="delimiter">"</span></span>);
        steps.given_registered_user(user);
        <span class="comment">// WHEN</span>
        steps.when_user_login();
        <span class="comment">// THEN</span>
        steps.then_one_login_record_should_exist();
    }

    <span class="annotation">@Test</span>
    <span class="directive">public</span> <span class="type">void</span> should_clean_login_records_after_logout() {
        <span class="comment">// GIVEN</span>
        <span class="directive">final</span> User user = <span class="keyword">new</span> User(<span class="string"><span class="delimiter">"</span><span class="content">user.login</span><span class="delimiter">"</span></span>, <span class="string"><span class="delimiter">"</span><span class="content">user@mail.com</span><span class="delimiter">"</span></span>);
        steps.given_registered_user(user);
        <span class="comment">// WHEN</span>
        steps.when_user_login();
        steps.when_user_logout();
        <span class="comment">// THEN</span>
        steps.then_login_record_should_not_exist();
    }

    <span class="annotation">@Test</span>
    <span class="directive">public</span> <span class="type">void</span> should_not_create_duplicate_records_during_parallel_login() {
        <span class="comment">// GIVEN</span>
        <span class="directive">final</span> User user = <span class="keyword">new</span> User(<span class="string"><span class="delimiter">"</span><span class="content">user.login</span><span class="delimiter">"</span></span>, <span class="string"><span class="delimiter">"</span><span class="content">user@mail.com</span><span class="delimiter">"</span></span>);
        steps.given_registered_user(user);
        <span class="comment">// WHEN</span>
        steps.when_user_login();
        steps.when_user_login();
        <span class="comment">// THEN</span>
        steps.then_one_login_record_should_exist();
    }

    <span class="annotation">@Test</span>
    <span class="directive">public</span> <span class="type">void</span> should_clean_login_records_after_session_expired() {
        <span class="comment">// GIVEN</span>
        <span class="directive">final</span> User user = <span class="keyword">new</span> User(<span class="string"><span class="delimiter">"</span><span class="content">user.login</span><span class="delimiter">"</span></span>, <span class="string"><span class="delimiter">"</span><span class="content">user@mail.com</span><span class="delimiter">"</span></span>);
        steps.given_registered_user(user);
        <span class="comment">// WHEN</span>
        steps.when_user_login();
        steps.when_user_session_expired();
        <span class="comment">// THEN</span>
        steps.then_login_record_should_not_exist();
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">...
<span class="annotation">@RunWith</span>(SerenityRunner.class)
<span class="directive">public</span> <span class="type">class</span> <span class="class">RegisterUserTest</span> {
    <span class="annotation">@Steps</span>
    UserActionSteps steps;

    <span class="annotation">@Test</span>
    <span class="directive">public</span> <span class="type">void</span> should_be_available_after_finishing_registration() {
        <span class="comment">// GIVEN</span>
        <span class="directive">final</span> User user = <span class="keyword">new</span> User(<span class="string"><span class="delimiter">"</span><span class="content">user.login</span><span class="delimiter">"</span></span>, <span class="string"><span class="delimiter">"</span><span class="content">user@mail.com</span><span class="delimiter">"</span></span>);
        steps.given_started_registration_process(user);
        <span class="comment">// WHEN</span>
        steps.when_user_activate_registration();
        <span class="comment">// THEN</span>
        steps.then_user_should_be_available();
    }

    <span class="annotation">@Test</span>
    <span class="directive">public</span> <span class="type">void</span> should_be_not_available_before_finishing_registration() {
        <span class="comment">// GIVEN</span>
        <span class="directive">final</span> User user = <span class="keyword">new</span> User(<span class="string"><span class="delimiter">"</span><span class="content">user.login</span><span class="delimiter">"</span></span>, <span class="string"><span class="delimiter">"</span><span class="content">user@mail.com</span><span class="delimiter">"</span></span>);
        steps.given_started_registration_process(user);
        <span class="comment">// WHEN</span>
        steps.when_user_not_finished_registration();
        <span class="comment">// THEN</span>
        steps.then_user_should_be_not_available();
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">...
<span class="annotation">@RunWith</span>(SerenityRunner.class)
<span class="directive">public</span> <span class="type">class</span> <span class="class">UserActivationProcessTest</span> {
    <span class="annotation">@Steps</span>
    MailActivationSteps steps;

    <span class="annotation">@Test</span>
    <span class="directive">public</span> <span class="type">void</span> should_activate_user_account() {
        <span class="comment">// GIVEN</span>
        <span class="directive">final</span> User user = <span class="keyword">new</span> User(<span class="string"><span class="delimiter">"</span><span class="content">user.login</span><span class="delimiter">"</span></span>, <span class="string"><span class="delimiter">"</span><span class="content">user@mail.com</span><span class="delimiter">"</span></span>);
        <span class="directive">final</span> ActivationMail activation = <span class="keyword">new</span> ActivationMail(user.getEmail()
            , <span class="predefined-type">String</span>.valueOf(ThreadLocalRandom.current().nextLong()));
        steps.given_activation_send(activation, user);
        <span class="comment">// WHEN</span>
        steps.when_user_enter_activation_code();
        <span class="comment">// THEN</span>
        steps.then_user_account_activated();
    }

    <span class="annotation">@Test</span>
    <span class="directive">public</span> <span class="type">void</span> should_send_notification_to_user() {
        <span class="comment">// GIVEN</span>
        <span class="directive">final</span> User user = <span class="keyword">new</span> User(<span class="string"><span class="delimiter">"</span><span class="content">user.login</span><span class="delimiter">"</span></span>, <span class="string"><span class="delimiter">"</span><span class="content">user@mail.com</span><span class="delimiter">"</span></span>);
        <span class="directive">final</span> ActivationMail activation = <span class="keyword">new</span> ActivationMail(user.getEmail()
            , <span class="predefined-type">String</span>.valueOf(ThreadLocalRandom.current().nextLong()));
        steps.given_activation_send(activation, user);
        <span class="comment">// WHEN</span>
        steps.when_activation_code_expired();
        <span class="comment">// THEN</span>
        steps.then_user_received_notification();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Screenshot for aggregation report created after executing all tests without enabling batches (<code>serenity.batch.count</code> and <code>serenity.batch.number</code> and <code>serenity.batch.size</code> aren’t provided or equal to 0). It contains all Tests from above classes:</p>
</div>
<div id="fig-serenity-report-for-bathes-example-project" class="imageblock">
<div class="content">
<img src="The%20Serenity%20Reference%20Manual_files/junit-batches-all-test-cases.png" alt="junit batches all test cases">
</div>
<div class="title">Figure 49. Serenity report for bathes example project with turned off batching</div>
</div>
<div class="sect3">
<h4 id="_divide_tests_to_batches_using_divide_equally_batch_strategy"><a class="anchor" href="#_divide_tests_to_batches_using_divide_equally_batch_strategy"></a>18.1.1. Divide tests to batches using DIVIDE_EQUALLY batch strategy</h4>
<div class="paragraph">
<p>This strategy enabled by default. It allows split all test classes among <code>serenity.batch.size</code> batches. Value <code>serenity.batch.number</code>
 will refer to some batch and only tests from Test classes from this 
batch will be executed.When test phase will be started Serenity will 
check if <code>serenity.batch.size &gt; 0</code> and <code>serenity.batch.number &gt; 0</code>, and if so it will split tests classes to <code>serenity.batch.size</code> batches and run batch with number equal to <code>serenity.batch.number</code>.
All classes will be included to bathes one by one. So if size=3 and we 
have classes T1, T2, T3, T4, T5 - first batch will contains {T1,T4}, 
second - {T2,T5}, third - {T3}.</p>
</div>
<div class="paragraph">
<p>For example to split Test classes (<code>LoginUserTest</code>, <code>RegisterUserTest</code>, <code>UserActivationProcessTest</code>) into two bathes and execute first batch we should provide <code>serenity.batch.size = 2</code>, <code>serenity.batch.number = 1</code>. Serenity report will be next:</p>
</div>
<div id="fig-serenity-report-for-equally-batch-strategy-number-1" class="imageblock">
<div class="content">
<img src="The%20Serenity%20Reference%20Manual_files/serenity-report-for-equally-batch-strategy-number-1.png" alt="serenity report for equally batch strategy number 1">
</div>
<div class="title">Figure 50. Serenity report for batch number 1 for equally strategy</div>
</div>
<div class="paragraph">
<p>To run same build for second batch, we need provide <code>serenity.batch.size = 2</code>, <code>serenity.batch.number = 2</code>. In this case Serenity report will be:</p>
</div>
<div id="fig-serenity-report-for-equally-batch-strategy-number-2" class="imageblock">
<div class="content">
<img src="The%20Serenity%20Reference%20Manual_files/serenity-report-for-equally-batch-strategy-number-2.png" alt="serenity report for equally batch strategy number 2">
</div>
<div class="title">Figure 51. Serenity report for batch number 2 for equally strategy</div>
</div>
</div>
<div class="sect3">
<h4 id="_divide_tests_to_batches_using_divide_by_test_count_strategy"><a class="anchor" href="#_divide_tests_to_batches_using_divide_by_test_count_strategy"></a>18.1.2. Divide tests to batches using DIVIDE_BY_TEST_COUNT strategy</h4>
<div class="paragraph">
<p>This strategy will be enabled if during test phase set <code>serenity.batch.strategy = DIVIDE_BY_TEST_COUNT</code>.It allows split all test classes among <code>serenity.batch.size</code> batches. Value <code>serenity.batch.number</code> will refer to some batch and only tests from Test classes from this batch will be executed.
When test phase will be started Serenity will check if <code>serenity.batch.size &gt; 0</code> and <code>serenity.batch.number &gt; 0</code>, and if so it will split tests classes to <code>serenity.batch.size</code> batches and run batch with number equal to <code>serenity.batch.number</code>.
All classes will be included to bathes according to numbers of testCases
 in this classes. This strategy allows split tests between batches 
optimally. In our case <code>LoginUserTest</code> contains 4 tests, <code>RegisterUserTest</code> contains 2 tests, <code>UserActivationProcessTest</code>
 contains 2 tests, if we try to split this tests to 2  bathes using this
 strategy - both batch will contain 4 tests, first one from <code>LoginUserTest</code>, second one from <code>UserActivationProcessTest</code> and <code>RegisterUserTest</code>. It will look like:</p>
</div>
<div id="fig-serenity-report-for-divide-by-test-count-batch-strategy-number-1" class="imageblock">
<div class="content">
<img src="The%20Serenity%20Reference%20Manual_files/serenity-report-for-divide-by-test-count-batch-strategy-_002.png" alt="serenity report for divide by test count batch strategy number 1">
</div>
<div class="title">Figure 52. Serenity report for batch number 1 for DIVIDE_BY_TEST_COUNT strategy</div>
</div>
<div id="fig-serenity-report-for-divide-by-test-count-batch-strategy-number-2" class="imageblock">
<div class="content">
<img src="The%20Serenity%20Reference%20Manual_files/serenity-report-for-divide-by-test-count-batch-strategy-numb.png" alt="serenity report for divide by test count batch strategy number 2">
</div>
<div class="title">Figure 53. Serenity report for batch number 2 for DIVIDE_BY_TEST_COUNT strategy</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_configuration_parallel_executing_with_jenkins"><a class="anchor" href="#_configuration_parallel_executing_with_jenkins"></a>18.2. Configuration parallel executing with Jenkins</h3>
<div class="paragraph">
<p>This approach is easy to set up on Jenkins using a 
multi-configuration build. In the following screenshot, we are running a
 multi-configuration build to run web tests across three batches. We use
 a single user-defined parameter (BATCH_NUMBER) to define the batch 
being run, passing this parameter into the Maven build job properties we
 discussed above.</p>
</div>
<div id="fig-multi-configuration-build" class="imageblock">
<div class="content">
<img src="The%20Serenity%20Reference%20Manual_files/parallel-webtests-matrix-build.png" alt="parallel webtests matrix build">
</div>
<div class="title">Figure 54. Multi-configuration build to run web tests across three batches</div>
</div>
<div class="paragraph">
<p>The most robust way to aggregate the build results from the different
 batches is to set up a second build job that runs after the test 
executions, and retrieves the build results from the batch jobs. You can
 use the Jenkins Copy Artifacts plugin to do this. First, ensure that 
the multi-configuration build archives the Serenity reports, as shown 
here:</p>
</div>
<div id="fig-achieving-serenity-reports" class="imageblock">
<div class="content">
<img src="The%20Serenity%20Reference%20Manual_files/parallel-webtests-post-build.png" alt="parallel webtests post build">
</div>
<div class="title">Figure 55. Configuration archiving the Serenity reports</div>
</div>
<div class="paragraph">
<p>This build will then trigger another, freestyle build job. This job 
needs to copy the Serenity report artifacts from the matrix build jobs 
into the current workspace, and then run the mvn serenity:aggregate 
command to generate the Serenity aggregate reports. The matrix build job
 reports need to be copied one-by-one for each batch, as the current 
version of the Copy Artifacts plugin does not support copying from 
multiple projects in the same action.</p>
</div>
<div id="fig-copying-the-serenity-report-artifacts" class="imageblock">
<div class="content">
<img src="The%20Serenity%20Reference%20Manual_files/parallel-webtests-aggregate.png" alt="parallel webtests aggregate">
</div>
<div class="title">Figure 56. Configuration copying the Serenity report artifacts and aggregating reports</div>
</div>
<div class="paragraph">
<p>Then make sure you publish the generated HTML reports (which will be 
in the target/site/serenity directory) for easy access to the test 
results.</p>
</div>
<div class="paragraph">
<p>This simple example shows a parallel test running 3 batches – this 
brought the test execution time from 9 minutes to slightly over 1 
minute. Results will vary, of course, but a typical real-world set of 
web tests would have a larger number of batches</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_testing_rest_with_serenity_bdd"><a class="anchor" href="#_testing_rest_with_serenity_bdd"></a>19. Testing REST with Serenity BDD</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Serenity BDD can help you to create tests for REST services, with all
 advantages that Serenity BDD introduce to Web Tests and even more.</p>
</div>
<div class="paragraph">
<p>It is provided tight integration with well known <a href="https://github.com/jayway/rest-assured">Rest Assured</a>,
 with some improvements and advanced reporting. All what you need is use
 in import instead of RestAssured - SerenityRest, and that’s all!!</p>
</div>
<div class="sect2">
<h3 id="_reports_created_when_rest_is_tested"><a class="anchor" href="#_reports_created_when_rest_is_tested"></a>19.1. Reports created when Rest is tested</h3>
<div class="paragraph">
<p>If you use in your tests SerenityRest then all your requests/response
 will be included in generated report, so you can easy explore body, 
cookies, headers, response body, url as well as validate them in 
RestAssured way.
Here is example of generated report for some of demo tests:</p>
</div>
<div id="request_with_headers_and_body" class="imageblock">
<div class="content">
<img src="The%20Serenity%20Reference%20Manual_files/request_headers_body.png" alt="request headers body">
</div>
<div class="title">Figure 57. Request with Headers and Body Example</div>
</div>
<div id="response_with_headers_and_body_and_cookies" class="imageblock">
<div class="content">
<img src="The%20Serenity%20Reference%20Manual_files/response_headers_body_cookies.png" alt="response headers body cookies">
</div>
<div class="title">Figure 58. Response with Headers and Body and Cookies Example</div>
</div>
<div class="paragraph">
<p>As you see all requests included in report under correspond steps:</p>
</div>
<div id="rest_query_in_report" class="imageblock">
<div class="content">
<img src="The%20Serenity%20Reference%20Manual_files/rest_query_in_report.png" alt="rest query in report">
</div>
<div class="title">Figure 59. Rest Query included in report under steps</div>
</div>
</div>
<div class="sect2">
<h3 id="_writing_tests_with_rest_assured"><a class="anchor" href="#_writing_tests_with_rest_assured"></a>19.2. Writing tests with Rest Assured</h3>
<div class="paragraph">
<p>All Rest Assured tests are valid tests for Serenity BDD. You can use 
all contractions like given-when-then or expect-when-then, initialise 
some query parameters, and so on.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">...
    <span class="annotation">@Step</span>
    <span class="directive">public</span> <span class="type">void</span> whenIAddThePetToTheStore() {
        <span class="keyword">for</span> (Pet pet : pets) {
            <span class="type">int</span> id = <span class="predefined-type">Math</span>.abs(<span class="keyword">new</span> <span class="predefined-type">Random</span>().nextInt());
            <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; jsonAsMap = <span class="keyword">new</span> <span class="predefined-type">HashMap</span>&lt;&gt;();
            jsonAsMap.put(<span class="string"><span class="delimiter">"</span><span class="content">id</span><span class="delimiter">"</span></span>, id);
            jsonAsMap.put(<span class="string"><span class="delimiter">"</span><span class="content">name</span><span class="delimiter">"</span></span>, pet.getName());
            jsonAsMap.put(<span class="string"><span class="delimiter">"</span><span class="content">status</span><span class="delimiter">"</span></span>, pet.getStatus());
            jsonAsMap.put(<span class="string"><span class="delimiter">"</span><span class="content">photoUrls</span><span class="delimiter">"</span></span>, <span class="keyword">new</span> <span class="predefined-type">ArrayList</span>&lt;&gt;(<span class="predefined-type">Arrays</span>.asList()));

            given().contentType(<span class="string"><span class="delimiter">"</span><span class="content">application/json</span><span class="delimiter">"</span></span>)
                    .content(jsonAsMap).log().body()
                    .baseUri(<span class="string"><span class="delimiter">"</span><span class="content">http://petstore.swagger.io</span><span class="delimiter">"</span></span>)
                    .basePath(<span class="string"><span class="delimiter">"</span><span class="content">v2/pet</span><span class="delimiter">"</span></span>)
            .when().post();

            pet.setId(id);

        }
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">...
    <span class="annotation">@Step</span>
    <span class="directive">public</span> <span class="type">void</span> thenPetShouldBeAvailable() {
        <span class="keyword">for</span> (Pet pet : pets) {
            expect().that().statusCode(<span class="integer">200</span>)
                    .and().body(<span class="string"><span class="delimiter">"</span><span class="content">name</span><span class="delimiter">"</span></span>, equalTo(pet.getName())).when()
                    .get(<span class="string"><span class="delimiter">"</span><span class="content">http://petstore.swagger.io/v2/pet/{id}</span><span class="delimiter">"</span></span>, pet.getId());
        }
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>More that that you can create Steps classes in Serenity BDD way and 
use them as reusable components, and use all features of Serenity 
aggregated report.
Also Serenity BDD introduce possibility to share same RestResponse 
between steps to allow write Steps methods in more native way:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"> ...
        <span class="annotation">@Step</span>
        def getById(<span class="directive">final</span> <span class="predefined-type">String</span> url) {
            rest().get(<span class="string"><span class="delimiter">"</span><span class="content">$url/{id}</span><span class="delimiter">"</span></span>, <span class="integer">1000</span>);
        }

        <span class="annotation">@Step</span>
        def thenCheckOutcome() {
            then().body(<span class="string"><span class="delimiter">"</span><span class="content">Id</span><span class="delimiter">"</span></span>, Matchers.anything())
        }</code></pre>
</div>
</div>
<div class="paragraph">
<p>For easy configuration and resetting rest configuration you can use 
RestConfigurationRule. All Configuration action described in rule will 
executed before test and after test will be executed reset.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">...
    <span class="annotation">@Rule</span>
    def RestConfigurationRule rule = <span class="keyword">new</span> RestConfigurationRule(<span class="keyword">new</span> RestConfigurationAction() {
        <span class="annotation">@Override</span>
        <span class="type">void</span> apply() {
            SerenityRest.setDefaultBasePath(value)
        }
    })</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_using_split_classes_to_initialise_and_configure_rest_assured"><a class="anchor" href="#_using_split_classes_to_initialise_and_configure_rest_assured"></a>19.3. Using split classes to initialise and configure Rest Assured</h3>
<div class="paragraph">
<p>With Serenity BDD you can configure Rest Assured using chain of 
calls, that can be much more easy to read than a lot of separated lines:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">...
new RestDefaultsChained().setDefaultBasePath(<span class="string"><span class="delimiter">"</span><span class="content">some/path</span><span class="delimiter">"</span></span>)
    .setDefaultProxy(object).setDefaultPort(<span class="integer">10</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Basically all what you can execute during rest tests included in one class <em>SerenityRest</em>, but you also use slitted classes to separate your logic and help yourself to find function what you need with <em>RestUtility</em> and <em>RestDefaults</em> and <em>RestRequests</em>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_importing_test_results_generated_by_serenity_bdd"><a class="anchor" href="#_importing_test_results_generated_by_serenity_bdd"></a>20. Importing test results generated by Serenity BDD</h2>
<div class="sectionbody">
<div class="paragraph">
<p>During execution of test Serenity BDD generate Test Outcomes and use 
them to build aggregated report. It is possible for some external tools 
load test outcomes and analise them.</p>
</div>
<div class="sect2">
<h3 id="_loading_test_outcomes_from_folder"><a class="anchor" href="#_loading_test_outcomes_from_folder"></a>20.1. Loading Test OutComes from folder</h3>
<div class="paragraph">
<p>Test outcomes by default are generated in XML and JSON format, both 
format contains same information - testcase, suites, test results, rest 
queries and so on.
Serenity BDD uses recreation of these test result - <em>TestOutcome</em> and some extra features available in <em>TestOutcomes</em>.</p>
</div>
<div class="paragraph">
<p>To load test outcome you should know their format and folder:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">....
OutcomeFormat format = OutcomeFormat.XML;
TestOutcomes outcomes = TestOutcomeLoader.loadTestOutcomes().inFormat(format)
....</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_analysing_test_outcomes"><a class="anchor" href="#_analysing_test_outcomes"></a>20.2. Analysing Test OutComes</h3>
<div class="paragraph">
<p>It is easy to analise test outcomes, for example for getting all passed test you should:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">....
outcomes.getPassingTests();
....</code></pre>
</div>
</div>
<div class="paragraph">
<p>Also you can get a lot of information from test ourcomes about execute tests, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">....
 for (<span class="directive">final</span> TestOutcome outcome : outcomes.getOutcomes()) {
     <span class="predefined-type">System</span>.out.println(outcome.getCompleteName());
     <span class="predefined-type">System</span>.out.println(outcome.getTestCaseName());
     <span class="predefined-type">System</span>.out.println(outcome.getResult());
     <span class="predefined-type">System</span>.out.println(outcome.getDurationInSeconds());
     <span class="predefined-type">System</span>.out.println(outcome.getDataTable()); <span class="comment">// if test was with some data table</span>
     <span class="predefined-type">System</span>.out.println(outcome.getIssueKeys());
 }
....</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_importing_test_results_from_external_sources"><a class="anchor" href="#_importing_test_results_from_external_sources"></a>21. Importing test results from external sources</h2>
<div class="sectionbody">

</div>
</div>
<h1 id="_appendicies" class="sect0"><a class="anchor" href="#_appendicies"></a>Appendicies</h1>
<div class="sect1">
<h2 id="_serenity_system_properties_and_configuration"><a class="anchor" href="#_serenity_system_properties_and_configuration"></a>22. Serenity System Properties and Configuration</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_running_serenity_tests_from_the_command_line"><a class="anchor" href="#_running_serenity_tests_from_the_command_line"></a>22.1. Running Serenity tests from the command line</h3>
<div class="paragraph">
<p>You typically run Serenity as part of the build process (either locally or on a CI server). In addition to the <code>webdriver.driver</code>
 option discussed about, you can also pass a number of parameters in as 
system properties to customize the way the tests are run. You can also 
place these files in a Properties file called <code>serenity.properties</code> (or <code>thucydides.properties</code>), in your project root directory.</p>
</div>
<div class="paragraph">
<p>The full list is shown here:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>properties</strong></dt>
<dd>
<p>Absolute path of the property file where Serenity system property defaults are defined. Defaults to <code>~/serenity.properties</code></p>
</dd>
<dt class="hdlist1"><strong>webdriver.driver</strong></dt>
<dd>
<p>What browser do you want your tests to run in, for example firefox, chrome, phantomjs or iexplorer. You can also use the <strong>driver</strong> property as a shortcut.</p>
</dd>
<dt class="hdlist1"><strong>webdriver.provided_type</strong></dt>
<dd>
<p>If using a provided driver, what type is it. The implementation class
 needs to be defined in the webdriver.provided.{type} system property.</p>
</dd>
<dt class="hdlist1"><strong>webdriver.base.url</strong></dt>
<dd>
<p>The default starting URL for the application, and base URL for relative paths.</p>
</dd>
<dt class="hdlist1"><strong>webdriver.remote.url</strong></dt>
<dd>
<p>The URL to be used for remote drivers (including a selenium grid hub or SauceLabs URL)</p>
</dd>
<dt class="hdlist1"><strong>phantomjs.webdriver.port</strong></dt>
<dd>
<p>What port to run PhantomJS on (used in conjunction with 
webdriver.remote.url to register with a Selenium hub, e.g. 
-Dphantomjs.webdriver=5555 
-Dwebdriver.remote.url=http://localhost:4444/wd/hub</p>
</dd>
<dt class="hdlist1"><strong>webdriver.remote.driver</strong></dt>
<dd>
<p>The driver to be used for remote drivers</p>
</dd>
<dt class="hdlist1"><strong>serenity.driver.capabilities</strong></dt>
<dd>
<p>A set of user-defined capabilities to be used to configure the 
WebDriver driver. Capabilities should be passed in as a space or 
semi-colon-separated list of key:value pairs, e.g. "build:build-1234; 
max-duration:300; single-window:true; tags:[tag1,tag2,tag3]"</p>
</dd>
<dt class="hdlist1"><strong>webdriver.timeouts.implicitlywait</strong></dt>
<dd>
<p>How long webdriver waits for elements to appear by default, in milliseconds.</p>
</dd>
<dt class="hdlist1"><strong>webdriver.wait.for.timeout</strong></dt>
<dd>
<p>How long webdriver waits by default when you use a fluent waiting method, in milliseconds.</p>
</dd>
<dt class="hdlist1"><strong>webdriver.chrome.driver</strong></dt>
<dd>
<p>Path to the Chrome driver, if it is not on the system path.</p>
</dd>
<dt class="hdlist1"><strong>serenity.home</strong></dt>
<dd>
<p>The home directory for Serenity output and data files - by default, $USER_HOME/.serenity</p>
</dd>
<dt class="hdlist1"><strong>serenity.outputDirectory</strong></dt>
<dd>
<p>Where should reports be generated. If project contains only one 
module (root module), than this path will be relative to root module, if
 project contains more than one submodule - than this path will be 
relative to submodule directory, also this path can be different for 
each submodule or can be inherited from root project property.</p>
</dd>
<dt class="hdlist1"><strong>serenity.project.name</strong></dt>
<dd>
<p>What name should appear on the reports</p>
</dd>
<dt class="hdlist1"><strong>serenity.only.save.failing.screenshots</strong></dt>
<dd>
<p>Should Serenity only store screenshots for failing steps? This can 
save disk space and speed up the tests a little. It is very useful for 
data-driven testing. This property is now deprecated. Use <code>serenity.take.screenshots</code> instead.</p>
</dd>
<dt class="hdlist1"><strong>serenity.ext.packages</strong>*</dt>
<dd>
<p>Extension packages. This is a list of packages that will be scanned 
for custom TagProvider implementations. To add a custom tag provider, 
just implement the TagProvider interface and specify the root package 
for this provider in this parameter.</p>
</dd>
<dt class="hdlist1"><strong>serenity.verbose.screenshots</strong></dt>
<dd>
<p>Should Serenity take screenshots for every clicked button and every 
selected link? By default, a screenshot will be stored at the start and 
end of each step. If this option is set to true, Serenity will record 
screenshots for any action performed on a WebElementFacade, i.e. any 
time you use an expression like element(…​).click(), findBy(…​).click() 
and so on. This will be overridden if the ONLY_SAVE_FAILING_SCREENSHOTS 
option is set to true.
@Deprecated This property is still supported, but 
serenity.take.screenshots provides more fine-grained control.</p>
</dd>
<dt class="hdlist1"><strong>serenity.take.screenshots</strong></dt>
<dd>
<p>Set this property to have more finer control on how screenshots are taken. This property can take the following values:</p>
<div class="ulist">
<ul>
<li>
<p><strong>FOR_EACH_ACTION</strong> : Similar to <code>serenity.verbose.screenshots</code></p>
</li>
<li>
<p><strong>BEFORE_AND_AFTER_EACH_STEP</strong></p>
</li>
<li>
<p><strong>AFTER_EACH_STEP</strong></p>
</li>
<li>
<p><strong>FOR_FAILURES</strong> : Similar to <code>serenity.only.save.failing.screenshots</code></p>
</li>
<li>
<p><strong>DISABLED</strong></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><strong>serenity.report.encoding</strong></dt>
<dd>
<p>Encoding used to generate the CSV exports</p>
</dd>
<dt class="hdlist1"><strong>serenity.verbose.steps</strong></dt>
<dd>
<p>Set this property to provide more detailed logging of WebElementFacade steps when tests are run.</p>
</dd>
<dt class="hdlist1"><strong>serenity.reports.show.step.details</strong></dt>
<dd>
<p>Should Thucydides display detailed information in the test result 
tables. If this is set to true, test result tables will display a 
breakdown of the steps by result. This is false by default.</p>
</dd>
<dt class="hdlist1"><strong>serenity.report.show.manual.tests</strong></dt>
<dd>
<p>Show statistics for manual tests in the test reports.</p>
</dd>
<dt class="hdlist1"><strong>serenity.report.show.releases</strong></dt>
<dd>
<p>Report on releases (defaults to true).</p>
</dd>
<dt class="hdlist1"><strong>serenity.restart.browser.frequency</strong></dt>
<dd>
<p>During data-driven tests, some browsers (Firefox in particular) may 
slow down over time due to memory leaks. To get around this, you can get
 Serenity to start a new browser session at regular intervals when it 
executes data-driven tests.</p>
</dd>
<dt class="hdlist1"><strong>thucycides.step.delay</strong></dt>
<dd>
<p>Pause (in ms) between each test step.</p>
</dd>
<dt class="hdlist1"><strong>untrusted.certificates</strong></dt>
<dd>
<p>Useful if you are running Firefox tests against an HTTPS test server 
without a valid certificate. This will make Serenity use a profile with 
the AssumeUntrustedCertificateIssuer property set.</p>
</dd>
<dt class="hdlist1"><strong>refuse.untrusted.certificates</strong></dt>
<dd>
<p>Don’t accept sites using untrusted certificates. By default, 
Thucydides accepts untrusted certificates - use this to change this 
behaviour.</p>
</dd>
<dt class="hdlist1"><strong>serenity.timeout</strong></dt>
<dd>
<p>How long should the driver wait for elements not immediately visible.</p>
</dd>
<dt class="hdlist1"><strong>serenity.browser.width</strong> and <strong>serenity.browser.height</strong></dt>
<dd>
<p>Resize the browser to the specified dimensions, in order to take 
larger screenshots. This should work with Internet Explorer and Firefox,
 but not with Chrome.</p>
</dd>
<dt class="hdlist1"><strong>serenity.resized.image.width</strong></dt>
<dd>
<p>Value in pixels. If set, screenshots are resized to this size. Useful to save space.</p>
</dd>
<dt class="hdlist1"><strong>serenity.keep.unscaled.screenshots</strong></dt>
<dd>
<p>Set to <code>true</code> if you wish to save the original unscaled screenshots. This is set to <code>false</code> by default.</p>
</dd>
<dt class="hdlist1"><strong>serenity.store.html.source</strong></dt>
<dd>
<p>Set this property to <code>true</code> to save the HTML source code of the screenshot web pages. This is set to <code>false</code> by default.</p>
</dd>
<dt class="hdlist1"><strong>serenity.issue.tracker.url</strong></dt>
<dd>
<p>The URL used to generate links to the issue tracking system.</p>
</dd>
<dt class="hdlist1"><strong>serenity.activate.firebugs</strong></dt>
<dd>
<p>Activate the Firebugs and FireFinder plugins for Firefox when running
 the WebDriver tests. This is useful for debugging, but is not 
recommended when running the tests on a build server.</p>
</dd>
<dt class="hdlist1"><strong>serenity.batch.strategy</strong></dt>
<dd>
<p>Defines batch strategy. Allowed values - DIVIDE_EQUALLY (default) and
 DIVIDE_BY_TEST_COUNT. DIVIDE_EQUALLY will simply divide the tests 
equally across all batches. This could be inefficient if the number of 
tests vary a lot between test classes. A DIVIDE_BY_TEST_COUNT strategy 
could be more useful in such cases as this will create batches based on 
number of tests.</p>
</dd>
<dt class="hdlist1"><strong>serenity.batch.count</strong></dt>
<dd>
<p>If batch testing is being used, this is the size of the batches being executed.</p>
</dd>
<dt class="hdlist1"><strong>serenity.batch.number</strong></dt>
<dd>
<p>If batch testing is being used, this is the number of the batch being run on this machine.</p>
</dd>
<dt class="hdlist1"><strong>serenity.use.unique.browser</strong></dt>
<dd>
<p>Set this to true for running all web tests in a single browser, for 
one test. Can be used for configuring Junit and Cucumber, default value 
is <em>false</em>.</p>
</dd>
<dt class="hdlist1"><strong>restart.browser.each.scenario</strong></dt>
<dd>
<p>Set this to false for running all web tests in same story file with 
one browser, can be used when Jbehave is used. default value is <em>false</em></p>
</dd>
<dt class="hdlist1"><strong>serenity.locator.factory</strong></dt>
<dd>
<p>Set this property to override the default locator factory with 
another locator factory (for ex., AjaxElementLocatorFactory or 
DefaultElementLocatorFactory). By default, Serenity uses a custom 
locator factory called DisplayedElementLocatorFactory.</p>
</dd>
<dt class="hdlist1"><strong>serenity.native.events</strong></dt>
<dd>
<p>Activate and deactivate native events for Firefox by setting this property to <code>true</code> or <code>false</code>.</p>
</dd>
<dt class="hdlist1"><strong>security.enable_java</strong></dt>
<dd>
<p>Set this to true to enable Java support in Firefox. By default, this is set to false as it slows down the web driver.</p>
</dd>
<dt class="hdlist1"><strong>serenity.test.requirements.basedir</strong></dt>
<dd>
<p>The base folder of the sub-module where the jBehave stories are kept.
 It is assumed that this directory contains sub folders 
src/test/resources. If this property is set, the requirements are read 
from src/test/resources under this folder instead of the classpath or 
working directory. This property is used to support situations where 
your working directory is different from the requirements base dir (for 
example when building a multi-module project from parent pom with 
requirements stored inside a sub-module)</p>
</dd>
<dt class="hdlist1"><strong>serenity.proxy.http</strong></dt>
<dd>
<p>HTTP Proxy URL configuration for Firefox and PhantomJS</p>
</dd>
<dt class="hdlist1"><strong>serenity.proxy.http_port</strong></dt>
<dd>
<p>HTTP Proxy port configuration for Firefox and PhantomJS</p>
</dd>
<dt class="hdlist1"><strong>serenity.proxy.type</strong></dt>
<dd>
<p>HTTP Proxy type configuration for Firefox and PhantomJS</p>
</dd>
<dt class="hdlist1"><strong>serenity.proxy.user</strong></dt>
<dd>
<p>HTTP Proxy username configuration for Firefox and PhantomJS</p>
</dd>
<dt class="hdlist1"><strong>serenity.proxy.password</strong></dt>
<dd>
<p>HTTP Proxy password configuration for Firefox and PhantomJS</p>
</dd>
<dt class="hdlist1"><strong>serenity.logging</strong></dt>
<dd>
<p>Property for providing level of serenity actions, results, etc.</p>
<div class="ulist">
<ul>
<li>
<p><strong>QUIET</strong> : No Thucydides logging at all</p>
</li>
<li>
<p><strong>NORMAL</strong> : Log the start and end of tests</p>
</li>
<li>
<p><strong>VERBOSE</strong> : Log the start and end of tests and test steps, default value</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><strong>serenity.test.root</strong></dt>
<dd>
<p>The root package for the tests in a given project. If provided, 
Serenity will use this as the root package when determining the 
capabilities associated with a test. If you are using the File System 
Requirements provider, Thucydides will expect this directory structure 
to exist at the top of the requirements tree. If you want to exclude 
packages in a requirements definition and start at a lower level in the 
hierarchy, use the <code>serenity.requirement.exclusions</code> property.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>This is also used by the <code>PackageAnnotationBasedTagProvider</code> to know where to look for annotated requirements.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>serenity.requirements.dir</strong></dt>
<dd>
<p>Use this property if you need to completely override the location of requirements for the File System Provider.</p>
</dd>
<dt class="hdlist1"><strong>serenity.use.requirements.directories</strong></dt>
<dd>
<p>By default, Thucydides will read requirements from the directory 
structure that contains the stories. When other tag and requirements 
plugins are used, such as the JIRA plugin, this can cause conflicting 
tags. Set this property to false to deactivate this feature (it is true 
by default).</p>
</dd>
<dt class="hdlist1"><strong>serenity.annotated.requirements.dir</strong></dt>
<dd>
<p>Use this property if you need to completely override the location of 
requirements for the Annotated Provider. This is recommended if you use 
File System and Annotated provider simultaneously. The default value is 
stories.</p>
</dd>
<dt class="hdlist1"><strong>serenity.requirements.types</strong></dt>
<dd>
<p>The hierarchy of requirement types. This is the list of requirement 
types to be used when reading requirements from the file system and when
 organizing the reports. It is a comma-separated list of tags.The 
default value is: capability, feature.</p>
</dd>
<dt class="hdlist1"><strong>serenity.requirement.exclusions</strong></dt>
<dd>
<p>When deriving requirement types from a path, exclude any values from this comma-separated list.</p>
</dd>
<dt class="hdlist1"><strong>serenity.test.requirements.basedir</strong></dt>
<dd>
<p>The base directory in which requirements are kept. It is assumed that
 this directory contains sub folders src/test/resources. If this 
property is set, the requirements are read from src/test/resources under
 this folder
instead of the classpath or working directory. If you need to set an 
independent requirements directory that
does not follow the src/test/resources convention, use 
`serenity.requirements.dir1 instead</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>This property is used to support situations where your working directory
is different from the requirements base dir (for example when building a multi-module project from parent pom with
requirements stored inside a sub-module.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>serenity.release.types</strong></dt>
<dd>
<p>What tag names identify the release types (e.g. Release, Iteration, 
Sprint). A comma-separated list. By default, "Release, Iteration"</p>
</dd>
<dt class="hdlist1"><strong>serenity.locator.factory</strong></dt>
<dd>
<p>Normally, Serenity uses SmartElementLocatorFactory, an extension of 
the AjaxElementLocatorFactory
when instantiating page objects. This is to ensure that web elements are
 available and usable before they are used.
For alternative behaviour, you can set this value to 
DisplayedElementLocatorFactory, AjaxElementLocatorFactory or 
DefaultElementLocatorFactory.</p>
</dd>
<dt class="hdlist1"><strong>chrome.switches</strong></dt>
<dd>
<p>Arguments to be passed to the Chrome driver, separated by commas. Example: <code>chrome.switches = --incognito;--disable-download-notification</code></p>
</dd>
<dt class="hdlist1"><strong>webdriver.firefox.profile</strong></dt>
<dd>
<p>The path to the directory of the profile to use when starting 
firefox. This defaults to webdriver creating an anonymous profile. This 
is useful if you want to run the web tests using your own Firefox 
profile. If you are not sure about how to find the path to your profile,
 look here: <a href="http://support.mozilla.com/en-US/kb/Profiles" class="bare">http://support.mozilla.com/en-US/kb/Profiles</a>. For example, to run the default profile on a Mac OS X system, you would do something like this:</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre>$ mvn test -Dwebdriver.firefox.profile=/Users/johnsmart/Library/Application\ Support/Firefox/Profiles/2owb5g1d.default</pre>
</div>
</div>
<div class="paragraph">
<p>On Windows, it would be something like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>C:\Projects\myproject&gt;mvn test -Dwebdriver.firefox.profile=C:\Users\John Smart\AppData\Roaming\Mozilla\Firefox\Profiles\mvxjy48u.default</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>firefox.preferences</strong></dt>
<dd>
<p>A semicolon separated list of Firefox configuration settings. For ex.,</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre>-Dfirefox.preferences="browser.download.folderList=2;browser.download.manager.showWhenStarting=false;browser.download.dir=c:\downloads"</pre>
</div>
</div>
<div class="paragraph">
<p>Integer and boolean values will be converted to the corresponding 
types in the Firefox preferences; all other values will be treated as 
Strings. You can set a boolean value to true by simply specifying the 
property name, e.g. <code>-Dfirefox.preferences=app.update.silent</code>.</p>
</div>
<div class="paragraph">
<p>A complete reference to Firefox’s configuration settings is given <a href="http://kb.mozillazine.org/Firefox_:_FAQs_:_About:config_Entries">here</a>.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>serenity.csv.extra.columns</strong></dt>
<dd>
<p>Add extra columns to the CSV output, obtained from tag values.</p>
</dd>
<dt class="hdlist1"><strong>serenity.console.headings</strong></dt>
<dd>
<p>Write the console headings using ascii-art ("ascii", default value) or in normal text ("normal")</p>
</dd>
<dt class="hdlist1"><strong>tags</strong></dt>
<dd>
<p>Comma separated list of tags. If provided, only JUnit classes and/or 
methods with tags in this list will be executed. For example,</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre>mvn verify -Dtags="iteration:I1"

mvn verify -Dtags="color:red,flavor:strawberry"</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>output.formats</strong></dt>
<dd>
<p>What format should test results be generated in. By default, this is "json,xml".</p>
</dd>
<dt class="hdlist1"><strong>narrative.format</strong></dt>
<dd>
<p>Set this property to <em>asciidoc</em> to activate using <a href="http://www.methods.co.nz/asciidoc/">Asciidoc</a> format in narrative text.</p>
</dd>
<dt class="hdlist1"><strong>jira.url</strong></dt>
<dd>
<p>If the base JIRA URL is defined, Serenity will build the issue tracker url using the standard JIRA form.</p>
</dd>
<dt class="hdlist1"><strong>jira.project</strong></dt>
<dd>
<p>If defined, the JIRA project id will be prepended to issue numbers.</p>
</dd>
<dt class="hdlist1"><strong>jira.username</strong></dt>
<dd>
<p>If defined, the JIRA username required to connect to JIRA.</p>
</dd>
<dt class="hdlist1"><strong>jira.password</strong></dt>
<dd>
<p>If defined, the JIRA password required to connect to JIRA.</p>
</dd>
<dt class="hdlist1"><strong>show.pie.charts</strong></dt>
<dd>
<p>Display the pie charts on the dashboard by default. If this is set to
 false, the pie charts will be initially hidden on the dashboard.</p>
</dd>
<dt class="hdlist1"><strong>dashboard.tag.list</strong></dt>
<dd>
<p>If set, this will define the list of tag types to appear on the dashboard screens</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><strong>dashboard.excluded.tag.list</strong>::If set, this will define the list of tag types to be excluded from the dashboard screens</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>json.pretty.printing</strong></dt>
<dd>
<p>Format the JSON test outcomes nicely. "true" or "false", turned off by default.</p>
</dd>
<dt class="hdlist1"><strong>simplified.stack.traces</strong></dt>
<dd>
<p>Stack traces are by default decluttered for readability. For example,
 calls to instrumented code or internal test libraries is removed. This 
behaviour can be deactivated by setting this property to false.</p>
</dd>
<dt class="hdlist1"><strong>serenity.dry.run</strong></dt>
<dd>
<p>Run through the steps without actually executing them.</p>
</dd>
<dt class="hdlist1"><strong>feature.file,language</strong></dt>
<dd>
<p>What (human) language are the Cucumber feature files written in? Defaults to "en".</p>
</dd>
<dt class="hdlist1"><strong>serenity.maintain.session</strong></dt>
<dd>
<p>Keep the Thucydides session data between tests. Normally, the session data is cleared between tests.</p>
</dd>
<dt class="hdlist1"><strong>serenity.console.colors</strong></dt>
<dd>
<p>Enabling or disabling in console output. All details you can find under <a href="#_colors_in_console_output">Colors in console output</a></p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="_providing_your_own_firefox_profile"><a class="anchor" href="#_providing_your_own_firefox_profile"></a>22.2. Providing your own Firefox profile</h3>
<div class="paragraph">
<p>If you need to configure your own customized Firefox profile, you can
 do this by using the Thucydidies.useFirefoxProfile() method before you 
start your tests. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Before</span>
<span class="directive">public</span> <span class="type">void</span> setupProfile() {
  FirefoxProfile myProfile = <span class="keyword">new</span> FirefoxProfile();
  myProfile.setPreference(<span class="string"><span class="delimiter">"</span><span class="content">network.proxy.socks_port</span><span class="delimiter">"</span></span>,<span class="integer">9999</span>);
  myProfile.setAlwaysLoadNoFocusLib(<span class="predefined-constant">true</span>);
  myProfile.setEnableNativeEvents(<span class="predefined-constant">true</span>);
  Serenity.useFirefoxProfile(myProfile);
}

<span class="annotation">@Test</span>
<span class="directive">public</span> <span class="type">void</span> aTestUsingMyCustomProfile() {...}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_colors_in_console_output"><a class="anchor" href="#_colors_in_console_output"></a>22.3. Colors in console output</h3>
<div class="paragraph">
<p>There is feature for colorful console output during executing serenity tests. To enable it you should provide variable <code>serenity.console.colors = true</code>, by default it is turned off. This feature can cause errors if it is enabled for builds under Jenkins.
Possible values are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>true</p>
</li>
<li>
<p>false (default value)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If this property equal to false (or not provided at all) - output will be as configured in your system, for example:</p>
</div>
<div id="console-colors-off" class="imageblock">
<div class="content">
<img src="The%20Serenity%20Reference%20Manual_files/console-colors-off.png" alt="console colors off">
</div>
<div class="title">Figure 60. Console color output is disabled</div>
</div>
<div class="paragraph">
<p>If this property equal to true you will find colorful output:</p>
</div>
<div id="console-colors-on" class="imageblock">
<div class="content">
<img src="The%20Serenity%20Reference%20Manual_files/console-colors-on.png" alt="console colors on">
</div>
<div class="title">Figure 61. Console color output is enabled</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_license_and_copyright"><a class="anchor" href="#_license_and_copyright"></a>23. License and Copyright</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Copyright 2011-2015 John Ferguson Smart.</p>
</div>
<div class="paragraph">
<p>Online version published by Wakaleo Consulting.</p>
</div>
<div class="paragraph">
<p>Serenity-BDD is released under the <a href="http://www.apache.org/licenses/LICENSE-2.0.html">Apache 2</a> open source license.</p>
</div>
<div class="paragraph">
<p>This reference manual is licensed under a Creative Commons
Attribution-Noncommercial-No Derivative Works 3.0 United States
license. For more information about this license, see
<a href="http://creativecommons.org/licenses/by-nc-nd/3.0/us/">creativecommons.org/licenses/by-nc-nd/3.0/us/</a>.</p>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 1.0.1.1<br>
Last updated 2016-07-15 12:22:46 UTC
</div>
</div>

</body></html>